<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="King">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="King">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="King">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title>King</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">King</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">xianxiaotao</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/26/ANDROID/BASE/09Service总结篇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/26/ANDROID/BASE/09Service总结篇/" itemprop="url">09 Service总结篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-26T16:56:00+08:00">
                2017-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>博客原文：<a href="http://www.cnblogs.com/lwbqqyumidi/p/4181185.html" target="_blank" rel="external">Android总结篇系列：Android Service</a></p>
<p>Service通常总是称之为“后台服务”，其中“后台”一词是相对于前台而言的，具体是指其本身的运行并不依赖于用户可视的UI界面，因此，从实际业务需求上来理解，Service的适用场景应该具备以下条件：<br>1.并不依赖于用户可视的UI界面（当然，这一条其实也不是绝对的，如前台Service就是与Notification界面结合使用的）；<br>2.具有较长时间的运行特性。</p>
<h3 id="1、Service-AndroidManifest-xml-声明"><a href="#1、Service-AndroidManifest-xml-声明" class="headerlink" title="1、Service AndroidManifest.xml 声明"></a>1、Service AndroidManifest.xml 声明</h3><p>一般而言，从Service的启动方式上，可以将Service分为Started Service和Bound Service。无论哪种具体的Service启动类型，都是通过继承Service基类自定义而来。在使用Service时，要想系统能够找到此自定义Service，无论哪种类型，都需要在AndroidManifest.xml中声明，语法格式如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;service android:enabled=[<span class="string">"true"</span> | <span class="string">"false"</span>]</div><div class="line">    android:exported=[<span class="string">"true"</span> | <span class="string">"false"</span>]</div><div class="line">    android:icon=<span class="string">"drawable resource"</span></div><div class="line">    android:isolatedProcess=[<span class="string">"true"</span> | <span class="string">"false"</span>]</div><div class="line">    android:label=<span class="string">"string resource"</span></div><div class="line">    android:name=<span class="string">"string"</span></div><div class="line">    android:permission=<span class="string">"string"</span></div><div class="line">    android:process=<span class="string">"string"</span> &gt;</div><div class="line">    . . .</div><div class="line">&lt;/service&gt;</div></pre></td></tr></table></figure></p>
<p>其中，android:name对应Service类名，android:permission是权限声明，android:process设置具体的进程名称。需要注意的是Service能否单独使用一个进程与其启动方式有关，本后下面会给出具体说明。其他的属性此处与其他组件基本相同，不再过多描述。</p>
<blockquote>
<p>如果自定义Service没有在AndroidManifest.xml中声明，当具体使用时，不会像Activity那样直接崩溃报错，对于显式Intent启动的Service，此时也会给出waring信息“IllegalArgumentException: Service not registered”，有时候不容易发现忘了声明而一时定位不到问题。</p>
</blockquote>
<h3 id="2、Started-Service"><a href="#2、Started-Service" class="headerlink" title="2、Started Service"></a>2、Started Service</h3><p>通过context.startService(Intent serviceIntent)启动Service，context.stopService(Intent serviceIntent)停止此Service。当然，在Service内部，也可以通过stopSelf(…)方式停止其本身。注意：如果服务是通过绑定服务开启的，stopSelf方法无效。<br>1) Started Service自定义<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">public class MyService extends Service &#123;</div><div class="line"></div><div class="line">    public static final String TAG = <span class="string">"MyService"</span>;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        <span class="built_in">return</span> null;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="function"><span class="title">onCreate</span></span>() &#123;</div><div class="line">        super.onCreate();</div><div class="line">        Log.w(TAG, <span class="string">"in onCreate"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int onStartCommand(Intent intent, int flags, int startId) &#123;</div><div class="line">        Log.w(TAG, <span class="string">"in onStartCommand"</span>);</div><div class="line">        Log.w(TAG, <span class="string">"MyService:"</span> + this);</div><div class="line">        String name = intent.getStringExtra(<span class="string">"name"</span>);</div><div class="line">        Log.w(TAG, <span class="string">"name:"</span> + name);</div><div class="line">        <span class="built_in">return</span> START_STICKY;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="function"><span class="title">onDestroy</span></span>() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        Log.w(TAG, <span class="string">"in onDestroy"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中，onBind(…)函数是Service基类中的唯一抽象方法，子类都必须重写实现，此函数的返回值是针对Bound Service类型的Service才有用的，在Started Service类型中，此函数直接返回 null 即可。onCreate(…)、onStartCommand(…)和onDestroy()都是Started Service相应生命周期阶段的回调函数。</p>
<p>2) Started Service使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends Activity &#123;</div><div class="line"></div><div class="line">    public static final String TAG = <span class="string">"MainActivity"</span>;</div><div class="line"></div><div class="line">    private Button startServiceBtn;</div><div class="line">    private Button stopServideBtn;</div><div class="line">    private Button goBtn;</div><div class="line"></div><div class="line">    private Intent serviceIntent;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        <span class="built_in">set</span>ContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        startServiceBtn = (Button) findViewById(R.id.start_service);</div><div class="line">        stopServideBtn = (Button) findViewById(R.id.stop_service);</div><div class="line">        goBtn = (Button) findViewById(R.id.go);</div><div class="line"></div><div class="line">        startServiceBtn.setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                serviceIntent = new Intent(MainActivity.this, MyService.class);</div><div class="line">                startService(serviceIntent);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        stopServideBtn.setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                stopService(serviceIntent);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        goBtn.setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                Intent intent = new Intent(MainActivity.this, BActivity.class);</div><div class="line">                startActivity(intent);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void <span class="function"><span class="title">onDestroy</span></span>() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        Log.w(TAG, <span class="string">"in onDestroy"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当Client调用startService(Intent serviceIntent)后，如果MyService是第一次启动，首先会执行 onCreate()回调，然后再执行onStartCommand(Intent intent, int flags, int startId)，当Client再次调用startService(Intent serviceIntent)，将只执行onStartCommand(Intent intent, int flags, int startId)，因为此时Service已经创建了，无需执行onCreate()回调。无论多少次的startService，只需要一次stopService()即可将此Service终止，执行onDestroy()函数（其实很好理解，因为onDestroy()与onCreate()回调是相对的）。</p>
<p>下面重点关注下onStartCommand(Intent intent, int flags, int startId)方法：<br>其中参数flags默认情况下是0，对应的常量名为START_STICKY_COMPATIBILITY。startId是一个唯一的整型，用于表示此次Client执行startService(…)的请求请求标识，在多次startService(…)的情况下，呈现0,1,2….递增。另外，此函数具有一个int型的返回值，具体的可选值及含义如下：</p>
<ul>
<li>START_NOT_STICKY：当Service因为内存不足而被系统kill后，接下来未来的某个时间内，即使系统内存足够可用，系统也不会尝试重新创建此Service。除非程序中Client明确再次调用startService(…)启动此Service。</li>
<li>START_STICKY：当Service因为内存不足而被系统kill后，接下来未来的某个时间内，当系统内存足够可用的情况下，系统将会尝试重新创建此Service，一旦创建成功后将回调onStartCommand(…)方法，但其中的Intent将是null，pendingintent除外。</li>
<li>START_REDELIVER_INTENT：与START_STICKY唯一不同的是，回调onStartCommand(…)方法时，其中的Intent将是非空，将是最后一次调用startService(…)中的intent。</li>
<li>START_STICKY_COMPATIBILITY：compatibility version of {@link #START_STICKY} that does not guarantee that {@link #onStartCommand} will be called again after being killed。此值一般不会使用，所以注意前面三种情形就好。</li>
</ul>
<p>以上的描述中，”当Service因为内存不足而被系统kill后“一定要非常注意，因为此函数的返回值设定只是针对此种情况才有意义的，换言之，当人为的kill掉Service进程，此函数返回值无论怎么设定，接下来未来的某个时间内，即使系统内存足够可用，Service也不会重启。<br>另外，需要注意的是，小米手机针对此处做了一定的修改。在“自启动管理”中有一个自启动应用列表，默认情况下，只有少应用（如微信、QQ、YY、360等）默认是可以自启动的，其他应用默认都是禁止的。用户可以手动添加自启动应用，添加后的应用中如果Started Service onStartCommand(…)回调返回值是START_STICKY或START_REDELIVER_INTENT，当用户在小米手机上长按Home键结束App后，接下来未来的某个时间内，当系统内存足够可用时，Service依然可以按照上述规定重启。当然，如果用户在 设置 &gt;&gt; 应用 &gt;&gt; 强制kill掉App进程，此时Service是不会重启的。<br>注：以上实验结论基于小米2S亲测。</p>
<p>3) Started Service生命周期及进程相关<br>1.onCreate(Client首次startService(..)) &gt;&gt; onStartCommand &gt;&gt; onStartCommand - optional … &gt;&gt; onDestroy(Client调用stopService(..))<br>注：onStartCommand(..)可以多次被调用，onDestroy()与onCreate()想匹配，当用户强制kill掉进程时，onDestroy()是不会执行的。<br>2.对于同一类型的Service，Service实例一次永远只存在一个，而不管Client是否是相同的组件，也不管Client是否处于相同的进程中。<br>3.Service通过startService(..)启动Service后，此时Service的生命周期与Client本身的什么周期是没有任何关系的，只有Client调用stopService(..)或Service本身调用stopSelf(..)才能停止此Service。当然，当用户强制kill掉Service进程或系统因内存不足也可能kill掉此Service。<br>4.Client A 通过startService(..)启动Service后,可以在其他Client（如Client B、Client C）通过调用stopService(..)结束此Service。<br>5.Client调用stopService(..)时，如果当前Service没有启动，也不会出现任何报错或问题，也就是说，stopService(..)无需做当前Service是否有效的判断。<br>6.startService(Intent serviceIntent)，其中的intent既可以是显式Intent，也可以是隐式Intent，当Client与Service同处于一个App时，一般推荐使用显示Intent。当处于不同App时，只能使用隐式Intent。<br>当Service需要运行在单独的进程中，AndroidManifest.xml声明时需要通过android:process指明此进程名称，当此Service需要对其他App开放时，android:exported属性值需要设置为true(当然，在有intent-filter时默认值就是true)。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;service</div><div class="line">    android:name=<span class="string">".MyService"</span></div><div class="line">    android:exported=<span class="string">"true"</span></div><div class="line">    android:process=<span class="string">":MyCorn"</span> &gt;</div><div class="line">    &lt;intent-filter&gt;</div><div class="line">        &lt;action android:name=<span class="string">"com.example.androidtest.myservice"</span> /&gt;</div><div class="line">    &lt;/intent-filter&gt;</div><div class="line">&lt;/service&gt;</div></pre></td></tr></table></figure></p>
<p>4) Started Service Client与Service通信相关<br>当Client调用startService(Intent serviceIntent)启动Service时，Client可以将参数通过Intent直接传递给Service。Service执行过程中，如果需要将参数传递给Client，一般可以通过借助于发送广播的方式（此时，Client需要注册此广播）。</p>
<h3 id="3、Bound-Service"><a href="#3、Bound-Service" class="headerlink" title="3、Bound Service"></a>3、Bound Service</h3><p>相对于Started Service，Bound Service具有更多的知识点。Bound Service的主要特性在于Service的生命周期是依附于Client的生命周期的，当Client不存在时，Bound Service将执行onDestroy，同时通过Service中的Binder对象可以较为方便进行Client-Service通信。Bound Service一般使用过程如下：<br>1.自定义Service继承基类Service，并重写onBind(Intent intent)方法，此方法中需要返回具体的Binder对象；<br>2.Client通过实现ServiceConnection接口来自定义ServiceConnection，并通过bindService (Intent service, ServiceConnection sc, int flags)方法将Service绑定到此Client上；<br>3.自定义的ServiceConnection中实现onServiceConnected(ComponentName name, IBinder binder)方法，获取Service端Binder实例；<br>4.通过获取的Binder实例进行Service端其他公共方法的调用，以完成Client-Service通信；<br>5.当Client在恰当的生命周期（如onDestroy等）时，此时需要解绑之前已经绑定的Service，通过调用函数unbindService(ServiceConnection sc)。<br>在Bound Service具体使用过程中，根据onBind(Intent intent)方法放回的Binder对象的定义方式不同，又可以将其分为以下三种方式，且每种方式具有不同的特点和适用场景：<br>1）Extending the Binder class<br>就是上述Demo中的代码形式，这是Bound Service中最常见的一种使用方式，也是Bound Service中最简单的一种。<br>局限：Clinet与Service必须同属于同一个进程，不能实现进程间通信（IPC）。否则则会出现类似于“android.os.BinderProxy cannot be cast to xxx”错误。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div></pre></td><td class="code"><pre><div class="line">public class MyBindService extends Service &#123;</div><div class="line"></div><div class="line">    public static final String TAG = <span class="string">"MyBindService"</span>;</div><div class="line"></div><div class="line">    private MyBinder mBinder = new MyBinder();</div><div class="line"></div><div class="line">    public class MyBinder extends Binder &#123;</div><div class="line">        MyBindService <span class="function"><span class="title">getService</span></span>() &#123;</div><div class="line">            <span class="built_in">return</span> MyBindService.this;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="function"><span class="title">onCreate</span></span>() &#123;</div><div class="line">        super.onCreate();</div><div class="line">        Log.w(TAG, <span class="string">"in onCreate"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        Log.w(TAG, <span class="string">"in onBind"</span>);</div><div class="line">        <span class="built_in">return</span> mBinder;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onUnbind(Intent intent) &#123;</div><div class="line">        Log.w(TAG, <span class="string">"in onUnbind"</span>);</div><div class="line">        <span class="built_in">return</span> super.onUnbind(intent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="function"><span class="title">onDestroy</span></span>() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        Log.w(TAG, <span class="string">"in onDestroy"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class BActivity extends Activity &#123;</div><div class="line"></div><div class="line">    public static final String TAG = <span class="string">"BActivity"</span>;</div><div class="line"></div><div class="line">    private Button <span class="built_in">bind</span>ServiceBtn;</div><div class="line">    private Button unbindServiceBtn;</div><div class="line"></div><div class="line">    private Button startIntentService;</div><div class="line"></div><div class="line">    private Intent serviceIntent;</div><div class="line"></div><div class="line">    private ServiceConnection sc = new MyServiceConnection();</div><div class="line">    private MyBinder mBinder;</div><div class="line">    private MyBindService mBindService;</div><div class="line">    private boolean mBound;</div><div class="line"></div><div class="line">    private class MyServiceConnection implements ServiceConnection &#123;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onServiceConnected(ComponentName name, IBinder binder) &#123;</div><div class="line">            Log.w(TAG, <span class="string">"in MyServiceConnection onServiceConnected"</span>);</div><div class="line">            mBinder = (MyBinder) binder;</div><div class="line">            mBindService = mBinder.getService();</div><div class="line"></div><div class="line">            mBound = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onServiceDisconnected(ComponentName name) &#123;</div><div class="line">            // This is called when the connection with the service has been</div><div class="line">            // unexpectedly disconnected -- that is, its process crashed.</div><div class="line">            Log.w(TAG, <span class="string">"in MyServiceConnection onServiceDisconnected"</span>);</div><div class="line">            mBound = <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        <span class="built_in">set</span>ContentView(R.layout.b);</div><div class="line"></div><div class="line">        <span class="built_in">bind</span>ServiceBtn = (Button) findViewById(R.id.bind_service);</div><div class="line">        unbindServiceBtn = (Button) findViewById(R.id.unbind_service);</div><div class="line">        startIntentService = (Button) findViewById(R.id.start_intentservice);</div><div class="line"></div><div class="line">        <span class="built_in">bind</span>ServiceBtn.setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                Intent intent = new Intent(BActivity.this, MyBindService.class);</div><div class="line">                <span class="built_in">bind</span>Service(intent, sc, Context.BIND_AUTO_CREATE);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        unbindServiceBtn.setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                excuteUnbindService();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        startIntentService.setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                Intent intent = new Intent(BActivity.this, MyIntentService.class);</div><div class="line">                startService(intent);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void <span class="function"><span class="title">excuteUnbindService</span></span>() &#123;</div><div class="line">        <span class="keyword">if</span> (mBound) &#123;</div><div class="line">            unbindService(sc);</div><div class="line">            mBound = <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void <span class="function"><span class="title">onDestroy</span></span>() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        Log.w(TAG, <span class="string">"in onDestroy"</span>);</div><div class="line">        excuteUnbindService();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>首次点击bindServiceBtn进行bindService(..)时，依次回调顺序如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MyBindService(13457): <span class="keyword">in</span> onCreate</div><div class="line">MyBindService(13457): <span class="keyword">in</span> onBind</div><div class="line">BActivity(13457): <span class="keyword">in</span> MyServiceConnection onServiceConnected</div></pre></td></tr></table></figure></p>
<p>再次点击bindServiceBtn按钮时，发现没有任何输出，说明MyBindService没有进行任何回调。<br>点击unbindServiceBtn进行unbindService(..)时，回调顺序为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MyBindService(13457): <span class="keyword">in</span> onUnbind</div><div class="line">MyBindService(13457): <span class="keyword">in</span> onDestroy</div></pre></td></tr></table></figure></p>
<p>注：在四大基本组件中，需要注意的的是BroadcastReceiver不能作为Bound Service的Client，因为BroadcastReceiver的生命周期很短，当执行完onReceive(..)回调时，BroadcastReceiver生命周期完结。而Bound Service又与Client本身的生命周期相关，因此，Android中不允许BroadcastReceiver去bindService(..)，当有此类需求时，可以考虑通过startService(..)替代。</p>
<p>2）Using a Messenger<br>Messenger，在此可以理解成”信使“，通过Messenger方式返回Binder对象可以不用考虑Clinet - Service是否属于同一个进程的问题，并且，可以实现Client - Service之间的双向通信。极大方便了此类业务需求的实现。<br>局限：不支持严格意义上的多线程并发处理，实际上是以队列去处理。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">public class MyMessengerService extends Service &#123;</div><div class="line"></div><div class="line">    public static final String TAG = <span class="string">"MyMessengerService"</span>;</div><div class="line">    public static final int MSG_FROM_CLIENT_TO_SERVER = 1;</div><div class="line">    public static final int MSG_FROM_SERVER_TO_CLIENT = 2;</div><div class="line"></div><div class="line">    private Messenger mClientMessenger;</div><div class="line">    private Messenger mServerMessenger = new Messenger(new ServerHandler());</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        Log.w(TAG, <span class="string">"in onBind"</span>);</div><div class="line">        <span class="built_in">return</span> mServerMessenger.getBinder();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    class ServerHandler extends Handler &#123;</div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            Log.w(TAG, <span class="string">"thread name:"</span> + Thread.currentThread().getName());</div><div class="line">            switch (msg.what) &#123;</div><div class="line">            <span class="keyword">case</span> MSG_FROM_CLIENT_TO_SERVER:</div><div class="line">                Log.w(TAG, <span class="string">"receive msg from client"</span>);</div><div class="line">                mClientMessenger = msg.replyTo;</div><div class="line"></div><div class="line">                // service发送消息给client</div><div class="line">                Message toClientMsg = Message.obtain(null, MSG_FROM_SERVER_TO_CLIENT);</div><div class="line">                try &#123;</div><div class="line">                    Log.w(TAG, <span class="string">"server begin send msg to client"</span>);</div><div class="line">                    mClientMessenger.send(toClientMsg);</div><div class="line">                &#125; catch (RemoteException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            default:</div><div class="line">                super.handleMessage(msg);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onUnbind(Intent intent) &#123;</div><div class="line">        Log.w(TAG, <span class="string">"in onUnbind"</span>);</div><div class="line">        <span class="built_in">return</span> super.onUnbind(intent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="function"><span class="title">onDestroy</span></span>() &#123;</div><div class="line">        Log.w(TAG, <span class="string">"in onDestroy"</span>);</div><div class="line">        super.onDestroy();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line">public class CActivity extends Activity &#123;</div><div class="line"></div><div class="line">    public static final String TAG = <span class="string">"CActivity"</span>;</div><div class="line"></div><div class="line">    private Button <span class="built_in">bind</span>ServiceBtn;</div><div class="line">    private Button unbindServiceBtn;</div><div class="line">    private Button sendMsgToServerBtn;</div><div class="line"></div><div class="line">    private ServiceConnection sc = new MyServiceConnection();</div><div class="line">    private boolean mBound;</div><div class="line"></div><div class="line">    private Messenger mServerMessenger;</div><div class="line"></div><div class="line">    private Handler mClientHandler = new MyClientHandler();</div><div class="line">    private Messenger mClientMessenger = new Messenger(mClientHandler);</div><div class="line"></div><div class="line">    private class MyClientHandler extends Handler &#123;</div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            <span class="keyword">if</span> (msg.what == MyMessengerService.MSG_FROM_SERVER_TO_CLIENT) &#123;</div><div class="line">                Log.w(TAG, <span class="string">"reveive msg from server"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private class MyServiceConnection implements ServiceConnection &#123;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onServiceConnected(ComponentName name, IBinder binder) &#123;</div><div class="line">            Log.w(TAG, <span class="string">"in MyServiceConnection onServiceConnected"</span>);</div><div class="line">            mServerMessenger = new Messenger(binder);</div><div class="line"></div><div class="line">            mBound = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onServiceDisconnected(ComponentName name) &#123;</div><div class="line">            // This is called when the connection with the service has been</div><div class="line">            // unexpectedly disconnected -- that is, its process crashed.</div><div class="line">            Log.w(TAG, <span class="string">"in MyServiceConnection onServiceDisconnected"</span>);</div><div class="line"></div><div class="line">            mBound = <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        <span class="built_in">set</span>ContentView(R.layout.c);</div><div class="line"></div><div class="line">        <span class="built_in">bind</span>ServiceBtn = (Button) findViewById(R.id.bind_service);</div><div class="line">        unbindServiceBtn = (Button) findViewById(R.id.unbind_service);</div><div class="line">        sendMsgToServerBtn = (Button) findViewById(R.id.send_msg_to_server);</div><div class="line"></div><div class="line">        <span class="built_in">bind</span>ServiceBtn.setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                Intent intent = new Intent(CActivity.this, MyMessengerService.class);</div><div class="line">                <span class="built_in">bind</span>Service(intent, sc, Context.BIND_AUTO_CREATE);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        unbindServiceBtn.setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                excuteUnbindService();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        sendMsgToServerBtn.setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                sayHello();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        new Handler().postDelayed(new <span class="function"><span class="title">Runnable</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void <span class="function"><span class="title">run</span></span>() &#123;</div><div class="line">                Intent intent = new Intent(CActivity.this, MyAlarmBroadcastReceiver.class);</div><div class="line">                sendBroadcast(intent);</div><div class="line">            &#125;</div><div class="line">        &#125;, 3 * 1000);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void <span class="function"><span class="title">sayHello</span></span>() &#123;</div><div class="line">        <span class="keyword">if</span> (!mBound)</div><div class="line">            <span class="built_in">return</span>;</div><div class="line">        // Create and send a message to the service, using a supported <span class="string">'what'</span> value</div><div class="line">        Message msg = Message.obtain(null, MyMessengerService.MSG_FROM_CLIENT_TO_SERVER, 0, 0);</div><div class="line">        // 通过replyTo把client端的Messenger(信使)传递给service</div><div class="line">        msg.replyTo = mClientMessenger;</div><div class="line">        try &#123;</div><div class="line">            mServerMessenger.send(msg);</div><div class="line">        &#125; catch (RemoteException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void <span class="function"><span class="title">excuteUnbindService</span></span>() &#123;</div><div class="line">        <span class="keyword">if</span> (mBound) &#123;</div><div class="line">            unbindService(sc);</div><div class="line">            mBound = <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void <span class="function"><span class="title">onDestroy</span></span>() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        Log.w(TAG, <span class="string">"in onDestroy"</span>);</div><div class="line">        excuteUnbindService();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中，需要注意的几点是：<br>1.MyMessengerService自定中，通过new Messenger(new ServerHandler())创建Messenger对象，在onBind(..)回调中，通过调用Messenger对象的getBinder()方法，将Binder返回；<br>2.Client在ServiceConnection的onServiceConnected(..)的回调中，通过new Messenger(binder)获取到Service传递过来的mServerMessenger；<br>3.接下来，就可以通过mServerMessenger.send(msg)方法向Service发送message，Service中的Messenger构造器中的Handler即可接收到此信息，在handleMessage(..)回调中处理；<br>4.至此只是完成了从Client发送消息到Service，同样的道理，想实现Service发送消息到Client，可以在客户端定义一个Handler，并得到相应的Messenger，在Clinet发送消息给Service时，通过msg.replyTo = mClientMessenger方式将Client信使传递给Service；<br>5.Service接收到Client信使后，获取此信使，并通过mClientMessenger.send(toClientMsg)方式将Service消息发送给Client。</p>
<p>至此，完成了Client - Service之间的双向通信流程。</p>
<p>3）AIDL（Android Interface Definition Language）<br>一般情况下，Messenger这种方式都是可以满足需求的，当然，通过自定义AIDL方式相对更加灵活。<br>这种方式需要自己在项目中自定义xxx.aidl文件，然后系统会自动在gen目录下生成相应的接口类文件，接下来整个的流程与Messenger方式差别不大，网上也有不少实例，在此不再具体给出。<br>注：无论哪种方式的Bound Service，在进行unbind(..)操作时，都需要注意当前Service是否处于已经绑定状态，否则可能会因为当前Service已经解绑后继续执行unbind(..)会导致崩溃。这点与Started Service区别很大（如前文所述：stopService(..)无需做当前Service是否有效的判断）。</p>
<h3 id="4、Local-Service-VS-Remote-Service"><a href="#4、Local-Service-VS-Remote-Service" class="headerlink" title="4、Local Service VS Remote Service"></a>4、Local Service VS Remote Service</h3><p>Local Service：不少人又称之为”本地服务“，是指Client - Service同处于一个进程；<br>Remote Service：又称之为”远程服务“，一般是指Service处于单独的一个进程中。</p>
<h3 id="5、Service特性"><a href="#5、Service特性" class="headerlink" title="5、Service特性"></a>5、Service特性</h3><p>1.Service本身都是运行在其所在进程的主线程（如果Service与Clinet同属于一个进程，则是运行于UI线程），但Service一般都是需要进行”长期“操作，所以经常写法是在自定义Service中处理”长期“操作时需要新建线程，以免阻塞UI线程或导致ANR；<br>2.Service一旦创建，需要停止时都需要显示调用相应的方法（Started Service需要调用stopService(..)或Service本身调用stopSelf(..)， Bound Service需要调用unbindService(..)），否则对于Started Service将处于一直运行状态，对于Bound Service，当Client生命周期结束时也将因此问题。也就是说，Service执行完毕后，必须人为的去停止它</p>
<h3 id="6、IntentService"><a href="#6、IntentService" class="headerlink" title="6、IntentService"></a>6、IntentService</h3><p>IntentService是系统提供给我们的一个已经继承自Service类的特殊类，IntentService特殊性是相对于Service本身的特性而言的：<br>1.默认直接实现了onBind(..)方法，直接返回null，并定义了抽象方法onHandlerIntent(..)，用户自定义子类时，需要实现此方法；<br>2.onHandlerIntent(..)主要就是用来处于相应的”长期“任务的，并且已经自动在新的线程中，用户无需自定义新线程；<br>3.当”长期“任务执行完毕后（也就是onHandlerIntent(..)执行完毕后），此IntentService将自动结束，无需人为调用方法使其结束；<br>4.IntentService处于任务时，也是按照队列的方式一个个去处理，而非真正意义上的多线程并发方式。<br>下面是一个基本的继承自IntentService的自定义Service：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public class MyIntentService extends IntentService &#123;</div><div class="line"></div><div class="line">    public static final String TAG = <span class="string">"MyIntentService"</span>;</div><div class="line"></div><div class="line">    public <span class="function"><span class="title">MyIntentService</span></span>() &#123;</div><div class="line">        super(TAG);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public MyIntentService(String name) &#123;</div><div class="line">        super(name);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onHandleIntent(Intent intent) &#123;</div><div class="line">        Log.w(TAG, <span class="string">"in onHandleIntent"</span>);</div><div class="line">        Log.w(TAG, <span class="string">"thread name:"</span> + Thread.currentThread().getName());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="7、前台Service"><a href="#7、前台Service" class="headerlink" title="7、前台Service"></a>7、前台Service</h3><p>Android中Service接口中还提供了一个称之为”前台Service“的概念。通过Service.startForeground (int id, Notification notification)方法可以将此Service设置为前台Service。在UI显示上，notification将是一个处于onGoing状态的通知，使得前台Service拥有更高的进程优先级，并且Service可以直接notification通信。<br>下面是一个简单的前台Service使用实例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">public class MyService extends Service &#123;</div><div class="line"></div><div class="line">    public static final String TAG = <span class="string">"MyService"</span>;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        <span class="built_in">return</span> null;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="function"><span class="title">onCreate</span></span>() &#123;</div><div class="line">        super.onCreate();</div><div class="line">        Log.w(TAG, <span class="string">"in onCreate"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int onStartCommand(Intent intent, int flags, int startId) &#123;</div><div class="line">        Log.w(TAG, <span class="string">"in onStartCommand"</span>);</div><div class="line">        Log.w(TAG, <span class="string">"MyService:"</span> + this);</div><div class="line">        String name = intent.getStringExtra(<span class="string">"name"</span>);</div><div class="line">        Log.w(TAG, <span class="string">"name:"</span> + name);</div><div class="line"></div><div class="line">        </div><div class="line">        Notification notification = new Notification(R.drawable.ic_launcher, <span class="string">"test"</span>, System.currentTimeMillis());</div><div class="line">        Intent notificationIntent = new Intent(this, DActivity.class);</div><div class="line">        PendingIntent pendingIntent = PendingIntent.getActivity(this, 0, notificationIntesnt, 0);</div><div class="line">        notification.setLatestEventInfo(this, <span class="string">"title"</span>, <span class="string">"content"</span>, pendingIntent);</div><div class="line">        startForeground(1, notification);</div><div class="line">        </div><div class="line"></div><div class="line">        <span class="built_in">return</span> START_REDELIVER_INTENT;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="function"><span class="title">onDestroy</span></span>() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        Log.w(TAG, <span class="string">"in onDestroy"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/26/ANDROID/BASE/08Service通信/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/26/ANDROID/BASE/08Service通信/" itemprop="url">08 Service通信</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-26T13:00:00+08:00">
                2017-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、应用内通信"><a href="#一、应用内通信" class="headerlink" title="一、应用内通信"></a>一、应用内通信</h2><h4 id="1、启动Service并传递数据"><a href="#1、启动Service并传递数据" class="headerlink" title="1、启动Service并传递数据"></a>1、启动Service并传递数据</h4><p>启动一个Service并且向该Service传递数据:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = new Intent(this, MyService.class);</div><div class="line">intent.putExtra(<span class="string">"data"</span>, mEditText.getText().toString().trim());</div><div class="line">startService(intent);</div></pre></td></tr></table></figure></p>
<p>MyService接收数据：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">private String data = <span class="string">"MyService default info"</span>;</div><div class="line"></div><div class="line">@Override</div><div class="line">public int onStartCommand(Intent intent, int flags, int startId) &#123; </div><div class="line">    data = intent.getStringExtra(<span class="string">"data"</span>);</div><div class="line">    <span class="built_in">return</span> super.onStartCommand(intent, flags, startId);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="2、绑定Service进行通信——-gt"><a href="#2、绑定Service进行通信——-gt" class="headerlink" title="2、绑定Service进行通信——&gt;"></a>2、绑定Service进行通信——&gt;</h4><p>与被绑定的Service进行通信，首先自定义一个Binder的实现类，拥有setData(String data)方法，并在onBind方法中返回自定义类的对象：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class MyService extends Service &#123;</div><div class="line"></div><div class="line">    private String data = <span class="string">"MyService default info"</span>;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        <span class="built_in">return</span> new MyBinder();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public class MyBinder extends Binder &#123;</div><div class="line">        public void <span class="built_in">set</span>Data(String data) &#123;</div><div class="line">            MyService.this.data = data;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在ServiceConnection实现类中onServiceConnected方法里获取服务绑定成功时返回的对象<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener, ServiceConnection &#123;</div><div class="line"></div><div class="line">    private MyService.MyBinder mMyBinder;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line">        mMyBinder = (MyService.MyBinder) service;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后MainActivity就可以实时的想MyService同步数据了：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (mMyBinder != null)</div><div class="line">    mMyBinder.setData(mEditText.getText().toString().trim());</div></pre></td></tr></table></figure></p>
<p>输出日志<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onCreate</div><div class="line">I/System.out: MyService default info</div><div class="line">I/System.out: MyService default info</div><div class="line">I/System.out: MyService default info</div><div class="line">I/System.out: MyService default info</div><div class="line">I/System.out: MainActivity say something</div><div class="line">I/System.out: MainActivity say something</div><div class="line">I/System.out: MainActivity say something</div><div class="line">I/System.out: MyService onDestroy</div></pre></td></tr></table></figure></p>
<h4 id="3、绑定Service进行通信-lt-——"><a href="#3、绑定Service进行通信-lt-——" class="headerlink" title="3、绑定Service进行通信&lt;——"></a>3、绑定Service进行通信&lt;——</h4><p>侦听被绑定的Service的内部状态，需要借助回调接口。首先定义回调接口并设置set(callBack)方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class MyService extends Service &#123;</div><div class="line"></div><div class="line">    private CallBack mCallBack;</div><div class="line"></div><div class="line">    public void <span class="built_in">set</span>CallBack(CallBack callBack) &#123;</div><div class="line">        mCallBack = callBack;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static interface CallBack &#123;</div><div class="line">        public void onDataChange(String data);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>自定义类MyBinder中增加一个方法，返回当前Service的对象，以便于外部客户端调用set(callBack)方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class MyBinder extends Binder &#123;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    public MyService <span class="function"><span class="title">getService</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> MyService.this;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在Service中将状态信息通过回调接口通知外界<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">i++;</div><div class="line"><span class="keyword">if</span> (mCallBack != null)</div><div class="line">    mCallBack.onDataChange(i + <span class="string">" "</span> + data);</div></pre></td></tr></table></figure></p>
<p>ServiceConnection的实现类（此处为MainActivity）在onServiceConnected方法中获取Service对象，并将自定义的回调接口告知Service：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line">    mMyBinder = (MyService.MyBinder) service;</div><div class="line">    mMyBinder.getService().setCallBack(new MyService.<span class="function"><span class="title">CallBack</span></span>() &#123;</div><div class="line">        @Override</div><div class="line">        public void onDataChange(String data) &#123;</div><div class="line">            Message msg = new Message();</div><div class="line">            Bundle bundle = new Bundle();</div><div class="line">            bundle.putString(<span class="string">"data"</span>, data);</div><div class="line">            msg.setData(bundle);</div><div class="line">            mHandler.sendMessage(msg);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>借助Handler，将数据同步到TextView上：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">private Handler mHandler = new <span class="function"><span class="title">Handler</span></span>() &#123;</div><div class="line">    @Override</div><div class="line">    public void handleMessage(Message msg) &#123;</div><div class="line">        super.handleMessage(msg);</div><div class="line">        mTextView.setText(msg.getData().getString(<span class="string">"data"</span>));</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h2 id="二、跨应用通信——AIDL"><a href="#二、跨应用通信——AIDL" class="headerlink" title="二、跨应用通信——AIDL"></a>二、跨应用通信——AIDL</h2><h4 id="1、跨应用启动Service"><a href="#1、跨应用启动Service" class="headerlink" title="1、跨应用启动Service"></a>1、跨应用启动Service</h4><p>从Android5.0以后，只能通过显示Intent来启动服务。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">package com.xianxiaotao.firstapp;</div><div class="line"></div><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    private Intent mIntent;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line"></div><div class="line">        ...</div><div class="line"></div><div class="line">        mIntent = new Intent();</div><div class="line">        mIntent.setComponent(new ComponentName(<span class="string">"com.xianxiaotao.secondapp"</span>, <span class="string">"com.xianxiaotao.secondapp.AppService"</span>));</div><div class="line">        startService(mIntent)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void <span class="function"><span class="title">onDestroy</span></span>() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        stopService(mIntent);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="2、跨应用绑定Service"><a href="#2、跨应用绑定Service" class="headerlink" title="2、跨应用绑定Service"></a>2、跨应用绑定Service</h4><p>新建AIDL文件：New -&gt; AIDL -&gt; AIDL File -&gt; IAppServiceRemoteBinder.aidl<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">package com.xianxiaotao.secondapp;</div><div class="line"></div><div class="line">interface IAppServiceRemoteBinder &#123;</div><div class="line">    void basicTypes(int anInt, long aLong, boolean aBoolean, <span class="built_in">float</span> aFloat, double aDouble, String aString);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在Service里实现该接口：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">package com.xianxiaotao.secondapp;</div><div class="line"></div><div class="line">public class AppService extends Service &#123;</div><div class="line">    </div><div class="line">    ...</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        <span class="built_in">return</span> new IAppServiceRemoteBinder.<span class="function"><span class="title">Stub</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void basicTypes(int anInt, long aLong, boolean aBoolean, <span class="built_in">float</span> aFloat, double aDouble, String aString) &#123;</div><div class="line">                // TODO</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在第一个应用中绑定服务和解除绑定服务：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">bind</span>Service(mIntent, this, Context.BIND_AUTO_CREATE);</div><div class="line">unbindService(this);</div></pre></td></tr></table></figure></p>
<h4 id="3、跨应用绑定Service并通信"><a href="#3、跨应用绑定Service并通信" class="headerlink" title="3、跨应用绑定Service并通信"></a>3、跨应用绑定Service并通信</h4><p>在IAppServiceRemoteBinder接口中新增setData方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">interface IAppServiceRemoteBinder &#123;</div><div class="line">    void basicTypes(int anInt, long aLong, boolean aBoolean, <span class="built_in">float</span> aFloat, double aDouble, String aString);</div><div class="line">    void <span class="built_in">set</span>Data(String data);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其子类需要实现该方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public IBinder onBind(Intent intent) &#123;</div><div class="line">    <span class="built_in">return</span> new IAppServiceRemoteBinder.<span class="function"><span class="title">Stub</span></span>() &#123;</div><div class="line">        @Override</div><div class="line">        public void basicTypes(int anInt, long aLong, boolean aBoolean, <span class="built_in">float</span> aFloat, double aDouble, String aString) &#123;</div><div class="line">            // TODO</div><div class="line">        &#125;</div><div class="line">        @Override</div><div class="line">        public void <span class="built_in">set</span>Data(String data) throws RemoteException &#123;</div><div class="line">            AppService.this.data = data;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在第一个应用里创同样的IAppServiceRemoteBinder.aidl文件，注意包名也要一致。</p>
<ul>
<li>firstApp -&gt; New -&gt; Folder -&gt; AIDL Folder</li>
<li>aidl -&gt; New -&gt; Package -&gt; com.xianxiaotao.secondapp -&gt; OK</li>
<li>在该文件夹里创建同样的IAppServiceRemoteBinder.aidl文件，测试时可以直接复制粘贴。<br>上述操作执行完毕后，该应用绑定secondapp的AppService时，可以获取到IBinder的实例了。<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">private IAppServiceRemoteBinder binder = null;</div><div class="line"></div><div class="line">@Override</div><div class="line">public void onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line">    // 此处不能用强制类型转换，虽然类名相同，但两个类在内存中地址不一样</div><div class="line">    binder = IAppServiceRemoteBinder.Stub.asInterface(service);</div><div class="line">&#125;</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="keyword">if</span> (binder != null) &#123;</div><div class="line">    try &#123;</div><div class="line">        binder.setData(mEditText.getText().toString().trim());</div><div class="line">    &#125; catch (RemoteException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/26/ANDROID/BASE/07Service/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/26/ANDROID/BASE/07Service/" itemprop="url">07 Service</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-26T10:00:00+08:00">
                2017-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、初识Service"><a href="#一、初识Service" class="headerlink" title="一、初识Service"></a>一、初识Service</h2><h4 id="1、启动Service和停止Service"><a href="#1、启动Service和停止Service" class="headerlink" title="1、启动Service和停止Service"></a>1、启动Service和停止Service</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">startService(new Intent(MainActivity.this, MyService.class));	// 启动服务</div><div class="line">stopService(new Intent(MainActivity.this, MyService.class));	// 停止服务</div></pre></td></tr></table></figure>
<p>服务在系统中最多只有一个实例，即使上述代码中创建了两个不同的Intent实例，但是启动和停止的服务是同一个。只创建一个Intent实例也是可以的，如下所示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">private Intent mIntent;</div><div class="line">...</div><div class="line">mIntent = new Intent(MainActivity.this, MyService.class);</div><div class="line">...</div><div class="line">startService(mIntent);</div><div class="line">...</div><div class="line">stopService(mIntent);</div></pre></td></tr></table></figure></p>
<p>Service代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">package com.xianxiaotao.learnservice;</div><div class="line"></div><div class="line">import android.app.Service;</div><div class="line">import android.content.Intent;</div><div class="line">import android.os.IBinder;</div><div class="line"></div><div class="line">public class MyService extends Service &#123;</div><div class="line">    public <span class="function"><span class="title">MyService</span></span>() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        System.out.println(<span class="string">"MyService onBind"</span>);</div><div class="line">        <span class="built_in">return</span> new Binder();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="function"><span class="title">onCreate</span></span>() &#123;</div><div class="line">        super.onCreate();</div><div class="line">        System.out.println(<span class="string">"MyService onCreate"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int onStartCommand(Intent intent, int flags, int startId) &#123;</div><div class="line">        System.out.println(<span class="string">"MyService onStartCommand"</span>);</div><div class="line">        <span class="built_in">return</span> super.onStartCommand(intent, flags, startId);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="function"><span class="title">onDestroy</span></span>() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        System.out.println(<span class="string">"MyService onDestroy"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="2、绑定Service和解除绑定服务"><a href="#2、绑定Service和解除绑定服务" class="headerlink" title="2、绑定Service和解除绑定服务"></a>2、绑定Service和解除绑定服务</h4><p>API:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 绑定服务的API</div><div class="line">public boolean <span class="built_in">bind</span>Service(Intent service, ServiceConnection conn, int flags) &#123;</div><div class="line">	<span class="built_in">return</span> mBase.bindService(service, conn, flags);</div><div class="line">&#125;</div><div class="line">// 解除绑定服务的API</div><div class="line">public void unbindService(ServiceConnection conn) &#123;</div><div class="line">    mBase.unbindService(conn);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>实现接口ServiceConnection：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity implements ServiceConnection &#123;</div><div class="line"></div><div class="line">	private Intent mIntent;</div><div class="line"></div><div class="line">	...</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line">        System.out.println(<span class="string">"Service Connected"</span>);	// 服务被成功绑定之后执行</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onServiceDisconnected(ComponentName name) &#123;</div><div class="line">        System.out.println(<span class="string">"Service Disconnected"</span>);	// 服务所在的进程崩溃时或者被<span class="built_in">kill</span>时执行</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>绑定Service和解除绑定Service：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">bind</span>Service(mIntent, MainActivity.this, Context.BIND_AUTO_CREATE);</div><div class="line">unbindService(MainActivity.this);</div></pre></td></tr></table></figure></p>
<h2 id="二、Service生命周期"><a href="#二、Service生命周期" class="headerlink" title="二、Service生命周期"></a>二、Service生命周期</h2><h4 id="1、启动服务生命周期"><a href="#1、启动服务生命周期" class="headerlink" title="1、启动服务生命周期"></a>1、启动服务生命周期</h4><p>第一次启动服务日志如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onCreate</div><div class="line">I/System.out: MyService onStartCommand</div></pre></td></tr></table></figure></p>
<p>第二、三次启动服务日志：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onStartCommand</div><div class="line">I/System.out: MyService onStartCommand</div></pre></td></tr></table></figure></p>
<p>接着停止服务日志：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onDestroy</div></pre></td></tr></table></figure></p>
<h4 id="2、启动服务后并退出"><a href="#2、启动服务后并退出" class="headerlink" title="2、启动服务后并退出"></a>2、启动服务后并退出</h4><p>启动服务后并退出当前程序的日志：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onCreate</div><div class="line">I/System.out: MyService onStartCommand</div></pre></td></tr></table></figure></p>
<p>重新启动应用并停止服务：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onDestroy</div></pre></td></tr></table></figure></p>
<h4 id="3、绑定服务生命周期"><a href="#3、绑定服务生命周期" class="headerlink" title="3、绑定服务生命周期"></a>3、绑定服务生命周期</h4><p>第一次绑定服务日志：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onCreate</div><div class="line">I/System.out: MyService onBind</div><div class="line">I/System.out: Service Connected</div></pre></td></tr></table></figure></p>
<p>第二、三次绑定服务无任何日志输出<br>解除绑定服务日志：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onDestroy</div></pre></td></tr></table></figure></p>
<h4 id="4、绑定服务并退出"><a href="#4、绑定服务并退出" class="headerlink" title="4、绑定服务并退出"></a>4、绑定服务并退出</h4><p>成功绑定服务后并退出当前程序的日志：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onCreate</div><div class="line">I/System.out: MyService onBind</div><div class="line">I/System.out: Service Connected</div><div class="line">E/ActivityThread: Activity com.xianxiaotao.learnservice.MainActivity has leaked ServiceConnection com.xianxiaotao.learnservice.MainActivity@f45fa7c that was originally bound here</div><div class="line">                  android.app.ServiceConnectionLeaked: Activity com.xianxiaotao.learnservice.MainActivity has leaked ServiceConnection com.xianxiaotao.learnservice.MainActivity@f45fa7c that was originally bound here</div><div class="line">                      at android.app.LoadedApk<span class="variable">$ServiceDispatcher</span>.&lt;init&gt;(LoadedApk.java:1336)</div><div class="line">                      at android.app.LoadedApk.getServiceDispatcher(LoadedApk.java:1231)</div><div class="line">                      at android.app.ContextImpl.bindServiceCommon(ContextImpl.java:1450)</div><div class="line">                      at android.app.ContextImpl.bindService(ContextImpl.java:1422)</div><div class="line">                      at android.content.ContextWrapper.bindService(ContextWrapper.java:636)</div><div class="line">                      at com.xianxiaotao.learnservice.MainActivity<span class="variable">$3</span>.onClick(MainActivity.java:39)</div><div class="line">                      at android.view.View.performClick(View.java:5637)</div><div class="line">                      at android.view.View<span class="variable">$PerformClick</span>.run(View.java:22429)</div><div class="line">                      at android.os.Handler.handleCallback(Handler.java:751)</div><div class="line">                      at android.os.Handler.dispatchMessage(Handler.java:95)</div><div class="line">                      at android.os.Looper.loop(Looper.java:154)</div><div class="line">                      at android.app.ActivityThread.main(ActivityThread.java:6121)</div><div class="line">                      at java.lang.reflect.Method.invoke(Native Method)</div><div class="line">                      at com.android.internal.os.ZygoteInit<span class="variable">$MethodAndArgsCaller</span>.run(ZygoteInit.java:889)</div><div class="line">                      at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:779)</div><div class="line">I/System.out: MyService onDestroy</div></pre></td></tr></table></figure></p>
<p>如果绑定服务后，请确保在异常情况下解除绑定服务。比如在Activity的onDestroy方法中解除绑定服务。</p>
<h4 id="5、启动服务后绑定服务"><a href="#5、启动服务后绑定服务" class="headerlink" title="5、启动服务后绑定服务"></a>5、启动服务后绑定服务</h4><p>启动服务：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onCreate</div><div class="line">I/System.out: MyService onStartCommand</div></pre></td></tr></table></figure></p>
<p>绑定服务：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onBind</div><div class="line">I/System.out: Service Connected</div></pre></td></tr></table></figure></p>
<p>解除绑定服务：无日志<br>停止服务：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">I/System.out: MyService onDestroy</div></pre></td></tr></table></figure></p>
<p>总结：</p>
<ul>
<li>启动服务后可以通过调用stopService()方法停止服务(也可以由其他应用程序调用、或者服务自身调用stopSelf()来停止服务）。</li>
<li>只有第一次启动服务时，系统会调用Service的onCreate和onStartCommand方法，其他只会调用onStartCommand方法。</li>
<li>绑定服务时，系统会调用Service的onCreate、onBind方法，以及ServiceConnection实现类的onServiceConnected方法。</li>
<li>如果绑定了服务，请在停止服务前或退出程序前必须解除服务绑定。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/24/ANDROID/BASE/06Context/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/24/ANDROID/BASE/06Context/" itemprop="url">06 Context</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-24T11:05:00+08:00">
                2017-05-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文参考阅读：<a href="http://www.jianshu.com/p/94e0f9ab3f1d" target="_blank" rel="external">Context都没弄明白，还怎么做Android开发？</a></p>
<h4 id="Activity-mActivity-new-Activity"><a href="#Activity-mActivity-new-Activity" class="headerlink" title="Activity mActivity = new Activity();"></a>Activity mActivity = new Activity();</h4><p>作为Android开发者，不知道你有没有思考过这个问题，Activity可以new吗？Android的应用程序开发采用JAVA语言，Activity本质上也是一个对象，那上面的写法有什么问题呢？估计很多人说不清道不明。Android程序不像Java程序一样，随便创建一个类，写个main()方法就能运行，Android应用模型是基于组件的应用设计模式，组件的运行要有一个完整的Android工程环境，在这个环境下，Activity、Service等系统组件才能够正常工作，而这些组件并不能采用普通的Java对象创建方式，new一下就能创建实例了，而是要有它们各自的上下文环境，也就是我们这里讨论的Context。可以这样讲，Context是维持Android程序中各组件能够正常工作的一个核心功能类。</p>
<h4 id="Context到底是什么"><a href="#Context到底是什么" class="headerlink" title="Context到底是什么"></a>Context到底是什么</h4><p>Context的中文翻译为：语境; 上下文; 背景; 环境，在开发中我们经常说称之为“上下文”，那么这个“上下文”到底是指什么意思呢？在语文中，我们可以理解为语境，在程序中，我们可以理解为当前对象在程序中所处的一个环境，一个与系统交互的过程。比如微信聊天，此时的“环境”是指聊天的界面以及相关的数据请求与传输，Context在加载资源、启动Activity、获取系统服务、创建View等操作都要参与。</p>
<p>那Context到底是什么呢？一个Activity就是一个Context，一个Service也是一个Context。Android程序员把“场景”抽象为Context类，他们认为用户和操作系统的每一次交互都是一个场景，比如打电话、发短信，这些都是一个有界面的场景，还有一些没有界面的场景，比如后台运行的服务（Service）。一个应用程序可以认为是一个工作环境，用户在这个环境中会切换到不同的场景，这就像一个前台秘书，她可能需要接待客人，可能要打印文件，还可能要接听客户电话，而这些就称之为不同的场景，前台秘书可以称之为一个应用程序。</p>
<h4 id="如何生动形象的理解Context"><a href="#如何生动形象的理解Context" class="headerlink" title="如何生动形象的理解Context"></a>如何生动形象的理解Context</h4><p>上面的概念中采用了通俗的理解方式，将Context理解为“上下文”或者“场景”，如果你仍然觉得很抽象，不好理解。在这里我给出一个可能不是很恰当的比喻，希望有助于大家的理解：一个Android应用程序，可以理解为一部电影或者一部电视剧，Activity，Service，Broadcast Receiver，Content Provider这四大组件就好比是这部戏里的四个主角：胡歌，霍建华，诗诗，Baby。他们是由剧组（系统）一开始就定好了的，整部戏就是由这四位主演领衔担纲的，所以这四位主角并不是大街上随随便便拉个人（new 一个对象）都能演的。有了演员当然也得有摄像机拍摄啊，他们必须通过镜头（Context）才能将戏传递给观众，这也就正对应说四大组件（四位主角）必须工作在Context环境下（摄像机镜头）。那Button，TextView，LinearLayout这些控件呢，就好比是这部戏里的配角或者说群众演员，他们显然没有这么重用，随便一个路人甲路人乙都能演（可以new一个对象），但是他们也必须要面对镜头（工作在Context环境下），所以Button mButton=new Button（Context）是可以的。虽然不很恰当，但还是很容易理解的，希望有帮助。</p>
<h4 id="源码中的Context"><a href="#源码中的Context" class="headerlink" title="源码中的Context"></a>源码中的Context</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Interface to global information about an application environment.  This is</div><div class="line"> * an abstract class whose implementation is provided by</div><div class="line"> * the Android system.  It</div><div class="line"> * allows access to application-specific resources and classes, as well as</div><div class="line"> * up-calls <span class="keyword">for</span> application-level operations such as launching activities,</div><div class="line"> * broadcasting and receiving intents, etc.</div><div class="line"> */</div><div class="line">public abstract class Context &#123;</div><div class="line">    /**</div><div class="line">     * File creation mode: the default mode, <span class="built_in">where</span> the created file can only</div><div class="line">     * be accessed by the calling application (or all applications sharing the</div><div class="line">     * same user ID).</div><div class="line">     */</div><div class="line">    public static final int MODE_PRIVATE = 0x0000;</div><div class="line"></div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>源码中的注释是这么来解释Context的：Context提供了关于应用环境全局信息的接口。它是一个抽象类，它的执行被Android系统所提供。它允许获取以应用为特征的资源和类型，是一个统领一些资源（应用程序环境变量等）的上下文。就是说，它描述一个应用程序环境的信息（即上下文）；是一个抽象类，Android提供了该抽象类的具体实现类；通过它我们可以获取应用程序的资源和类（包括应用级别操作，如启动Activity，发广播，接受Intent等）。既然上面Context是一个抽象类，那么肯定有他的实现类咯，我们在Context的源码中通过IDE可以查看到他的子类最终可以得到如下关系图：<br><img src="http://ww1.sinaimg.cn/large/adc90466ly1ffwafz832kj20hg0eejrg.jpg" alt="Context继承关系图"><br>Context类本身是一个纯abstract类，它有两个具体的实现子类：ContextImpl和ContextWrapper。其中ContextWrapper类，如其名所言，这只是一个包装而已，ContextWrapper构造函数中必须包含一个真正的Context引用，同时ContextWrapper中提供了attachBaseContext（）用于给ContextWrapper对象中指定真正的Context对象，调用ContextWrapper的方法都会被转向其所包含的真正的Context对象。ContextThemeWrapper类，如其名所言，其内部包含了与主题（Theme）相关的接口，这里所说的主题就是指在AndroidManifest.xml中通过android：theme为Application元素或者Activity元素指定的主题。当然，只有Activity才需要主题，Service是不需要主题的，因为Service是没有界面的后台场景，所以Service直接继承于ContextWrapper，Application同理。而ContextImpl类则真正实现了Context中的所以函数，应用程序中所调用的各种Context类的方法，其实现均来自于该类。一句话总结：Context的两个子类分工明确，其中ContextImpl是Context的具体实现类，ContextWrapper是Context的包装类。Activity，Application，Service虽都继承自ContextWrapper（Activity继承自ContextWrapper的子类ContextThemeWrapper），但它们初始化的过程中都会创建ContextImpl对象，由ContextImpl实现Context中的方法。</p>
<h4 id="一个应用程序有几个Context"><a href="#一个应用程序有几个Context" class="headerlink" title="一个应用程序有几个Context"></a>一个应用程序有几个Context</h4><p>其实这个问题本身并没有什么意义，关键还是在于对Context的理解，从上面的关系图我们已经可以得出答案了，在应用程序中Context的具体实现子类就是：Activity，Service，Application。那么Context数量=Activity数量+Service数量+应用进程数量(一般为1)。当然如果你足够细心，可能会有疑问：我们常说四大组件，这里怎么只有Activity，Service持有Context，那Broadcast Receiver，Content Provider呢？Broadcast Receiver，Content Provider并不是Context的子类，他们所持有的Context都是其他地方传过去的，所以并不计入Context总数。上面的关系图也从另外一个侧面告诉我们Context类在整个Android系统中的地位是多么的崇高，因为很显然Activity，Service，Application都是其子类，其地位和作用不言而喻。</p>
<h4 id="Context能干什么"><a href="#Context能干什么" class="headerlink" title="Context能干什么"></a>Context能干什么</h4><p>Context到底可以实现哪些功能呢？这个就实在是太多了，弹出Toast、启动Activity、启动Service、发送广播、操作数据库等等都需要用到Context。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">TextView tv = new TextView(getContext());</div><div class="line">ListAdapter adapter = new SimpleCursorAdapter(getApplicationContext(), ...);</div><div class="line">AudioManager am = (AudioManager) getContext().getSystemService(Context.AUDIO_SERVICE);getApplicationContext().getSharedPreferences(name, mode);</div><div class="line">getApplicationContext().getContentResolver().query(uri, ...);</div><div class="line">getContext().getResources().getDisplayMetrics().widthPixels * 5 / 8;</div><div class="line">getContext().startActivity(intent);</div><div class="line">getContext().startService(intent);</div><div class="line">getContext().sendBroadcast(intent);</div></pre></td></tr></table></figure></p>
<h4 id="Context作用域"><a href="#Context作用域" class="headerlink" title="Context作用域"></a>Context作用域</h4><p>虽然Context神通广大，但并不是随便拿到一个Context实例就可以为所欲为，它的使用还是有一些规则限制的。由于Context的具体实例是由ContextImpl类去实现的，因此在绝大多数场景下，Activity、Service和Application这三种类型的Context都是可以通用的。不过有几种场景比较特殊，比如启动Activity，还有弹出Dialog。出于安全原因的考虑，Android是不允许Activity或Dialog凭空出现的，一个Activity的启动必须要建立在另一个Activity的基础之上，也就是以此形成的返回栈。而Dialog则必须在一个Activity上面弹出（除非是System Alert类型的Dialog），因此在这种场景下，我们只能使用Activity类型的Context，否则将会出错。<br><img src="http://ww1.sinaimg.cn/large/adc90466ly1ffwalj4c9fj20gd0bk758.jpg" alt="Context作用域"><br>从上图我们可以发现Activity所持有的Context的作用域最广，无所不能。因为Activity继承自ContextThemeWrapper，而Application和Service继承自ContextWrapper，很显然ContextThemeWrapper在ContextWrapper的基础上又做了一些操作使得Activity变得更强大，这里我就不再贴源码给大家分析了，有兴趣的童鞋可以自己查查源码。上图中的YES和NO我也不再做过多的解释了，这里我说一下上图中Application和Service所不推荐的两种使用情况。<br>1：如果我们用ApplicationContext去启动一个LaunchMode为standard的Activity的时候会报错android.util.AndroidRuntimeException: Calling startActivity from outside of an Activity context requires the FLAG_ACTIVITY_NEW_TASK flag. Is this really what you want?这是因为非Activity类型的Context并没有所谓的任务栈，所以待启动的Activity就找不到栈了。解决这个问题的方法就是为待启动的Activity指定FLAG_ACTIVITY_NEW_TASK标记位，这样启动的时候就为它创建一个新的任务栈，而此时Activity是以singleTask模式启动的。所有这种用Application启动Activity的方式不推荐使用，Service同Application。<br>2：在Application和Service中去layout inflate也是合法的，但是会使用系统默认的主题样式，如果你自定义了某些样式可能不会被使用。所以这种方式也不推荐使用。<br>一句话总结：凡是跟UI相关的，都应该使用Activity做为Context来处理；其他的一些操作，Service,Activity,Application等实例都可以，当然了，注意Context引用的持有，防止内存泄漏。</p>
<h4 id="如何获取Context"><a href="#如何获取Context" class="headerlink" title="如何获取Context"></a>如何获取Context</h4><p>通常我们想要获取Context对象，主要有以下四种方法<br>1：View.getContext,返回当前View对象的Context对象，通常是当前正在展示的Activity对象。<br>2：Activity.getApplicationContext,获取当前Activity所在的(应用)进程的Context对象，通常我们使用Context对象时，要优先考虑这个全局的进程Context。<br>3：ContextWrapper.getBaseContext():用来获取一个ContextWrapper进行装饰之前的Context，可以使用这个方法，这个方法在实际开发中使用并不多，也不建议使用。<br>4：Activity.this 返回当前的Activity实例，如果是UI控件需要使用Activity作为Context对象，但是默认的Toast实际上使用ApplicationContext也可以。</p>
<h4 id="getApplication-和getApplicationContext"><a href="#getApplication-和getApplicationContext" class="headerlink" title="getApplication()和getApplicationContext()"></a>getApplication()和getApplicationContext()</h4><p>上面说到获取当前Application对象用getApplicationContext，不知道你有没有联想到getApplication()，这两个方法有什么区别？相信这个问题会难倒不少开发者。<br><img src="http://ww1.sinaimg.cn/large/adc90466ly1ffwao49ze7j20gv0cxdgp.jpg" alt="getApplication()&amp;getApplicationContext()"><br>程序是不会骗人的，我们通过上面的代码，打印得出两者的内存地址都是相同的，看来它们是同一个对象。其实这个结果也很好理解，因为前面已经说过了，Application本身就是一个Context，所以这里获取getApplicationContext()得到的结果就是Application本身的实例。那么问题来了，既然这两个方法得到的结果都是相同的，那么Android为什么要提供两个功能重复的方法呢？实际上这两个方法在作用域上有比较大的区别。getApplication()方法的语义性非常强，一看就知道是用来获取Application实例的，但是这个方法只有在Activity和Service中才能调用的到。那么也许在绝大多数情况下我们都是在Activity或者Service中使用Application的，但是如果在一些其它的场景，比如BroadcastReceiver中也想获得Application的实例，这时就可以借助getApplicationContext()方法了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public class MyReceiver extends BroadcastReceiver&#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    publicvoidonReceive(Contextcontext,Intentintent)&#123;</div><div class="line">        ApplicationmyApp=(Application)context.getApplicationContext();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Context引起的内存泄露"><a href="#Context引起的内存泄露" class="headerlink" title="Context引起的内存泄露"></a>Context引起的内存泄露</h4><p>但Context并不能随便乱用，用的不好有可能会引起内存泄露的问题，下面就示例两种错误的引用方式。</p>
<h5 id="错误的单例模式"><a href="#错误的单例模式" class="headerlink" title="错误的单例模式:"></a>错误的单例模式:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class Singleton &#123;</div><div class="line">    private static Singleton instance;</div><div class="line">    private Context mContext;</div><div class="line"></div><div class="line">    private Singleton(Context context) &#123;</div><div class="line">        this.mContext = context;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static Singleton getInstance(Context context) &#123;</div><div class="line">        <span class="keyword">if</span> (instance == null) &#123;</div><div class="line">            instance = new Singleton(context);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这是一个非线程安全的单例模式，instance作为静态对象，其生命周期要长于普通的对象，其中也包含Activity，假如Activity A去getInstance获得instance对象，传入this，常驻内存的Singleton保存了你传入的Activity A对象，并一直持有，即使Activity被销毁掉，但因为它的引用还存在于一个Singleton中，就不可能被GC掉，这样就导致了内存泄漏。</p>
<h5 id="View持有Activity引用"><a href="#View持有Activity引用" class="headerlink" title="View持有Activity引用:"></a>View持有Activity引用:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends Activity &#123;</div><div class="line">    private static Drawable mDrawable;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle saveInstanceState) &#123;</div><div class="line">        super.onCreate(saveInstanceState);</div><div class="line">        <span class="built_in">set</span>ContentView(R.layout.activity_main);</div><div class="line">        ImageView iv = new ImageView(this);</div><div class="line">        mDrawable = getResources().getDrawable(R.drawable.ic_launcher);</div><div class="line">        iv.setImageDrawable(mDrawable);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>有一个静态的Drawable对象当ImageView设置这个Drawable时，ImageView保存了mDrawable的引用，而ImageView传入的this是MainActivity的mContext，因为被static修饰的mDrawable是常驻内存的，MainActivity是它的间接引用，MainActivity被销毁时，也不能被GC掉，所以造成内存泄漏。</p>
<h4 id="正确使用Context"><a href="#正确使用Context" class="headerlink" title="正确使用Context"></a>正确使用Context</h4><p>一般Context造成的内存泄漏，几乎都是当Context销毁的时候，却因为被引用导致销毁失败，而Application的Context对象可以理解为随着进程存在的，所以我们总结出使用Context的正确姿势：<br>1：当Application的Context能搞定的情况下，并且生命周期长的对象，优先使用Application的Context。<br>2：不要让生命周期长于Activity的对象持有到Activity的引用。<br>3：尽量不要在Activity中使用非静态内部类，因为非静态内部类会隐式持有外部类实例的引用，如果使用静态内部类，将外部实例引用作为弱引用持有。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>总之Context在Android系统中的地位很重要，它几乎无所不能，但它也不是你想用就能随便用的，谨防使用不当引起的内存问题。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/24/ANDROID/BASE/05Intent概念及应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/24/ANDROID/BASE/05Intent概念及应用/" itemprop="url">05 Intent概念及应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-24T09:42:00+08:00">
                2017-05-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>启动Activity分为两种，显示调用和隐式调用。显示调用通过指定Intent组件名称来实现的，它一般用在知道目标组件名称的前提下，一般是在相同的应用程序内部实现的。隐式调用通过Intent Filter来实现的，它一般用在没有明确指出目标组件名称的前提下，一般是用于在不同应用程序之间。</p>
<h4 id="显示调用"><a href="#显示调用" class="headerlink" title="显示调用"></a>显示调用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent=new Intent(MainActivity.this,SettingActivity.class);</div><div class="line">intent.putExtra(EXTRA,contentEditText.getText().toString());</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure>
<p>而Manifest文件描述为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;activity android:name=<span class="string">".MainActivity"</span> &gt; </div><div class="line">    &lt;intent-filter&gt; </div><div class="line">        &lt;action android:name=<span class="string">"android.intent.action.MAIN"</span> /&gt; </div><div class="line">        &lt;category android:name=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt; </div><div class="line">    &lt;/intent-filter&gt; </div><div class="line">&lt;/activity&gt; </div><div class="line">&lt;activity android:name=<span class="string">".SettingActivity"</span> /&gt;</div></pre></td></tr></table></figure></p>
<h4 id="隐式调用"><a href="#隐式调用" class="headerlink" title="隐式调用"></a>隐式调用</h4><p>隐式不明确指定启动哪个Activity，而是在Intent Filter中设置Action、Data、Category，让系统来筛选出合适的Activity。清单文件配置如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</div><div class="line">&lt;manifest xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    package=<span class="string">"com.king.bester.myapplication"</span>&gt;</div><div class="line"></div><div class="line">    &lt;application</div><div class="line">        android:allowBackup=<span class="string">"true"</span></div><div class="line">        android:icon=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line">        android:supportsRtl=<span class="string">"true"</span></div><div class="line">        android:theme=<span class="string">"@style/AppTheme"</span>&gt;</div><div class="line">        &lt;activity android:name=<span class="string">".MainActivity"</span> &gt;</div><div class="line">            &lt;intent-filter&gt;</div><div class="line">                &lt;action android:name=<span class="string">"android.intent.action.MAIN"</span> /&gt;</div><div class="line">                &lt;category android:name=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</div><div class="line">            &lt;/intent-filter&gt;</div><div class="line">        &lt;/activity&gt;</div><div class="line"></div><div class="line">        &lt;activity</div><div class="line">            android:name=<span class="string">".TargetActivity"</span></div><div class="line">            android:launchMode=<span class="string">"singleTask"</span></div><div class="line">            android:taskAffinity=<span class="string">"com.king.bester.myapplication"</span> &gt;</div><div class="line">            &lt;intent-filter&gt;</div><div class="line">                &lt;action android:name=<span class="string">"android.intent.action.SEND"</span>/&gt;</div><div class="line">                &lt;category android:name=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</div><div class="line">                &lt;data android:mimeType=<span class="string">"text/plain"</span>/&gt;</div><div class="line">            &lt;/intent-filter&gt;</div><div class="line">            &lt;intent-filter&gt;</div><div class="line">                &lt;action android:name=<span class="string">"com.king.bester.demo"</span> /&gt;</div><div class="line">                &lt;action android:name=<span class="string">"com.king.bester.DEMO"</span> /&gt;</div><div class="line">                &lt;category android:name=<span class="string">"com.king.bester.a"</span> /&gt;</div><div class="line">                &lt;category android:name=<span class="string">"com.king.bester.b"</span> /&gt;</div><div class="line">                &lt;category android:name=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</div><div class="line">                &lt;data android:mimeType=<span class="string">"text/plain"</span>/&gt;</div><div class="line">            &lt;/intent-filter&gt;</div><div class="line">        &lt;/activity&gt;</div><div class="line">    &lt;/application&gt;</div><div class="line"></div><div class="line">&lt;/manifest&gt;</div></pre></td></tr></table></figure></p>
<p>代码调用：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 匹配第一组intent-filter</div><div class="line">public void startA(View view) &#123;</div><div class="line">    Intent intent = new Intent();</div><div class="line">    intent.setAction(<span class="string">"android.intent.action.SEND"</span>);</div><div class="line">    intent.setType(<span class="string">"text/plain"</span>);</div><div class="line">    startActivity(intent);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 匹配第二组intent-filter</div><div class="line">public void startB(View view) &#123;</div><div class="line">    Intent intent = new Intent();</div><div class="line">    intent.setAction(<span class="string">"com.king.bester.demo"</span>);</div><div class="line">    intent.addCategory(<span class="string">"com.king.bester.a"</span>);</div><div class="line">    intent.setType(<span class="string">"text/plain"</span>);</div><div class="line">    startActivity(intent);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>1、startA()中没有设置category，是因为系统在调用startActivity或者startActivityForResult的时候会默认为Intent加上“android.intent.category.DEFAULT”这个category。所以，为了我们的Activity能接收隐式调用，必须在intent-filter中指定这个category。<br>2、action区分大小写<br>3、一个Activity可以有多个intent-filter，一个intent只要能匹配任何一组intent-filter即可启动对应的Activity。</p>
<h4 id="浏览器启动本地App"><a href="#浏览器启动本地App" class="headerlink" title="浏览器启动本地App"></a>浏览器启动本地App</h4><p>Intent的过滤器：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;intent-filter&gt;</div><div class="line">    &lt;action android:name=<span class="string">"android.intent.action.VIEW"</span>/&gt;</div><div class="line">    &lt;category android:name=<span class="string">"android.intent.category.BROWSABLE"</span>/&gt;</div><div class="line">    &lt;category android:name=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</div><div class="line">    &lt;data android:scheme=<span class="string">"app"</span>/&gt;</div><div class="line">&lt;/intent-filter&gt;</div></pre></td></tr></table></figure></p>
<p>网页链接：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;a href=<span class="string">"app://hello"</span>&gt;Launch My App&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<p>代码获取网页传递过来的参数：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Uri uri = getIntent().getData();</div><div class="line">System.out.println(uri);</div></pre></td></tr></table></figure></p>
<p>输出：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app://hello</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/23/ANDROID/BASE/04Activity启动模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/23/ANDROID/BASE/04Activity启动模式/" itemprop="url">04 Activity启动模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-23T15:34:00+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ActivityManagerService（AMS）内部维护着一个ActivityStack栈，系统会将Activity实例一一放入栈内（先进后出），默认情况下创建一个实例压入栈内。如果多次创建同一个Activity，栈内将压入多个实例。为此，Android提供了启动模式来修改系统的默认行为。目前有四种启动模式：standard、singleTop、singleTask和singleInstance。</p>
<h2 id="一、代码"><a href="#一、代码" class="headerlink" title="一、代码"></a>一、代码</h2><p>BaseActivity:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">package com.xianxiaotao.launchmode;</div><div class="line"></div><div class="line">import android.content.Intent;</div><div class="line">import android.content.pm.ActivityInfo;</div><div class="line">import android.content.pm.PackageManager;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.support.v7.app.AppCompatActivity;</div><div class="line">import android.util.Log;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by xianxiaotao on 17/5/23.</div><div class="line"> *</div><div class="line"> * 基类：输出Activity实例信息及所属任务栈信息</div><div class="line"> */</div><div class="line"></div><div class="line">public class BaseActivity extends AppCompatActivity &#123;</div><div class="line">    private static final String TAG = <span class="string">"Xian Xiaotao"</span>;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">        // 区别类名，区别同类名是否同实例，区别任务栈</div><div class="line">        Log.i(TAG, <span class="string">"onCreate："</span> + getClass().getSimpleName() + <span class="string">" hasCode:"</span> + this.hashCode() + <span class="string">" TaskId: "</span> + getTaskId());</div><div class="line">        // 任务栈名称，默认为包名相关</div><div class="line">        dumpTaskAffinity();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onNewIntent(Intent intent) &#123;</div><div class="line">        super.onNewIntent(intent);</div><div class="line"></div><div class="line">        Log.i(TAG, <span class="string">"onNewIntent："</span> + getClass().getSimpleName() + <span class="string">" hasCode:"</span> + this.hashCode() + <span class="string">" TaskId: "</span> + getTaskId());</div><div class="line">        dumpTaskAffinity();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    protected void <span class="function"><span class="title">dumpTaskAffinity</span></span>()&#123;</div><div class="line">        try &#123;</div><div class="line">            ActivityInfo info = this.getPackageManager().getActivityInfo(getComponentName(), PackageManager.GET_META_DATA);</div><div class="line">            Log.i(TAG, <span class="string">"taskAffinity:"</span> + info.taskAffinity);</div><div class="line">        &#125; catch (PackageManager.NameNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>MainActivity:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">package com.xianxiaotao.launchmode;</div><div class="line"></div><div class="line">import android.content.Intent;</div><div class="line">import android.support.v7.app.AppCompatActivity;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.view.View;</div><div class="line"></div><div class="line">public class MainActivity extends BaseActivity &#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        <span class="built_in">set</span>ContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        findViewById(R.id.startMainButton).setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                startActivity(new Intent(MainActivity.this, MainActivity.class));</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        findViewById(R.id.startOtherButton).setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                startActivity(new Intent(MainActivity.this, OtherActivity.class));</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>OtherActivity:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">package com.xianxiaotao.launchmode;</div><div class="line"></div><div class="line">import android.content.Intent;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.view.View;</div><div class="line"></div><div class="line">public class OtherActivity extends BaseActivity &#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        <span class="built_in">set</span>ContentView(R.layout.activity_other);</div><div class="line"></div><div class="line">        findViewById(R.id.startMainButton).setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                startActivity(new Intent(OtherActivity.this, MainActivity.class));</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        findViewById(R.id.startOtherButton).setOnClickListener(new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                startActivity(new Intent(OtherActivity.this, OtherActivity.class));</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>布局文件activity_main.xml，activity_other.xml文件与此类似<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</div><div class="line">&lt;LinearLayout</div><div class="line">    xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    android:id=<span class="string">"@+id/activity_main"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"match_parent"</span></div><div class="line">    android:orientation=<span class="string">"vertical"</span> &gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:text=<span class="string">"This is main activity"</span>/&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=<span class="string">"@+id/startMainButton"</span></div><div class="line">        android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:textAllCaps=<span class="string">"false"</span></div><div class="line">        android:text=<span class="string">"Start Main Activity"</span>/&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=<span class="string">"@+id/startOtherButton"</span></div><div class="line">        android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">        android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">        android:textAllCaps=<span class="string">"false"</span></div><div class="line">        android:text=<span class="string">"Start Other Activity"</span>/&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<h2 id="二、测试"><a href="#二、测试" class="headerlink" title="二、测试"></a>二、测试</h2><h4 id="1、standard"><a href="#1、standard" class="headerlink" title="1、standard"></a>1、standard</h4><p>两个Activity都没有设置启动模式，即默认为标准模式。然后启动App，点击Start Main Activity按钮，然后再点击Start Other Activity按钮，然后再点击Start Main Activity。日志输出如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">I/Xian Xiaotao: onCreate：MainActivity hasCode:110059330 TaskId: 523</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div><div class="line">I/Xian Xiaotao: onCreate：MainActivity hasCode:250944109 TaskId: 523</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div><div class="line">I/Xian Xiaotao: onCreate：OtherActivity hasCode:39080781 TaskId: 523</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div><div class="line">I/Xian Xiaotao: onCreate：MainActivity hasCode:42988356 TaskId: 523</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div></pre></td></tr></table></figure></p>
<p>上述日志中所有的hashCode都不相同，即每次启动Activity都创建一个新的实例。连续按四次返回键退出应用。<br>TaskId都相同，表明这些实例都在同一个任务栈里。</p>
<h4 id="2、singleTop"><a href="#2、singleTop" class="headerlink" title="2、singleTop"></a>2、singleTop</h4><p>在AndroidMainfest.xml文件中，为MainActivity添加属性：android:launchMode=”singleTop”。启动App、点击Start Main Activity按钮、再点击Start Other Activity按钮，再点击Start Main Activity。日志输出如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">I/Xian Xiaotao: onCreate：MainActivity hasCode:29797800 TaskId: 525</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div><div class="line">I/Xian Xiaotao: onNewIntent：MainActivity hasCode:29797800 TaskId: 525</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div><div class="line">I/Xian Xiaotao: onCreate：OtherActivity hasCode:42572600 TaskId: 525</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div><div class="line">I/Xian Xiaotao: onCreate：MainActivity hasCode:97104763 TaskId: 525</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div></pre></td></tr></table></figure></p>
<p>第一次点击Start Main Activity按钮时，调用了onNewIntent方法，且hashCode与之前的MainActivity实例的hashCode相同，即复用实例而不是重新创建。第二次点击Start Main Activity按钮时，也就是说从OtherActivity里启动MainActivity，此时调用了onCreate方法，而且hashCode与之前的不相同，即重新创建了MainActivity的实例。连续按三次返回键退出应用。<br>TaskId都相同，表明这些实例都在同一个任务栈里。</p>
<h4 id="3、singleTask"><a href="#3、singleTask" class="headerlink" title="3、singleTask"></a>3、singleTask</h4><p>将MainActivity设置为singleTop，然后执行之前相同的动作。日志输出如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">I/Xian Xiaotao: onCreate：MainActivity hasCode:29797800 TaskId: 527</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div><div class="line">I/Xian Xiaotao: onNewIntent：MainActivity hasCode:29797800 TaskId: 527</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div><div class="line">I/Xian Xiaotao: onCreate：OtherActivity hasCode:121783201 TaskId: 527</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div><div class="line">I/Xian Xiaotao: onNewIntent：MainActivity hasCode:29797800 TaskId: 527</div><div class="line">I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode</div></pre></td></tr></table></figure></p>
<p>此时发现MainActivity的实例都相同，即第一次创建后，后面的都是复用实例而不是重新创建。按一次返回键退出应用。<br>TaskId都相同，表明这些实例都在同一个任务栈里。</p>
<h4 id="4、singleInstance"><a href="#4、singleInstance" class="headerlink" title="4、singleInstance"></a>4、singleInstance</h4><p>将MainActivity设置为singleInstance，然后执行之前相同的动作。日志输出如下：<br>I/Xian Xiaotao: onCreate：MainActivity hasCode:29797800 TaskId: 529<br>I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode<br>I/Xian Xiaotao: onNewIntent：MainActivity hasCode:29797800 TaskId: 529<br>I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode<br>I/Xian Xiaotao: onCreate：OtherActivity hasCode:42572600 TaskId: 530<br>I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode<br>I/Xian Xiaotao: onNewIntent：MainActivity hasCode:29797800 TaskId: 529<br>I/Xian Xiaotao: taskAffinity:com.xianxiaotao.launchmode<br>此时发现MainActivity的实例依然相同，即第一次创建后，后面的都是复用实例而不是重新创建。按两次返回键退出应用。<br>TaskId不同，即MainActivity与OtherActivity不在一个Activity中。</p>
<blockquote>
<p>读者可以通过多个Activity设置不同的启动模式进行复杂的测试。</p>
</blockquote>
<h2 id="三、结论"><a href="#三、结论" class="headerlink" title="三、结论"></a>三、结论</h2><h4 id="standard"><a href="#standard" class="headerlink" title="standard"></a>standard</h4><p>标准模式，也是系统默认模式。每次启动一个Activity都会重新创建一个新的实例，不管这个实例是否已经存在。谁启动了这个Activity，那么这个Activity就运行在启动它的那个Activity所在的栈中。ABCBB</p>
<h4 id="singleTop"><a href="#singleTop" class="headerlink" title="singleTop"></a>singleTop</h4><p>栈顶复用模式。如果新Activity已经位于任务栈的栈顶，那么只调用它的onNewIntent方法实现复用，而不会创建新的实例。如果新的Activity的实例已存在但不是位于栈顶，仍然重新创建。假设目前栈内情况为ABCD（ABCD为四个Activity，A位于栈底），此时再次启动，如果D的启动模式为singleTop，那么栈内仍然是ABCD；如果D的启动模式为standard，D将被重新创建，栈内情况变为ABCDD。</p>
<h4 id="singleTask"><a href="#singleTask" class="headerlink" title="singleTask"></a>singleTask</h4><p>栈内复用模式。在同一个栈内，它是单实例模式。在这种模式下，启动一个Activity A，系统首先会寻找是否存在A想要的任务栈，如果不存在，就重新创建一个任务栈，然后创建A的实例并压入栈内；如果存在所需的任务栈，这时要看A是否在栈中有实例存在，如果有，那么系统就会把A调到栈顶并调用它的onNewIntent方法，不存在就创建并压入栈中。<br>1、目前任务栈栈S1(ABC)，此时Activity D以singleTask模式请求启动，其所需的任务栈为S2，由于S2和D的实例均不存在，所以系统先创建任务栈S2，然后再创建D的实例并将其放入栈S2中。<br>2、另外一种情况，假设D所需的任务栈为S1，上述S1已存在，所以系统会直接创建D的实例并压入栈S1内。<br>3、如果D所需的任务栈为S1，其中为ADBC，此时系统将D上面的Activity出栈，把D切换到栈顶并调用onNewIntent方法，最终S1栈内为AD。</p>
<h4 id="singleInstance："><a href="#singleInstance：" class="headerlink" title="singleInstance："></a>singleInstance：</h4><p>该模式具备singleTask模式的所有特性外，与它的区别就是，这种模式下的Activity会单独占用一个Task栈，具有全局唯一性，即整个系统中就这么一个实例，由于栈内复用的特性，后续的请求均不会创建新的Activity实例，除非这个特殊的任务栈被销毁了。以singleInstance模式启动的Activity在整个系统中是单例的，如果在启动这样的Activiyt时，已经存在了一个实例，那么会把它所在的任务调度到前台，重用这个实例。</p>
<p><a href="http://blog.csdn.net/mynameishuangshuai/article/details/51491074" target="_blank" rel="external">启动模式参考博客</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/23/ANDROID/BASE/03Activity之间传递参数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/23/ANDROID/BASE/03Activity之间传递参数/" itemprop="url">03 Activity之间传递参数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-23T13:32:00+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="一、传递简单数据"><a href="#一、传递简单数据" class="headerlink" title="一、传递简单数据"></a>一、传递简单数据</h4><p>发送数据：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = new Intent(MainActivity.this, OtherActivity.class);</div><div class="line">intent.putExtra(<span class="string">"data"</span>, <span class="string">"data value"</span>);</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p>接受数据：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String data = getIntent().getStringExtra(<span class="string">"data"</span>);</div><div class="line">textView.setText(data);</div></pre></td></tr></table></figure></p>
<p>优化代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">// 传递参数</div><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        <span class="built_in">set</span>ContentView(R.layout.activity_main);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void sendArgs(View view) &#123;</div><div class="line">        Intent intent = OtherActivity.newIntent(this, <span class="string">"data value"</span>);</div><div class="line">        startActivity(intent);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 接受参数</div><div class="line">public class OtherActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private static final String ARG = <span class="string">"data"</span>;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        <span class="built_in">set</span>ContentView(R.layout.activity_other);</div><div class="line"></div><div class="line">        TextView textView = (TextView) findViewById(R.id.tv);</div><div class="line">        String data = getIntent().getStringExtra(ARG);</div><div class="line">        textView.setText(data);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 解除参数名称<span class="string">"data"</span>带来的依赖性</div><div class="line">    public static Intent newIntent(Context context, String data) &#123;</div><div class="line">        Intent intent = new Intent(context, OtherActivity.class);</div><div class="line">        intent.putExtra(ARG, data);</div><div class="line">        <span class="built_in">return</span> intent;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="二、传递数据包Bundle"><a href="#二、传递数据包Bundle" class="headerlink" title="二、传递数据包Bundle"></a>二、传递数据包Bundle</h4><p>发送数据包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Intent intent = new Intent(MainActivity.this, OtherActivity.class);</div><div class="line">Bundle bundle = new Bundle();</div><div class="line">bundle.putString(<span class="string">"name"</span>, <span class="string">"xian xiaotao"</span>);</div><div class="line">bundle.putInt(<span class="string">"age"</span>, 28);</div><div class="line">intent.putExtras(bundle);</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p>接受数据包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Bundle data = getIntent().getExtras();</div><div class="line">textView.setText(String.format(Locale.getDefault(), <span class="string">"name=%s,age=%d"</span>, data.getString(<span class="string">"name"</span>), data.getInt(<span class="string">"age"</span>)));</div></pre></td></tr></table></figure></p>
<h4 id="三、传递值对象"><a href="#三、传递值对象" class="headerlink" title="三、传递值对象"></a>三、传递值对象</h4><p>实现Parcelable<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">import android.os.Parcel;</div><div class="line">import android.os.Parcelable;</div><div class="line"></div><div class="line">public class User implements Parcelable &#123;</div><div class="line">    private String mName;</div><div class="line">    private int mAge;</div><div class="line"></div><div class="line">    public User(String name, int age) &#123;</div><div class="line">        mName = name;</div><div class="line">        mAge = age;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String <span class="function"><span class="title">getName</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> mName;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void <span class="built_in">set</span>Name(String name) &#123;</div><div class="line">        mName = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public int <span class="function"><span class="title">getAge</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> mAge;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void <span class="built_in">set</span>Age(int age) &#123;</div><div class="line">        mAge = age;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int <span class="function"><span class="title">describeContents</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void writeToParcel(Parcel dest, int flags) &#123;</div><div class="line">        // 更复杂的数据借用Bundle</div><div class="line">        dest.writeString(getName());</div><div class="line">        dest.writeInt(getAge());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static final Creator&lt;User&gt; CREATOR = new Creator&lt;User&gt;() &#123;</div><div class="line">        @Override</div><div class="line">        public User createFromParcel(Parcel <span class="built_in">source</span>) &#123;</div><div class="line">            <span class="built_in">return</span> new User(source.readString(), source.readInt());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public User[] newArray(int size) &#123;</div><div class="line">            <span class="built_in">return</span> new User[size];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>传递参数：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = new Intent(MainActivity.this, OtherActivity.class);</div><div class="line">intent.putExtra(<span class="string">"user"</span>, new User(<span class="string">"xian xiaotao"</span>, 28));</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p>接收参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">User user = getIntent().getParcelableExtra(<span class="string">"user"</span>);</div><div class="line">textView.setText(String.format(Locale.getDefault(), <span class="string">"name=%s,age=%d"</span>, user.getName(), user.getAge()));</div></pre></td></tr></table></figure></p>
<blockquote>
<p>Serializable的作用是为了保存对象的属性到本地文件、数据库、网络流、rmi以方便数据传输，当然这种传输可以是程序内的也可以是两个程序间的。而Android的Parcelable的设计初衷是因为Serializable效率过慢，为了在程序内不同组件间以及不同Android程序间(AIDL)高效的传输数据而设计，这些数据仅在内存中存在，Parcelable是通过IBinder通信的消息的载体。<br>Parcelable的性能比Serializable好，在内存开销方面较小，所以在内存间数据传输时推荐使用Parcelable，如activity间传输数据，而Serializable可将数据持久化方便保存，所以在需要保存或网络传输数据时选择Serializable，因为android不同版本Parcelable可能不同，所以不推荐使用Parcelable进行数据持久化</p>
</blockquote>
<h4 id="四、获取Activity返回参数"><a href="#四、获取Activity返回参数" class="headerlink" title="四、获取Activity返回参数"></a>四、获取Activity返回参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">public class QuizActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">	private static final int REQUEST_CODE_CHEAT = 0;</div><div class="line"></div><div class="line">	... </div><div class="line"></div><div class="line">	// startActivityForResult代码</div><div class="line">	Intent i = CheatActivity.newIntent(QuizActivity.this, answerIsTrue);</div><div class="line">    startActivityForResult(i, REQUEST_CODE_CHEAT);</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onActivityResult(int requestCode, int resultCode, Intent data) &#123;</div><div class="line">        <span class="keyword">if</span> (resultCode != Activity.RESULT_OK)</div><div class="line">            <span class="built_in">return</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (requestCode == REQUEST_CODE_CHEAT) &#123;</div><div class="line">            <span class="keyword">if</span> (data == null)</div><div class="line">                <span class="built_in">return</span>;</div><div class="line">            mIsCheater = CheatActivity.wasAnswerShown(data);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class CheatActivity extends AppCompatActivity &#123;</div><div class="line">	private static final String EXTRA_ANSWER_SHOWN = <span class="string">"com.xxtking.geoquiz.CheatActivity.answer_shown"</span>;</div><div class="line"></div><div class="line">	...</div><div class="line"></div><div class="line">	private void <span class="built_in">set</span>AnswerShownResult(boolean isAnswerShown) &#123;</div><div class="line">        Intent data = new Intent();</div><div class="line">        data.putExtra(EXTRA_ANSWER_SHOWN, isAnswerShown);</div><div class="line">        <span class="built_in">set</span>Result(RESULT_OK, data);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	public static boolean wasAnswerShown(Intent result) &#123;</div><div class="line">        <span class="built_in">return</span> result.getBooleanExtra(EXTRA_ANSWER_SHOWN, <span class="literal">false</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/23/ANDROID/BASE/02Activity生命周期/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/23/ANDROID/BASE/02Activity生命周期/" itemprop="url">02 Activity生命周期</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-23T11:33:00+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>整个生命周期来说，成对出现的。onCreate和onDestroy是成对的，代表着创建与销毁；onStart和onStop表示Activity对于程序是否可见（后台）；onResume和onPause表示Activity对于用户是否可见（前台）。</p>
<p><img src="http://ww1.sinaimg.cn/large/adc90466gy1fcptk0wnt2j20e90ifmz4" alt=""></p>
<h2 id="正常生命周期"><a href="#正常生命周期" class="headerlink" title="正常生命周期"></a>正常生命周期</h2><h4 id="1、初次启动Activity"><a href="#1、初次启动Activity" class="headerlink" title="1、初次启动Activity"></a>1、初次启动Activity</h4><p>onCreate -&gt; onStart -&gt; onResume</p>
<h4 id="2、界面显示时按了返回键"><a href="#2、界面显示时按了返回键" class="headerlink" title="2、界面显示时按了返回键"></a>2、界面显示时按了返回键</h4><p>onPause -&gt; onStop -&gt; onDestroy</p>
<h4 id="3、界面显示时按了Home键"><a href="#3、界面显示时按了Home键" class="headerlink" title="3、界面显示时按了Home键"></a>3、界面显示时按了Home键</h4><p>onPause -&gt; onStop</p>
<h4 id="4、Home键之后再次启动"><a href="#4、Home键之后再次启动" class="headerlink" title="4、Home键之后再次启动"></a>4、Home键之后再次启动</h4><p>onRestart -&gt; onStart -&gt; onResume</p>
<h4 id="5、界面显示时按了锁屏键及解锁"><a href="#5、界面显示时按了锁屏键及解锁" class="headerlink" title="5、界面显示时按了锁屏键及解锁"></a>5、界面显示时按了锁屏键及解锁</h4><p>锁屏：onPause -&gt; onStop<br>解锁：onRestart -&gt; onStart -&gt; onResume</p>
<h4 id="6、从A-Activity启动-B-Activity"><a href="#6、从A-Activity启动-B-Activity" class="headerlink" title="6、从A Activity启动 B Activity"></a>6、从A Activity启动 B Activity</h4><p>A onPause -&gt; B onCreate -&gt; B onStart -&gt; B onResume -&gt; A onStop<br>返回：B onPause -&gt; A onRestart -&gt; A onStart -&gt; A onResume -&gt; B onStop -&gt; B onDestroy</p>
<h4 id="7、从A-Activity启动-B-Activity-android-theme-”-style-Base-Theme-AppCompat-Dialog”"><a href="#7、从A-Activity启动-B-Activity-android-theme-”-style-Base-Theme-AppCompat-Dialog”" class="headerlink" title="7、从A Activity启动 B Activity (android:theme=”@style/Base.Theme.AppCompat.Dialog”)"></a>7、从A Activity启动 B Activity (android:theme=”@style/Base.Theme.AppCompat.Dialog”)</h4><p>A onPause -&gt; B onCreate -&gt; B onStart -&gt; B onResume<br>返回：B onPause -&gt; A onResume -&gt; B onStop -&gt; B onDestroy</p>
<h2 id="切换横竖屏幕"><a href="#切换横竖屏幕" class="headerlink" title="切换横竖屏幕"></a>切换横竖屏幕</h2><p>targetSdkVersion 25，没有设置android:configChanges：<br>1、竖屏切横屏：onConfigurationChanged() -&gt; onPause() -&gt; onSaveInstanceState() -&gt; onStop() -&gt; onDestroy() -&gt; onCreate() -&gt; onStart() -&gt; onRestoreInstanceState() -&gt; onResume()<br>2、横屏切竖屏：onConfigurationChanged() -&gt; onPause() -&gt; onSaveInstanceState() -&gt; onStop() -&gt; onDestroy() -&gt; onCreate() -&gt; onStart() -&gt; onRestoreInstanceState() -&gt; onResume()</p>
<blockquote>
<p>本人使用的是模拟器（minSdkVersion 16 / targetSdkVersion 25）测试，无论是否设置Activity的android:configChanges，或者属性值设为orientation或orientation|keyboardHidden，无论是竖屏切横屏还是横屏切竖屏，流程都如上所述，当android:configChanges=”orientation|keyboardHidden|screenSize”时，只会调用onConfigurationChanged()。经过查资料，android:targetSdkVersion这个属性会影响横竖屏切换的生命周期。<a href="http://www.cnblogs.com/xiaoQLu/p/3324503.html" target="_blank" rel="external">详见xiaoQLud的博客</a></p>
</blockquote>
<h2 id="异常生命周期"><a href="#异常生命周期" class="headerlink" title="异常生命周期"></a>异常生命周期</h2><p>1、系统配置发生改变后，默认情况下Activity会被销毁然后重新创建，生命周期参考横竖屏切换。常用的系统配置只有local、orientation和keyboardHidden。<br>2、资源内存不足导致低优先级的Activity被杀死，生命周期参考横竖屏切换。<br>3、运行时发生了异常，程序直接崩溃。例如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (int i = 10; i &gt;= 0; i++)</div><div class="line">    System.out.println(10 / i)</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/23/ANDROID/BASE/01环境搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/23/ANDROID/BASE/01环境搭建/" itemprop="url">01 环境搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-23T10:24:00+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、JDK"><a href="#一、JDK" class="headerlink" title="一、JDK"></a>一、JDK</h2><p>1、<a href="https://www.oracle.com/index.html" target="_blank" rel="external">https://www.oracle.com/index.html</a><br>2、Menu -&gt; Downloads -&gt; Java -&gt; All Java Downloads -&gt; Java SE Downloads<br>3、<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a><br>4、JDK DOWNLOAD</p>
<h2 id="二、Mac平台搭建集成开发环境"><a href="#二、Mac平台搭建集成开发环境" class="headerlink" title="二、Mac平台搭建集成开发环境"></a>二、Mac平台搭建集成开发环境</h2><p>1、<a href="https://www.android.com/" target="_blank" rel="external">https://www.android.com/</a><br>2、底部 -&gt; DEVELOPERS -&gt; App Developer Resources -&gt; DEVELOP<br>3、获取Android Studio （<a href="https://developer.android.com/studio/index.html）" target="_blank" rel="external">https://developer.android.com/studio/index.html）</a><br>4、下载 ANDROID STUDIO FOR MAC</p>
<h2 id="三、Windows平台搭建"><a href="#三、Windows平台搭建" class="headerlink" title="三、Windows平台搭建"></a>三、Windows平台搭建</h2><p>1、在Windows平台上，按照Mac平台搭建环境的步骤进行下载即可</p>
<h2 id="四、Linux平台搭建"><a href="#四、Linux平台搭建" class="headerlink" title="四、Linux平台搭建"></a>四、Linux平台搭建</h2><p>1、在Linux平台上，按照Mac平台搭建环境的步骤进行下载即可<br>2、解压到opt目录下：sudo mv android-studio /opt/<br>3、输入密码<br>4、命令行：cd /opt/android-studio/bin/<br>5、命令行：./studio.sh<br>6、安装失败则需要下载解压JDK文件，与上述步骤雷同<br>7、配置JDK路径：sudo nano /etc/profile<br>8、文件末尾添加：export JDK_HOME=/opt/jdk1.8.0_40<br>9、退出保存并立即生效：source /etc/profile<br>10、验证：echo $JDK_HOME<br>11、重新安装：./studio.sh</p>
<p><a href="http://stormzhang.com/devtools/2014/11/25/android-studio-tutorial1/" target="_blank" rel="external">大神的下载安装教程</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/13/ANDROID/Note 研发录之重构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/13/ANDROID/Note 研发录之重构/" itemprop="url">Note | 研发录之重构</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-13T10:24:07+08:00">
                2017-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、重构项目结构"><a href="#一、重构项目结构" class="headerlink" title="一、重构项目结构"></a>一、重构项目结构</h2><h4 id="Step-1-自定义业务无关的基础类库"><a href="#Step-1-自定义业务无关的基础类库" class="headerlink" title="Step 1. 自定义业务无关的基础类库"></a>Step 1. 自定义业务无关的基础类库</h4><ul>
<li>com.baselib.activity: 封装业务无关的公用逻辑，如后面的BaseActivity代码</li>
<li>com.baselib.cache: 缓存数据和图片的处理</li>
<li>com.baselib.net: 网络底层封装库</li>
<li>com.baselib.ui: 自定义控件</li>
<li>com.baselib.utils: 业务无关的公用方法</li>
</ul>
<h4 id="Step-2-实际项目中类进行归类划分"><a href="#Step-2-实际项目中类进行归类划分" class="headerlink" title="Step 2. 实际项目中类进行归类划分"></a>Step 2. 实际项目中类进行归类划分</h4><ul>
<li>com.myapp.activity: 所有的Activity，其他三大组件同样如此</li>
<li>com.myapp.adapter: 所有的适配器</li>
<li>com.myapp.entity: 实体类</li>
<li>com.myapp.db: SQLite相关的逻辑封装</li>
<li>com.myapp.engine: 业务相关的类</li>
<li>com.myapp.ui: 自定义控件</li>
<li>com.myapp.utils: 工具类</li>
<li>com.myapp.interfaces: 接口，以I作为开头</li>
<li>com.myapp.listener: 基于Listener的接口，命名以On作为开头</li>
</ul>
<h2 id="二、Activity-模板"><a href="#二、Activity-模板" class="headerlink" title="二、Activity 模板"></a>二、Activity 模板</h2><h4 id="1-com-baselib-activity-BaseActivity"><a href="#1-com-baselib-activity-BaseActivity" class="headerlink" title="1. com.baselib.activity.BaseActivity"></a>1. com.baselib.activity.BaseActivity</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public abstract class BaseActivity extends Activity &#123;</div><div class="line">	</div><div class="line">    @Override</div><div class="line">    public void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">        initVariables();</div><div class="line">        initViews(savedInstanceState);</div><div class="line">        loadData();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 初始化变量，包括Intent带的数据和Activity内的变量</div><div class="line">    protected abstract void initVariables();</div><div class="line">    // 加载layout布局文件，初始化控件，为控件挂上事件方法</div><div class="line">    protected abstract void initViews(Bundle savedInstanceState);</div><div class="line">    // 获取数据</div><div class="line">    protected abstract void loadData();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-com-myapp-activity-LoginActivity"><a href="#2-com-myapp-activity-LoginActivity" class="headerlink" title="2. com.myapp.activity.LoginActivity"></a>2. com.myapp.activity.LoginActivity</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">public class LoginActivity extends BaseActivity &#123;</div><div class="line">    private int loginTimes;</div><div class="line">    private String strEmail;</div><div class="line"></div><div class="line">    private EditText etPassword;</div><div class="line">    private EditText etEmail;</div><div class="line">    private Button btnLogin;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void <span class="function"><span class="title">initVariables</span></span>() &#123;</div><div class="line">        loginTimes = -1;</div><div class="line"></div><div class="line">        Bundle bundle = getIntent().getExtras();</div><div class="line">        strEmail = bundle.getString(AppConstants.Email);	</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    protected void initViews(Bundle savedInstanceState) &#123;</div><div class="line">        <span class="built_in">set</span>ContentView(R.layout.activity_login);</div><div class="line"></div><div class="line">        etEmail = (EditText) findViewById(R.id.email);</div><div class="line">        etEmail.setText(strEmail);</div><div class="line">        etPassword = (EditText) findViewById(R.id.password);</div><div class="line"></div><div class="line">        // 登录事件</div><div class="line">        btnLogin = (Button) findViewById(R.id.sign_in_button);</div><div class="line">        btnLogin.setOnClickListener(</div><div class="line">            new View.<span class="function"><span class="title">OnClickListener</span></span>() &#123;</div><div class="line">                @Override</div><div class="line">                public void onClick(View v) &#123;</div><div class="line">                    gotoLoginActivity();</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void <span class="function"><span class="title">gotoLoginActivity</span></span>() &#123;</div><div class="line">        startActivity(new Intent(LoginActivity.this, PersonCenterActivity.class));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void <span class="function"><span class="title">loadData</span></span>() &#123;</div><div class="line">        loadWeatherData();</div><div class="line">        loadCityData();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="三、Adapter-模板"><a href="#三、Adapter-模板" class="headerlink" title="三、Adapter 模板"></a>三、Adapter 模板</h2><h4 id="com-myapp-adapter-WeatherAdapter"><a href="#com-myapp-adapter-WeatherAdapter" class="headerlink" title="com.myapp.adapter.WeatherAdapter"></a>com.myapp.adapter.WeatherAdapter</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">public class WeatherAdapter extends BaseAdapter &#123;</div><div class="line">    private final ArrayList&lt;WeatherInfo&gt; weatherList;</div><div class="line">    private final BaseActivity context;</div><div class="line"></div><div class="line">    public WeatherAdapter(ArrayList&lt;WeatherInfo&gt; weatherList, BaseActivity context) &#123;</div><div class="line">        this.weatherList = weatherList;</div><div class="line">        this.context = context;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public int <span class="function"><span class="title">getCount</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> weatherList.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public WeatherInfo getItem(final int position) &#123;</div><div class="line">        <span class="built_in">return</span> weatherList.get(position);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public long getItemId(final int position) &#123;</div><div class="line">        <span class="built_in">return</span> position;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public View getView(final int position, View convertView, final ViewGroup parent) &#123;</div><div class="line">        final Holder holder;</div><div class="line">        <span class="keyword">if</span> (convertView == null) &#123;</div><div class="line">            holder = new Holder();</div><div class="line">            convertView = context.getLayoutInflater().inflate(R.layout.item_weatherlist, null);</div><div class="line">            holder.tvCity = (TextView) convertView.findViewById(R.id.tvCity);</div><div class="line">            convertView.setTag(holder);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">        	holder = (Holder) convertView.getTag();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        WeatherInfo weatherInfo = weatherList.get(position);</div><div class="line">        holder.tvCity.setText(weatherInfo.getCity());</div><div class="line">        <span class="built_in">return</span> convertView;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    class Holder &#123;</div><div class="line">        TextView tvCity;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ListDemoActivity-onCreate"><a href="#ListDemoActivity-onCreate" class="headerlink" title="ListDemoActivity.onCreate()"></a>ListDemoActivity.onCreate()</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">lvWeatherList = (ListView) findViewById(R.id.lvWeatherlist);</div><div class="line">WeatherAdapter adapter = new WeatherAdapter(weatherList, ListDemoActivity.this);</div><div class="line">lvWeatherList.setAdapter(adapter);</div><div class="line">lvWeatherList.setOnItemClickListener(</div><div class="line">    new AdapterView.<span class="function"><span class="title">OnItemClickListener</span></span>() &#123;</div><div class="line">        @Override</div><div class="line">        public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123;</div><div class="line">            // <span class="keyword">do</span> something...</div><div class="line">        &#125;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<h2 id="四、实体化编程"><a href="#四、实体化编程" class="headerlink" title="四、实体化编程"></a>四、实体化编程</h2><h4 id="1-JSON-数据"><a href="#1-JSON-数据" class="headerlink" title="1. JSON 数据"></a>1. JSON 数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="string">"weatherinfo"</span>:&#123;</div><div class="line">    <span class="string">"city"</span>:<span class="string">"北京"</span>,</div><div class="line">    <span class="string">"cityid"</span>:<span class="string">"101010100"</span>,</div><div class="line">    <span class="string">"temp"</span>:<span class="string">"24"</span>,</div><div class="line">    <span class="string">"WD"</span>:<span class="string">"南风"</span>,</div><div class="line">    <span class="string">"SD"</span>:<span class="string">"74%"</span>,</div><div class="line">    <span class="string">"time"</span>:<span class="string">"17:45"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-生成实体类"><a href="#2-生成实体类" class="headerlink" title="2. 生成实体类"></a>2. 生成实体类</h4><p>可以使用插件，也可以使用公开的工具，如<a href="http://files.cnblogs.com/Jax/EntityGenerator.zip" target="_blank" rel="external">包建强提供的实体生成器下载地址</a><br><img src="http://ww1.sinaimg.cn/large/adc90466ly1fel1oooznaj20qh0hw74g.jpg" alt=""></p>
<h4 id="3-序列化"><a href="#3-序列化" class="headerlink" title="3. 序列化"></a>3. 序列化</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class Weatherinfo implements Serializable &#123;</div><div class="line">    private static final long serialVersionUID = 1L;</div><div class="line"></div><div class="line">    private String city;</div><div class="line">    private String cityid;</div><div class="line">    private String temp;</div><div class="line">    private String WD;</div><div class="line">    private String SD;</div><div class="line">    private String time;</div><div class="line"></div><div class="line">    public String <span class="function"><span class="title">getCity</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> city;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void <span class="built_in">set</span>City(String city) &#123;</div><div class="line">        this.city = city;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="4-fastJSON"><a href="#4-fastJSON" class="headerlink" title="4. fastJSON"></a>4. fastJSON</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">WeatherEntity weatherEntity = JSON.parseObject(jsonContent, WeatherEntity.class);</div><div class="line">WeatherInfor weatherInfor = weatherEntity.getWeatherInfo();</div><div class="line"><span class="keyword">if</span> (weatherInfor != null) &#123;</div><div class="line">    tvCity.setText(weatherInfo.getCity());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果使用崩溃，试下在混淆文件中加以下两行:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-keepattributes Signature     // 避免混淆泛型</div><div class="line">-keepattributes *Annotation*  // 不混淆注解</div></pre></td></tr></table></figure></p>
<h4 id="5-传递"><a href="#5-传递" class="headerlink" title="5. 传递"></a>5. 传递</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">intent.putExtra(AppContants.Weather, weatherInfo);</div></pre></td></tr></table></figure>
<h2 id="五、类型安全转换函数"><a href="#五、类型安全转换函数" class="headerlink" title="五、类型安全转换函数"></a>五、类型安全转换函数</h2><h4 id="valueOf-NaN"><a href="#valueOf-NaN" class="headerlink" title="valueOf"></a>valueOf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public final static int convertToInt(Object value, int defaultValue) &#123;</div><div class="line">    <span class="keyword">if</span> (value == null || <span class="string">""</span>.equals(value.toString().trim())) &#123;</div><div class="line">        <span class="built_in">return</span> defaultValue;</div><div class="line">    &#125;</div><div class="line">    try &#123;</div><div class="line">        <span class="built_in">return</span> Integer.valueOf(value.toString());</div><div class="line">    &#125; catch (Exception e) &#123;</div><div class="line">        try &#123;</div><div class="line">            <span class="built_in">return</span> Double.valueOf(value.toString()).intValue();</div><div class="line">        &#125; catch (Exception e) &#123;</div><div class="line">            <span class="built_in">return</span> defaultValue;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="substring"><a href="#substring" class="headerlink" title="substring"></a>substring</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">String cityName = <span class="string">"T"</span>;</div><div class="line">String firstLetter = <span class="string">""</span>;</div><div class="line"><span class="keyword">if</span> (cityName.length() &gt; 1) &#123;</div><div class="line">    firstLetter = cityName.substring(1, 2);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">78</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
