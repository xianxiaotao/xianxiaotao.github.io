<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="King">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="King">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="King">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>King</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">King</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">xianxiaotao</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/05/Custom View/05.1 精通自定义 View 之动画进阶（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/05/Custom View/05.1 精通自定义 View 之动画进阶（一）/" itemprop="url">05.1 精通自定义 View 之动画进阶（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-05T01:00:00+08:00">
                2019-07-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Custom-View/" itemprop="url" rel="index">
                    <span itemprop="name">Custom View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="5-1-利用-PathMeasure-实现路径动画"><a href="#5-1-利用-PathMeasure-实现路径动画" class="headerlink" title="5.1 利用 PathMeasure 实现路径动画"></a>5.1 利用 PathMeasure 实现路径动画</h2><p>PathMeasure 类似一个计算器，可以计算出指定路径的一些信息，比如路径总长、指定长度所对应的坐标等。我们可以通过 PathMeasure 可以实现复杂的动画效果。</p>
<h4 id="5-1-1-初始化"><a href="#5-1-1-初始化" class="headerlink" title="5.1.1 初始化"></a>5.1.1 初始化</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 初始化方法一</div><div class="line">public PathMeasure();</div><div class="line">setPath(Path path, boolean forceClosed);</div><div class="line"></div><div class="line">// 初始化方法二</div><div class="line">public PathMeasure(Path path, boolean forceClosed);</div></pre></td></tr></table></figure>
<p>参数 boolean forceClosed 表示Path 最终是否需要闭合，如果为 true，则不管关联的 Path 是否是闭合的，都会被闭合。但是 forceClosed 参数对绑定的 Path 不会产生任何影响，例如一个折线段的 Path，本身是没有闭合的，当 forceClosed 设置为 true 的时候，PathMeasure 计算的 Path 是闭合的，但 Path 绘制出来的是不会闭合的。forceClosed 参数只对 PathMeasure 的测量结果有影响，例如一个折线段的 Path，本身没有闭合，当 forceClosed 设置为 true 时，PathMeasure 的计算就会包含最后一段闭合的路径，与原来的 Path 不同。</p>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">public class TestView extends View &#123;</div><div class="line"></div><div class="line">    private Paint mPaint;</div><div class="line">    private Path mPath;</div><div class="line">    private PathMeasure mPathMeasureFalse;</div><div class="line">    private PathMeasure mPathMeasureTrue;</div><div class="line"></div><div class="line">    public TestView(Context context, @Nullable AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line"></div><div class="line">        mPaint = new Paint();</div><div class="line">        mPaint.setColor(Color.BLACK);</div><div class="line">        mPaint.setStyle(Paint.Style.STROKE);</div><div class="line">        mPaint.setStrokeWidth(8);</div><div class="line"></div><div class="line">        mPath = new Path();</div><div class="line">        mPath.moveTo(50, 50);</div><div class="line">        mPath.lineTo(50, 150);</div><div class="line">        mPath.lineTo(150, 150);</div><div class="line">        mPath.lineTo(150, 50);</div><div class="line"></div><div class="line">        mPathMeasureFalse = new PathMeasure(mPath, false);</div><div class="line">        mPathMeasureTrue = new PathMeasure(mPath, true);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDraw(Canvas canvas) &#123;</div><div class="line">        super.onDraw(canvas);</div><div class="line">        Log.i(&quot;xian&quot;, &quot;forceClosed=false----&gt;&quot; + mPathMeasureFalse.getLength());</div><div class="line">        Log.i(&quot;xian&quot;, &quot;forceClosed=true-----&gt;&quot; + mPathMeasureTrue.getLength());</div><div class="line">        canvas.drawPath(mPath, mPaint);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>结果：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-adc6485f5f2929f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="path 图"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-6c7df70a4f1b8325.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="日志输出"></p>
<p>从图中可以看到，我们创建的只是正方形的三条边，而日志打印结果表示：如果 forceClosed 为 false，则测量的是当前 Path 状态的长度；如果 forceClosed 为 true，则不论 Path 是否闭合，测量的都是 Path 的闭合长度。</p>
<h4 id="5-1-2-简单函数使用"><a href="#5-1-2-简单函数使用" class="headerlink" title="5.1.2 简单函数使用"></a>5.1.2 简单函数使用</h4><h6 id="1-getLength"><a href="#1-getLength" class="headerlink" title="1. getLength()"></a>1. getLength()</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 获取一段路径的长度，不一定是整个 Path 的长度</div><div class="line">public float getLength()</div></pre></td></tr></table></figure>
<h6 id="2-isClosed"><a href="#2-isClosed" class="headerlink" title="2. isClosed()"></a>2. isClosed()</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 判断测量 Path 时是否计算闭合，返回值是 forceClosed</div><div class="line">public boolean isClosed()</div></pre></td></tr></table></figure>
<h6 id="3-nextContour"><a href="#3-nextContour" class="headerlink" title="3. nextContour()"></a>3. nextContour()</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public boolean nextContour()</div></pre></td></tr></table></figure>
<p>Path 可以由多条曲线构成，但不论是 getLength()、getSegment() 还是其他函数，都会只针对其中第一条线段进行计算。而 nextContour() 就是用于跳转到下一条曲线的函数。如果跳转成功，则返回 true；如果跳转失败，则返回 false。</p>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">public class TestView extends View &#123;</div><div class="line"></div><div class="line">    private Paint mPaint;</div><div class="line">    private Path mPath1, mPath2, mPath3;</div><div class="line">    private PathMeasure mPathMeasure;</div><div class="line"></div><div class="line">    public TestView(Context context, @Nullable AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line"></div><div class="line">        mPaint = new Paint();</div><div class="line">        mPaint.setColor(Color.BLACK);</div><div class="line">        mPaint.setStyle(Paint.Style.STROKE);</div><div class="line">        mPaint.setStrokeWidth(8);</div><div class="line"></div><div class="line">        mPath1 = new Path();</div><div class="line">        mPath1.addRect(-50, -50, 50, 50, Path.Direction.CW);</div><div class="line">        mPath2 = new Path();</div><div class="line">        mPath2.addRect(-100, -100, 100, 100, Path.Direction.CW);</div><div class="line">        mPath3 = new Path();</div><div class="line">        mPath3.addRect(-120, -120, 120, 120, Path.Direction.CW);</div><div class="line">        mPathMeasure = new PathMeasure();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDraw(Canvas canvas) &#123;</div><div class="line">        super.onDraw(canvas);</div><div class="line"></div><div class="line">        canvas.translate(150, 150);</div><div class="line"></div><div class="line">        // 只绘画最大的区域</div><div class="line">        // mPath.addRect(-50, -50, 50, 50, Path.Direction.CW);</div><div class="line">        // mPath.addRect(-100, -100, 100, 100, Path.Direction.CW);</div><div class="line">        // mPath.addRect(-120, -120, 120, 120, Path.Direction.CW);</div><div class="line">        // canvas.drawPath(mPath, mPaint);</div><div class="line"></div><div class="line">        mPath1.addPath(mPath2);</div><div class="line">        mPath1.addPath(mPath3);</div><div class="line">        canvas.drawPath(mPath1, mPaint);</div><div class="line">        mPathMeasure.setPath(mPath1, false);</div><div class="line"></div><div class="line">        do &#123;</div><div class="line">            float len = mPathMeasure.getLength();</div><div class="line">            Log.i(&quot;xian&quot;, &quot;len=&quot; + len);</div><div class="line">        &#125; while (mPathMeasure.nextContour());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>结果：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-fcf22a7220079a96.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-aee6cf7489e70d83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="日志打印结果"></p>
<p>通过这个例子可以得出以下结论：</p>
<ul>
<li>nextContour() 函数得到的曲线的顺序与 Path 中添加的顺序相同。</li>
<li>getLength() 等函数针对的是当前线段，不是整个 Path。</li>
</ul>
<h4 id="5-1-3-getSegment-函数"><a href="#5-1-3-getSegment-函数" class="headerlink" title="5.1.3 getSegment() 函数"></a>5.1.3 getSegment() 函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public boolean getSegment(float startD, float stopD, Path dst, boolean startWithMoveTo)</div></pre></td></tr></table></figure>
<p>用于截取整个 Path 中的某个片段，通过参数 startD 与 stopD 来控制截取的长度，并将截取后的 Path 保存并添加（不是替换）到参数 dst 中。startWithMoveTo 表示起始点是否使用 moveTo 将路径的新起点移动到结果 Path 的起始点，通常设置为 true，以保证每次截取的 Path 都是正常的、完整的；如果设置为 false，则新增的片段会从上一次 Path 终点开始计算，这样可以保证截取的 Path 片段是连续的，但不一定时正常的。</p>
<p>注意：</p>
<ul>
<li>如果 startD、stopD 的数值不在取值范围[0, getLength] 内，或者 startD == stopD，则返回值为 false，而且不会改变 dst 中的内容。</li>
<li>使用 getSegment() 函数时需要禁用硬件加速功能。 setLayerType(LAYER_TYPE_SOFTWARE, null)。</li>
</ul>
<p>示例一：用法举例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">public class TestView extends View &#123;</div><div class="line"></div><div class="line">    private Paint mPaint;</div><div class="line">    private Path mPath, mDst;</div><div class="line">    private PathMeasure mPathMeasure;</div><div class="line"></div><div class="line">    public TestView(Context context, @Nullable AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line"></div><div class="line">        mPaint = new Paint();</div><div class="line">        mPaint.setColor(Color.BLACK);</div><div class="line">        mPaint.setStyle(Paint.Style.STROKE);</div><div class="line">        mPaint.setStrokeWidth(8);</div><div class="line"></div><div class="line">        mPath = new Path();</div><div class="line">        mPath.addRect(-50, -50, 50, 50, Path.Direction.CW);</div><div class="line">        mDst = new Path();</div><div class="line">        mPathMeasure = new PathMeasure(mPath, false);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDraw(Canvas canvas) &#123;</div><div class="line">        super.onDraw(canvas);</div><div class="line"></div><div class="line">        canvas.translate(100, 100);</div><div class="line">        mPathMeasure.getSegment(0, 150, mDst, true);</div><div class="line">        canvas.drawPath(mDst, mPaint);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>效果图如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-ace4ca83b064f380.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>结论一：路径截取是以路径的左上角为起始点开始的。</p>
</blockquote>
<p>示例二：逆时针<br>将生成路径的方式指定为逆时针。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// mPath.addRect(-50, -50, 50, 50, Path.Direction.CW);</div><div class="line">mPath.addRect(-50, -50, 50, 50, Path.Direction.CCW);</div></pre></td></tr></table></figure></p>
<p>效果图如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-c571e32b3e662b87.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>结论二：路径的截取方向与路径的生成方向相同。</p>
</blockquote>
<p>示例三：如果 dst 路径不为空<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mDst = new Path();</div><div class="line">mDst.lineTo(10, 100);</div><div class="line">mPathMeasure = new PathMeasure(mPath, false);</div></pre></td></tr></table></figure></p>
<p>效果图如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-fb56b254e3f2b72b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>结论三：会将截取的 Path 片段添加到路径 dst 中，而不是替换 dst 中的内容。</p>
</blockquote>
<p>示例四：如果 startWithMoveTo 参数为 false<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// mPathMeasure.getSegment(0, 150, mDst, true);</div><div class="line">mPathMeasure.getSegment(0, 150, mDst, false);</div></pre></td></tr></table></figure></p>
<p>效果图如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-c63826461afbc1d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>结论四：如果 startWithMoveTo 为 true，则被截取出来的 Path 片段保持原状；如果 startWithMoveTo 为 false，则会截取出来的 Path 片段的起始点移动到 dst 的最后一个点，以保证 dst 路径的连续性。</p>
</blockquote>
<h6 id="示例：路径加载动画"><a href="#示例：路径加载动画" class="headerlink" title="示例：路径加载动画"></a>示例：路径加载动画</h6><p><img src="https://upload-images.jianshu.io/upload_images/14186083-0e3076580b729727.gif?imageMogr2/auto-orient/strip" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">public class TestView extends View &#123;</div><div class="line"></div><div class="line">    private Paint mPaint;</div><div class="line">    private Path mCirclePath, mDstPath;</div><div class="line">    private PathMeasure mPathMeasure;</div><div class="line">    private float mCurAnimValue;</div><div class="line"></div><div class="line">    public TestView(Context context, @Nullable AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line"></div><div class="line">        mPaint = new Paint();</div><div class="line">        mPaint.setColor(Color.BLACK);</div><div class="line">        mPaint.setStyle(Paint.Style.STROKE);</div><div class="line">        mPaint.setStrokeWidth(4);</div><div class="line"></div><div class="line">        mDstPath = new Path();</div><div class="line">        mCirclePath = new Path();</div><div class="line">        mCirclePath.addCircle(100, 100, 50, Path.Direction.CW);</div><div class="line">        mPathMeasure = new PathMeasure(mCirclePath, false);</div><div class="line"></div><div class="line">        ValueAnimator animator = ValueAnimator.ofFloat(0, 1);</div><div class="line">        animator.setRepeatCount(ValueAnimator.INFINITE);</div><div class="line">        animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">                mCurAnimValue = (Float) animation.getAnimatedValue();</div><div class="line">                invalidate();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        animator.setDuration(1000);</div><div class="line">        animator.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDraw(Canvas canvas) &#123;</div><div class="line">        super.onDraw(canvas);</div><div class="line">        canvas.drawColor(Color.WHITE);</div><div class="line">        float stop = mPathMeasure.getLength() * mCurAnimValue;</div><div class="line">        mDstPath.reset();</div><div class="line">        mPathMeasure.getSegment(0, stop, mDstPath, true);</div><div class="line">        canvas.drawPath(mDstPath, mPaint);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述示例中，在生成动画路径时，始终是从 0 位置开始的。如果我们稍微改变一下生成路径的起始点位置，就可以完成一个比较有意思的加载图动画，效果图如下所示：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-0bb7aa97dfd0d0db.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>修改代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">protected void onDraw(Canvas canvas) &#123;</div><div class="line">    super.onDraw(canvas);</div><div class="line">    canvas.drawColor(Color.WHITE);</div><div class="line">    float length = mPathMeasure.getLength();</div><div class="line">    float stop = length * mCurAnimValue;</div><div class="line">    float start = (float) (stop - ((0.5 - Math.abs(mCurAnimValue - 0.5)) * length));</div><div class="line">    mDstPath.reset();</div><div class="line">    mPathMeasure.getSegment(start, stop, mDstPath, true);</div><div class="line">    canvas.drawPath(mDstPath, mPaint);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="5-1-4-getPosTan-函数"><a href="#5-1-4-getPosTan-函数" class="headerlink" title="5.1.4 getPosTan() 函数"></a>5.1.4 getPosTan() 函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">boolean getPosTan(float distance, float[] pos, float[] tan)</div></pre></td></tr></table></figure>
<p>用于得到路径上某一长度的位置以及该位置的正切值。参数：</p>
<ul>
<li>float distance：距离 Path 起始点的长度，取值范围 0 ≤ distance ≤ getLength。</li>
<li>float[] pos：该点的坐标值。pos[0] 表示 x 坐标，pos[1] 表示 y 坐标。</li>
<li>float[] tan：该点的正切值。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-52fa16f0ba77e7a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="半径为1的各点的坐标值"></p>
<p>在 Math 类中，有两个求反切值的函数，即夹角 a 的值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">double atan(double d)</div><div class="line">double atan2(double x, double y)</div></pre></td></tr></table></figure></p>
<p>示例：飞机加载动画</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10002669-6f7a869e08621eb2.png?imageMogr2/auto-orient/strip|imageView2/2/w/808/format/webp" alt="动画原理"></p>
<p>动画效果：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-49a48bdececab025.gif?imageMogr2/auto-orient/strip" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line">public class TestView extends View &#123;</div><div class="line"></div><div class="line">    private Paint mPaint;</div><div class="line">    private Path mCirclePath, mDstPath;</div><div class="line">    private PathMeasure mPathMeasure;</div><div class="line">    private float mCurAnimValue;</div><div class="line">    private Bitmap mPlaneBmp;</div><div class="line">    private Matrix mMatrix;</div><div class="line">    private ValueAnimator mValueAnimator;</div><div class="line">    private float[] pos = new float[2];</div><div class="line">    private float[] tan = new float[2];</div><div class="line"></div><div class="line">    public TestView(Context context, @Nullable AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">        setLayerType(LAYER_TYPE_SOFTWARE, null);</div><div class="line">        mPlaneBmp = BitmapFactory.decodeResource(getResources(), R.drawable.plane);</div><div class="line"></div><div class="line">        mPaint = new Paint();</div><div class="line">        mPaint.setColor(Color.BLACK);</div><div class="line">        mPaint.setStyle(Paint.Style.STROKE);</div><div class="line">        mPaint.setStrokeWidth(4);</div><div class="line"></div><div class="line">        mDstPath = new Path();</div><div class="line">        mCirclePath = new Path();</div><div class="line">        mPathMeasure = new PathMeasure();</div><div class="line">        mMatrix = new Matrix();</div><div class="line"></div><div class="line">        mValueAnimator = ValueAnimator.ofFloat(0, 1);</div><div class="line">        mValueAnimator.setRepeatCount(ValueAnimator.INFINITE);</div><div class="line">        mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">                mCurAnimValue = (Float) animation.getAnimatedValue();</div><div class="line">                invalidate();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        mValueAnimator.setDuration(2000);</div><div class="line">        mValueAnimator.setInterpolator(new AccelerateDecelerateInterpolator());</div><div class="line">        mValueAnimator.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</div><div class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        int width = MeasureSpec.getSize(widthMeasureSpec);</div><div class="line">        int height = MeasureSpec.getSize(heightMeasureSpec);</div><div class="line">        int radius;</div><div class="line">        if (width &gt;= height) &#123;</div><div class="line">            radius = height / 2 - height / 8;</div><div class="line">        &#125; else &#123;</div><div class="line">            radius = width / 2 - width / 8;</div><div class="line">        &#125;</div><div class="line">        // 先画圆的 path，但是这个圆只是用来计算</div><div class="line">        mCirclePath.addCircle(width / 2f, height / 2f, radius, Path.Direction.CW);</div><div class="line">        //计算圆的path的长度</div><div class="line">        mPathMeasure.setPath(mCirclePath, false);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDraw(Canvas canvas) &#123;</div><div class="line">        super.onDraw(canvas);</div><div class="line">        // 绘制路径加载动画</div><div class="line">        float length = mPathMeasure.getLength();</div><div class="line">        float stop = length * mCurAnimValue;</div><div class="line">        float start = (float) (stop - ((0.5 - Math.abs(mCurAnimValue - 0.5)) * length));</div><div class="line"></div><div class="line">        mDstPath.reset();</div><div class="line">        mPathMeasure.getSegment(start, stop, mDstPath, true);</div><div class="line">        canvas.drawPath(mDstPath, mPaint);</div><div class="line"></div><div class="line">        // 旋转飞机图片并绘制</div><div class="line">        // 使用 getMatrix</div><div class="line">        // mPathMeasure.getMatrix(stop, mMatrix, PathMeasure.POSITION_MATRIX_FLAG|PathMeasure.TANGENT_MATRIX_FLAG);</div><div class="line">        // mMatrix.preTranslate(-mPlaneBmp.getWidth() / 2f,-mPlaneBmp.getHeight() / 2f);</div><div class="line"></div><div class="line">        // 使用 getPosTan</div><div class="line">        mPathMeasure.getPosTan(stop, pos, tan);</div><div class="line">        float degrees = (float) (Math.atan2(tan[1], tan[0]) * 180.0 / Math.PI);</div><div class="line">        float px = mPlaneBmp.getWidth() / 2f;</div><div class="line">        float py = mPlaneBmp.getHeight() / 2f;</div><div class="line">        mMatrix.reset();</div><div class="line">        mMatrix.postRotate(degrees, mPlaneBmp.getWidth() / 2f, mPlaneBmp.getHeight() / 2f);</div><div class="line">        mMatrix.postTranslate(pos[0] - px, pos[1] - py);</div><div class="line">        canvas.drawBitmap(mPlaneBmp, mMatrix, mPaint);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDetachedFromWindow() &#123;</div><div class="line">        super.onDetachedFromWindow();</div><div class="line">        mValueAnimator.cancel();</div><div class="line">        mValueAnimator = null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="5-1-5-getMatrix-函数"><a href="#5-1-5-getMatrix-函数" class="headerlink" title="5.1.5 getMatrix() 函数"></a>5.1.5 getMatrix() 函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">boolean getMatrix(float distance, Matrix matrix, int flags)</div></pre></td></tr></table></figure>
<p>用于得到路径上某一长度的位置以及该位置的正切值的矩阵。</p>
<ul>
<li>distance：距离 Path 起始点的长度。</li>
<li>matrix：根据flags 封装好的 matrix 会根据 flags 的设置而存入不同的内容。</li>
<li>flags：用于指定哪些内容会存入 matrix 中。flags 值有两个：PathMeasure.POSITION_MATRIX_FLAG 表示获取位置信息；PathMeasure.TANGENT_MATRIX_FLAG 表示获取切边信息，使得图片按 Path 旋转。可以只指定一个，也可以用“|”同时指定。</li>
</ul>
<p>很明显，getMatrix() 函数只是 PathMeasure.getPosTan() 函数的另一种实现而已。如下更改飞机加载动画：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">protected void onDraw(Canvas canvas) &#123;</div><div class="line">    super.onDraw(canvas);</div><div class="line">    // 绘制路径加载动画</div><div class="line">    float length = mPathMeasure.getLength();</div><div class="line">    float stop = length * mCurAnimValue;</div><div class="line">    float start = (float) (stop - ((0.5 - Math.abs(mCurAnimValue - 0.5)) * length));</div><div class="line"></div><div class="line">    mDstPath.reset();</div><div class="line">    mPathMeasure.getSegment(start, stop, mDstPath, true);</div><div class="line">    canvas.drawPath(mDstPath, mPaint);</div><div class="line"></div><div class="line">    // 旋转飞机图片并绘制</div><div class="line">    // 使用 getMatrix</div><div class="line">    mMatrix.reset();</div><div class="line">    mPathMeasure.getMatrix(stop, mMatrix, PathMeasure.POSITION_MATRIX_FLAG|PathMeasure.TANGENT_MATRIX_FLAG);</div><div class="line">    mMatrix.preTranslate(-mPlaneBmp.getWidth() / 2f,-mPlaneBmp.getHeight() / 2f);</div><div class="line"></div><div class="line">    // 使用 getPosTan</div><div class="line">    // mPathMeasure.getPosTan(stop, pos, tan);</div><div class="line">    // float degrees = (float) (Math.atan2(tan[1], tan[0]) * 180.0 / Math.PI);</div><div class="line">    // float px = mPlaneBmp.getWidth() / 2f;</div><div class="line">    // float py = mPlaneBmp.getHeight() / 2f;</div><div class="line">    // mMatrix.postRotate(degrees, mPlaneBmp.getWidth() / 2f, mPlaneBmp.getHeight() / 2f);</div><div class="line">    // mMatrix.postTranslate(pos[0] - px, pos[1] - py);</div><div class="line">    canvas.drawBitmap(mPlaneBmp, mMatrix, mPaint);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="5-1-6-示例：支付宝支付成功动画"><a href="#5-1-6-示例：支付宝支付成功动画" class="headerlink" title="5.1.6 示例：支付宝支付成功动画"></a>5.1.6 示例：支付宝支付成功动画</h4><p><img src="https://upload-images.jianshu.io/upload_images/14186083-a5fb69f068b0ad8b.gif?imageMogr2/auto-orient/strip" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">public class TestView extends View &#123;</div><div class="line"></div><div class="line">    private Paint mPaint;</div><div class="line">    private Path mCirclePath, mDstPath;</div><div class="line">    private PathMeasure mPathMeasure;</div><div class="line">    private float mCurAnimValue;</div><div class="line">    private ValueAnimator mValueAnimator;</div><div class="line">    private boolean mNext = false;</div><div class="line"></div><div class="line">    public TestView(Context context, @Nullable AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line"></div><div class="line">        mPaint = new Paint();</div><div class="line">        mPaint.setColor(Color.BLACK);</div><div class="line">        mPaint.setStyle(Paint.Style.STROKE);</div><div class="line">        mPaint.setStrokeWidth(8);</div><div class="line"></div><div class="line">        mDstPath = new Path();</div><div class="line">        mCirclePath = new Path();</div><div class="line">        mPathMeasure = new PathMeasure();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</div><div class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        mCirclePath.reset();</div><div class="line"></div><div class="line">        int width = MeasureSpec.getSize(widthMeasureSpec);</div><div class="line">        int height = MeasureSpec.getSize(heightMeasureSpec);</div><div class="line">        int centerX = width / 2;</div><div class="line">        int centerY = height / 2;</div><div class="line">        int radius = Math.min(centerX, centerY) / 2;</div><div class="line"></div><div class="line">        mCirclePath.addCircle(centerX, centerY, radius, Path.Direction.CW);</div><div class="line">        mCirclePath.moveTo(centerX - radius/2f, centerY);                // 勾的起点</div><div class="line">        mCirclePath.lineTo(centerX,centerY + radius/2f);                 // 勾的拐点</div><div class="line">        mCirclePath.lineTo(centerX + radius/2f,centerY - radius/3f);  // 勾的终点</div><div class="line">        mPathMeasure.setPath(mCirclePath,false);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDraw(Canvas canvas) &#123;</div><div class="line">        super.onDraw(canvas);</div><div class="line"></div><div class="line">        if (mCurAnimValue &lt; 1) &#123;</div><div class="line">            float stop = mPathMeasure.getLength() * mCurAnimValue;</div><div class="line">            mPathMeasure.getSegment(0, stop, mDstPath, true);</div><div class="line">        &#125; else &#123;</div><div class="line">            if (!mNext) &#123;</div><div class="line">                mNext = true;</div><div class="line">                mPathMeasure.getSegment(0, mPathMeasure.getLength(), mDstPath, true);</div><div class="line">                mPathMeasure.nextContour();</div><div class="line">            &#125; else &#123;</div><div class="line">                float stop = mPathMeasure.getLength() * (mCurAnimValue - 1);</div><div class="line">                mPathMeasure.getSegment(0, stop, mDstPath, true);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        canvas.drawPath(mDstPath, mPaint);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDetachedFromWindow() &#123;</div><div class="line">        super.onDetachedFromWindow();</div><div class="line">        if (mValueAnimator != null) &#123;</div><div class="line">            mValueAnimator.cancel();</div><div class="line">            mValueAnimator = null;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void startAnim() &#123;</div><div class="line">        mValueAnimator = ValueAnimator.ofFloat(0, 2);</div><div class="line">        mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">                mCurAnimValue = (Float) animation.getAnimatedValue();</div><div class="line">                invalidate();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        mValueAnimator.setDuration(2000);</div><div class="line">        mValueAnimator.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用自定义控件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.act_main);</div><div class="line"></div><div class="line">        findViewById(R.id.start_btn).setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                TestView tv = findViewById(R.id.test_view);</div><div class="line">                tv.startAnim();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/04/Custom View/04.4 精通自定义 View 之属性动画进阶（四）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/04/Custom View/04.4 精通自定义 View 之属性动画进阶（四）/" itemprop="url">04.4 精通自定义 View 之属性动画进阶（四）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-04T04:00:00+08:00">
                2019-07-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Custom-View/" itemprop="url" rel="index">
                    <span itemprop="name">Custom View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="4-4-开源动画库-NineOldAndroids"><a href="#4-4-开源动画库-NineOldAndroids" class="headerlink" title="4.4 开源动画库 NineOldAndroids"></a>4.4 开源动画库 NineOldAndroids</h2><p>Android 3.0 推出了全新的 Animation API，使用起来很方便，但是不能在 3.0 以下版本中使用。NineOldAndroids 是一个可以在任意 Android 版本上使用的 Animation API。</p>
<p>常用类有 ObjectAnimator、ValueAnimator、AnimatorSet、PropertyValuesHolder、Keyframe、ViewPropertyAnimator、ViewHelper.</p>
<h4 id="4-4-1-NineOldAndroids-中的-ViewPropertyAnimator"><a href="#4-4-1-NineOldAndroids-中的-ViewPropertyAnimator" class="headerlink" title="4.4.1 NineOldAndroids 中的 ViewPropertyAnimator"></a>4.4.1 NineOldAndroids 中的 ViewPropertyAnimator</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 官方 API（3.1 以上）</div><div class="line">mView.animate().setDuration(5000).rotationY(720).x(100).y(100).start();</div><div class="line"></div><div class="line">// NineOldAndroids</div><div class="line">ViewPropertyAnimator.animate(mView).setDuration(5000).rotationY(720).x(100).y(100).start();</div></pre></td></tr></table></figure>
<p>从对比中可以看出，唯一不同的是 animate() 函数，其他诸如链式操作、各属性对应的函数、添加监听器都与官方 API 完全相同</p>
<h4 id="4-4-2-NineOldAndroids-中的-ViewHelper"><a href="#4-4-2-NineOldAndroids-中的-ViewHelper" class="headerlink" title="4.4.2 NineOldAndroids 中的 ViewHelper"></a>4.4.2 NineOldAndroids 中的 ViewHelper</h4><h6 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h6><p>ViewHelper 提供了一系列 set/get 函数去操作 View 的各种属性，比如透明度、偏移量、旋转角度等，大大方便了我们的使用，而且无须考虑低版本的兼容性问题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">public static float getAlpha(View view)</div><div class="line">public static void setAlpha(View view, float alpha)</div><div class="line"></div><div class="line">public static float getPivotX(View view)</div><div class="line">public static void setPivotX(View view, float pivotX)</div><div class="line"></div><div class="line">public static float getPivotY(View view)</div><div class="line">public static void setPivotY(View view, float pivotY)</div><div class="line"></div><div class="line">public static float getRotation(View view)</div><div class="line">public static void setRotation(View view, float rotation)</div><div class="line"></div><div class="line">public static float getRotationX(View view)</div><div class="line">public static void setRotationX(View view, float rotationX)</div><div class="line"></div><div class="line">public static float getRotationY(View view)</div><div class="line">public static void setRotationY(View view, float rotationY)</div><div class="line"></div><div class="line">public static float getScaleX(View view)</div><div class="line">public static void setScaleX(View view, float scaleX)</div><div class="line"></div><div class="line">public static float getScaleY(View view)</div><div class="line">public static void setScaleY(View view, float scaleY)</div><div class="line"></div><div class="line">public static float getScrollX(View view)</div><div class="line">public static void setScrollX(View view, float scrollX)</div><div class="line"></div><div class="line">public static float getScrollY(View view)</div><div class="line">public static void setScrollY(View view, float scrollY)</div><div class="line"></div><div class="line">public static float getTranslationX(View view)</div><div class="line">public static void setTranslationX(View view, float translationX)</div><div class="line"></div><div class="line">public static float getTranslationY(View view)</div><div class="line">public static void setTranslationY(View view, float translationY)</div><div class="line"></div><div class="line">public static float getX(View view)</div><div class="line">public static void setX(View view, float x)</div><div class="line"></div><div class="line">public static float getY(View view)</div><div class="line">public static void setY(View view, float y)</div></pre></td></tr></table></figure></p>
<h6 id="2-示例"><a href="#2-示例" class="headerlink" title="2. 示例"></a>2. 示例</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">final TextView tv = (TextView) findViewById(R.id.tv);</div><div class="line"></div><div class="line">findViewById(R.id.btn).setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">    public void onClick(View v) &#123;</div><div class="line">        ValueAnimator animator = ValueAnimator.ofFloat(0, 200);</div><div class="line">        animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            public void onAnimationUpdate(ValueAnimator valueAnimator) &#123;</div><div class="line">                Float cur = (Float) valueAnimator.getAnimatedValue();</div><div class="line">                ViewHelper.setTranslationX(tv, cur);</div><div class="line">                ViewHelper.setTranslationY(tv, cur);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/04/Custom View/04.3 精通自定义 View 之属性动画进阶（三）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/04/Custom View/04.3 精通自定义 View 之属性动画进阶（三）/" itemprop="url">04.3 精通自定义 View 之属性动画进阶（三）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-04T03:00:00+08:00">
                2019-07-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Custom-View/" itemprop="url" rel="index">
                    <span itemprop="name">Custom View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="4-3-为-ViewGroup-内的组件添加动画"><a href="#4-3-为-ViewGroup-内的组件添加动画" class="headerlink" title="4.3 为 ViewGroup 内的组件添加动画"></a>4.3 为 ViewGroup 内的组件添加动画</h2><p>为 ViewGroup 内的组件添加动画，Android 共提供了 4 种方法。<br><strong>1. layoutAnimation 标签与 LayoutAnimationController</strong><br>第一：定义一个 layoutAnimation 的 animation 文件，如：(anim/layout_animation.xml)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;layoutAnimation xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:delay=&quot;1&quot;</div><div class="line">    android:animationOrder=&quot;normal&quot;</div><div class="line">    android:animation=&quot;@anim/slide_in_left&quot;/&gt;</div></pre></td></tr></table></figure></p>
<p>第二步：在 viewGroup 类型的控件中，添加android:layoutAnimation=”@anim/layout_animation”，如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;ListView</div><div class="line">    android:id=&quot;@+id/listview&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:layoutAnimation=&quot;@anim/layout_animation&quot; /&gt;</div></pre></td></tr></table></figure></p>
<p>其中 @anim/slide_in_left 文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:duration=&quot;1000&quot;&gt;</div><div class="line">    &lt;translate android:fromXDelta=&quot;-50%p&quot; android:toXDelta=&quot;0&quot;/&gt;</div><div class="line">    &lt;alpha android:fromAlpha=&quot;0.0&quot; android:toAlpha=&quot;1.0&quot;/&gt;</div><div class="line">&lt;/set&gt;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意：android:layoutAnimation 只在 ViewGroup 创建的时候，才会对其中的 item 添加动画。在创建成功以后，再向其中添加 item 将不会再有动画。</p>
</blockquote>
<p><strong>2. gridLayoutAnimation 标签与 GridLayoutAnimationController</strong><br>gridLayoutAnimation 与 layoutAnimation 一样有缺陷：即在 GridView 初次创建的时候有入场动画，之后新添加的数据是不会有入场动画的。</p>
<p><a href="https://blog.csdn.net/harvic880925/article/details/50785786" target="_blank" rel="external">详情请点击前往：layoutAnimation &amp; gridLayoutAnimation</a></p>
<p><strong>3. animateLayoutChanges 属性</strong><br>在 API 11 之后，Android 为了支持 ViewGroup 类控件，在添加和移除其中控件时自动添加动画，为我们提供了一个非常简单的属性：android:animateLayoutChanges=[true/false]，所有派生自 ViewGroup 的控件都具有此属性，只要在 XML 中添加上这个属性，就能实现添加/删除其中控件时，带有默认动画了。</p>
<p><strong>4. LayoutTransition</strong><br>在 API 11 之后引入，可以实现在 ViewGroup 动态添加或删除其中的控件时指定动画。动画可以自定义。对比前三种方法，LayoutTransition 是最强大的。</p>
<h4 id="4-3-1-animateLayoutChanges-属性"><a href="#4-3-1-animateLayoutChanges-属性" class="headerlink" title="4.3.1 animateLayoutChanges 属性"></a>4.3.1 animateLayoutChanges 属性</h4><p><img src="https://upload-images.jianshu.io/upload_images/14186083-1009a7ad10f53cab.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>在相应的 GroupView 子类中添加 android:animateLayoutChanges=”true”。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:orientation=&quot;vertical&quot;&gt;</div><div class="line">    &lt;LinearLayout</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:orientation=&quot;horizontal&quot;&gt;</div><div class="line">        &lt;Button</div><div class="line">            android:id=&quot;@+id/add_btn&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;添加控件&quot;/&gt;</div><div class="line">        &lt;Button</div><div class="line">            android:id=&quot;@+id/remove_btn&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;移除控件&quot;/&gt;</div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line">    &lt;LinearLayout</div><div class="line">        android:id=&quot;@+id/layoutTransitionGroup&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:animateLayoutChanges=&quot;true&quot;</div><div class="line">        android:orientation=&quot;vertical&quot;/&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123;</div><div class="line">    private LinearLayout layoutTransitionGroup;</div><div class="line"></div><div class="line">    private int i = 0;</div><div class="line">    @Override</div><div class="line">    public void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.act_main);</div><div class="line"></div><div class="line">        layoutTransitionGroup = findViewById(R.id.layoutTransitionGroup);</div><div class="line">        findViewById(R.id.add_btn).setOnClickListener(this);</div><div class="line">        findViewById(R.id.remove_btn).setOnClickListener(this);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void addButtonView() &#123;</div><div class="line">        i++;</div><div class="line">        Button button = new Button(this);</div><div class="line">        button.setText(&quot;button&quot; + i);</div><div class="line">        LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(</div><div class="line">                ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);</div><div class="line">        button.setLayoutParams(params);</div><div class="line">        layoutTransitionGroup.addView(button, 0);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void removeButtonView() &#123;</div><div class="line">        if (i &gt; 0) &#123;</div><div class="line">            layoutTransitionGroup.removeViewAt(0);</div><div class="line">        &#125;</div><div class="line">        i--;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onClick(View v) &#123;</div><div class="line">        if (v.getId() == R.id.add_btn) &#123;</div><div class="line">            addButtonView();</div><div class="line">        &#125;</div><div class="line">        if (v.getId() == R.id.remove_btn) &#123;</div><div class="line">            removeButtonView();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="4-3-2-LayoutTransition"><a href="#4-3-2-LayoutTransition" class="headerlink" title="4.3.2 LayoutTransition"></a>4.3.2 LayoutTransition</h4><p>上面虽然在 ViewGroup 类控件 XML 中仅添加一行android:animateLayoutChanges=[true] 即可实现内部控件添加删除时都加上动画效果。但却只能使用默认动画效果，而无法自定义动画。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-54c50a8ff19f0356.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>为了能让我们自定义动画，谷歌在 API 11 时，同时为我们引入了一个类 LayoutTransaction。要使用LayoutTransaction是非常容易的，只需要三步： </p>
<ol>
<li><p>创建实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LayoutTransaction transitioner = new LayoutTransition();</div></pre></td></tr></table></figure>
</li>
<li><p>创建动画并设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animOut = ObjectAnimator.ofFloat(null, &quot;rotation&quot;, 0f, 90f, 0f);</div><div class="line">transitioner.setAnimator(LayoutTransition.DISAPPEARING, animOut);</div></pre></td></tr></table></figure>
</li>
<li><p>将 LayoutTransaction 设置进 ViewGroup</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">linearLayout.setLayoutTransition(mTransitioner);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>在第二步中，transitioner.setAnimator 设置动画的函数声明为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public void setAnimator(int transitionType, Animator animator)</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>int transitionType</strong>：表示当前应用动画的对象范围，取值有：<br>APPEARING：元素在容器中出现时所定义的动画。<br>DISAPPEARING：元素在容器中消失时所定义的动画。<br>CHANGE_APPEARING：由于容器中要显现一个新的元素，其它需要变化的元素所应用的动画。<br>CHANGE_DISAPPEARING：当容器中某个元素消失，其它需要变化的元素所应用的动画。</li>
<li><strong>Animator animator</strong>：表示当前所选范围的控件所使用的动画。</li>
</ul>
<h6 id="1-LayoutTransition-APPEARING-与-LayoutTransition-APPEARING"><a href="#1-LayoutTransition-APPEARING-与-LayoutTransition-APPEARING" class="headerlink" title="1. LayoutTransition.APPEARING 与 LayoutTransition.APPEARING"></a>1. LayoutTransition.APPEARING 与 LayoutTransition.APPEARING</h6><p>LayoutTransition.APPEARING 所对应的当一个控件出现时所对应的动画；LayoutTransition.DISAPPEARING 在一个控件被移除时所对应的动画。修改上一个示例代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">layoutTransitionGroup = findViewById(R.id.layoutTransitionGroup);</div><div class="line">findViewById(R.id.add_btn).setOnClickListener(this);</div><div class="line">findViewById(R.id.remove_btn).setOnClickListener(this);</div><div class="line"></div><div class="line">mTransitioner = new LayoutTransition();</div><div class="line">// 入场动画：view 在这个容器中出现时触发的动画</div><div class="line">ObjectAnimator animIn = ObjectAnimator.ofFloat(null, &quot;rotationY&quot;, 0f, 360f,0f);</div><div class="line">mTransitioner.setAnimator(LayoutTransition.APPEARING, animIn);</div><div class="line"></div><div class="line">// 出场动画：view 在这个容器中消失时触发的动画</div><div class="line">ObjectAnimator animOut = ObjectAnimator.ofFloat(null, &quot;rotation&quot;, 0f, 90f, 0f);</div><div class="line">mTransitioner.setAnimator(LayoutTransition.DISAPPEARING, animOut);</div><div class="line"></div><div class="line">layoutTransitionGroup.setLayoutTransition(mTransitioner);</div></pre></td></tr></table></figure></p>
<p>同时要删除 XML 中的 android:animateLayoutChanges=”true” 设置。</p>
<h6 id="2-LayoutTransition-CHANGE-APPEARING"><a href="#2-LayoutTransition-CHANGE-APPEARING" class="headerlink" title="2. LayoutTransition.CHANGE_APPEARING"></a>2. LayoutTransition.CHANGE_APPEARING</h6><p>在添加控件时，除了被添加控件本身的入场动画以外，其它需要移动位置的控件，在移动位置时，也被添加上了动画（left 点位移动画），这些除了被添加控件以外的其它需要移动位置的控件组合，所对应的动画就是 LayoutTransition.CHANGE_APPEARING。同样，在移除一个控件时，其它所有需要改变位置的控件组合所对应的动画就是 LayoutTransition.CHANGE_DISAPPEARING。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">public void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">    super.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.act_main);</div><div class="line"> </div><div class="line">    layoutTransitionGroup = (LinearLayout) findViewById(R.id.layoutTransitionGroup);</div><div class="line">    findViewById(R.id.add_btn).setOnClickListener(this);</div><div class="line">    findViewById(R.id.remove_btn).setOnClickListener(this);</div><div class="line"> </div><div class="line">    mTransitioner = new LayoutTransition();</div><div class="line">    // 入场动画：view 在这个容器中出现时触发的动画</div><div class="line">    ObjectAnimator animIn = ObjectAnimator.ofFloat(null, &quot;rotationY&quot;, 0f, 360f,0f);</div><div class="line">    mTransitioner.setAnimator(LayoutTransition.APPEARING, animIn);</div><div class="line"> </div><div class="line">    // 出场动画：view 在这个容器中消失时触发的动画</div><div class="line">    ObjectAnimator animOut = ObjectAnimator.ofFloat(null, &quot;rotation&quot;, 0f, 90f, 0f);</div><div class="line">    mTransitioner.setAnimator(LayoutTransition.DISAPPEARING, animOut);</div><div class="line"> </div><div class="line">    PropertyValuesHolder pvhLeft = PropertyValuesHolder.ofInt(&quot;left&quot;,0,100,0);</div><div class="line">    PropertyValuesHolder pvhTop = PropertyValuesHolder.ofInt(&quot;top&quot;,1,1);</div><div class="line">    Animator changeAppearAnimator = ObjectAnimator.ofPropertyValuesHolder(</div><div class="line">        layoutTransitionGroup, pvhLeft,pvhBottom,pvhTop,pvhRight);</div><div class="line">    mTransitioner.setAnimator(LayoutTransition.CHANGE_APPEARING,changeAppearAnimator);</div><div class="line"> </div><div class="line">    layoutTransitionGroup.setLayoutTransition(mTransitioner);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意：<br>1、LayoutTransition.CHANGE_APPEARING 和 LayoutTransition.CHANGE_DISAPPEARING 必须使用 PropertyValuesHolder 所构造的动画才会有效果，不然无效！也就是说使用 ObjectAnimator 构造的动画，在这里是不会有效果的！<br>2、在构造 PropertyValuesHolder 动画时，“left”、“top” 属性的变动是必写的。如果不需要变动，则直接写为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PropertyValuesHolder pvhLeft = PropertyValuesHolder.ofInt(&quot;left&quot;,0,0);</div><div class="line">PropertyValuesHolder pvhTop = PropertyValuesHolder.ofInt(&quot;top&quot;,0,0);</div></pre></td></tr></table></figure></p>
<p>3、在构造 PropertyValuesHolder 时，所使用的 ofInt、ofFloat 中的参数值，第一个值和最后一个值必须相同，不然此属性所对应的的动画将被放弃，在此属性值上将不会有效果。<br>4、在构造 PropertyValuesHolder 时，所使用的 ofInt，ofFloat 中，如果所有参数值都相同，也将不会有动画效果。</p>
<h6 id="3-LayoutTransition-CHANGE-DISAPPEARING"><a href="#3-LayoutTransition-CHANGE-DISAPPEARING" class="headerlink" title="3. LayoutTransition.CHANGE_DISAPPEARING"></a>3. LayoutTransition.CHANGE_DISAPPEARING</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">PropertyValuesHolder outLeft = PropertyValuesHolder.ofInt(&quot;left&quot;,0,0);</div><div class="line">PropertyValuesHolder outTop = PropertyValuesHolder.ofInt(&quot;top&quot;,0,0);</div><div class="line"> </div><div class="line">Keyframe frame0 = Keyframe.ofFloat(0f, 0);</div><div class="line">Keyframe frame1 = Keyframe.ofFloat(0.1f, -20f);</div><div class="line">Keyframe frame2 = Keyframe.ofFloat(0.2f, 20f);</div><div class="line">Keyframe frame3 = Keyframe.ofFloat(0.3f, -20f);</div><div class="line">Keyframe frame4 = Keyframe.ofFloat(0.4f, 20f);</div><div class="line">Keyframe frame5 = Keyframe.ofFloat(0.5f, -20f);</div><div class="line">Keyframe frame6 = Keyframe.ofFloat(0.6f, 20f);</div><div class="line">Keyframe frame7 = Keyframe.ofFloat(0.7f, -20f);</div><div class="line">Keyframe frame8 = Keyframe.ofFloat(0.8f, 20f);</div><div class="line">Keyframe frame9 = Keyframe.ofFloat(0.9f, -20f);</div><div class="line">Keyframe frame10 = Keyframe.ofFloat(1, 0);</div><div class="line">PropertyValuesHolder mPropertyValuesHolder = PropertyValuesHolder.ofKeyframe(</div><div class="line">        &quot;rotation&quot;,frame0,frame1,frame2,frame3,frame4,</div><div class="line">        frame5,frame6,frame7,frame8,frame9,frame10);</div><div class="line"> </div><div class="line">ObjectAnimator animator = ObjectAnimator.ofPropertyValuesHolder(</div><div class="line">        this, outLeft,outTop,mPropertyValuesHolder);</div><div class="line">mTransitioner.setAnimator(LayoutTransition.CHANGE_DISAPPEARING, animator);</div></pre></td></tr></table></figure>
<p>第一步：由于 left、top 属性是必须的，但我们做响铃效果时，是不需要 left，top 变动的，所有给他们设置为无效值。<br>第二步：用 KeyFrame 构造 PropertyValuesHolder。<br>第三步：设置 LayoutTransition.CHANGE_DISAPPEARING 动画。</p>
<h4 id="4-3-3-其他函数"><a href="#4-3-3-其他函数" class="headerlink" title="4.3.3 其他函数"></a>4.3.3 其他函数</h4><h6 id="1-基本设置"><a href="#1-基本设置" class="headerlink" title="1. 基本设置"></a>1. 基本设置</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 设置所有动画完成所需要的时长</div><div class="line"> */</div><div class="line">public void setDuration(long duration)</div><div class="line">/**</div><div class="line"> * 针对单个type，设置动画时长；</div><div class="line"> * transitionType取值为：APPEARING、DISAPPEARING、CHANGE_APPEARING、CHANGE_DISAPPEARING</div><div class="line"> */</div><div class="line">public void setDuration(int transitionType, long duration) </div><div class="line">/**</div><div class="line"> * 针对单个type设置插值器</div><div class="line"> * transitionType取值为：APPEARING、DISAPPEARING、CHANGE_APPEARING、CHANGE_DISAPPEARING</div><div class="line"> */</div><div class="line">public void setInterpolator(int transitionType, TimeInterpolator interpolator)</div><div class="line">/**</div><div class="line"> * 针对单个type设置动画延时</div><div class="line"> * transitionType取值为：APPEARING、DISAPPEARING、CHANGE_APPEARING、CHANGE_DISAPPEARING</div><div class="line"> */</div><div class="line">public void setStartDelay(int transitionType, long delay)</div><div class="line">/**</div><div class="line"> * 针对单个type设置，每个子item动画的时间间隔</div><div class="line"> */</div><div class="line">public void setStagger(int transitionType, long duration)</div></pre></td></tr></table></figure>
<h6 id="2-LayoutTransition-设置监听"><a href="#2-LayoutTransition-设置监听" class="headerlink" title="2. LayoutTransition 设置监听"></a>2. LayoutTransition 设置监听</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public void addTransitionListener(TransitionListener listener)</div><div class="line">public interface TransitionListener &#123;</div><div class="line">    public void startTransition(LayoutTransition transition, ViewGroup container,View view, int transitionType);</div><div class="line">    public void endTransition(LayoutTransition transition, ViewGroup container,View view, int transitionType);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在 TransitionListener 中总共有四个参数：</p>
<ul>
<li>LayoutTransition transition：当前的 LayoutTransition 实例。</li>
<li>ViewGroup container：当前应用 LayoutTransition 的 container。</li>
<li>View view：当前在做动画的 View 对象。</li>
<li>int transitionType：当前的 LayoutTransition 类型，取值有：APPEARING、DISAPPEARING、CHANGE_APPEARING、CHANGE_DISAPPEARING。</li>
</ul>
<p>在添加控件时，先是 start 回调，再是 end 回调；APPEARING 事件所对应的 View 是控件，而 CHANGE_APPEARING 所对应的控件是容器。删除控件时，原理相同。</p>
<p>这是因为，在添加控件时，APPEARING 事件只针对当前被添加的控件做动画，所以返回的 View 是当前被添加的控件。而 CHANGE_APPEARING 是对容器中所有已存在的控件做动画，所以返回的 View 是容器。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/04/Custom View/04.2 精通自定义 View 之属性动画进阶（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/04/Custom View/04.2 精通自定义 View 之属性动画进阶（二）/" itemprop="url">04.2 精通自定义 View 之属性动画进阶（二）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-04T02:00:00+08:00">
                2019-07-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Custom-View/" itemprop="url" rel="index">
                    <span itemprop="name">Custom View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="4-2-ViewPropertyAnimator"><a href="#4-2-ViewPropertyAnimator" class="headerlink" title="4.2 ViewPropertyAnimator"></a>4.2 ViewPropertyAnimator</h2><h4 id="4-2-1-概述"><a href="#4-2-1-概述" class="headerlink" title="4.2.1 概述"></a>4.2.1 概述</h4><p>使用 ObjectAnimator：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animator = ObjectAnimator.ofFloat(mView, &quot;alpha&quot;, 0f);</div><div class="line">animator.start();</div></pre></td></tr></table></figure></p>
<p>使用 ViewPropertyAnimator：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mView.animate().alpha(0f);</div></pre></td></tr></table></figure></p>
<p>除此之外，还可以非常容易地将多个动画结合起来。比如：将控件移动到点 (50, 100) 且完全透明。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mView.animate().x(50).y(100).alpha(0f);</div></pre></td></tr></table></figure></p>
<p>此类事专门针对 View 对象动画而操作的类：链式调用，自动 start， 简化流程，提高效率： </p>
<ul>
<li>提供了更简洁的链式调用设置多个属性动画，这些动画可以同时进行的。</li>
<li>拥有更好的性能，多个属性动画是一次同时变化，只执行一次 UI 刷新（也就是只调用一次 invalidate，而 n 个 ObjectAnimator 就会进行 n 次属性变化，就有 n 次 invalidate）。</li>
<li>每个属性提供两种类型方法设置。如：scaleX()、scaleXBy()。</li>
<li>该类只能通过 View 的 animate() 获取其实例对象的引用。</li>
</ul>
<h4 id="4-2-2-常用函数"><a href="#4-2-2-常用函数" class="headerlink" title="4.2.2 常用函数"></a>4.2.2 常用函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">view.animate()                  // 获取ViewPropertyAnimator对象</div><div class="line">        // 位移</div><div class="line">        .translationX(100)</div><div class="line">        .translationXBy(100)</div><div class="line">        .translationY(100)</div><div class="line">        .translationYBy(100)</div><div class="line">        .translationZ(100)      // Z 轴移动，API 21 添加</div><div class="line">        .translationZBy(100)    // API 21 添加</div><div class="line">        // 改变坐标</div><div class="line">        .x(100)</div><div class="line">        .xBy(100)</div><div class="line">        .y(100)</div><div class="line">        .yBy(100)</div><div class="line">        // 改变透明度</div><div class="line">        .alpha(0.1f)</div><div class="line">        .alphaBy(0.1f)</div><div class="line">        // 改变透明度</div><div class="line">        .scaleX(0.1f)</div><div class="line">        .scaleXBy(0.1f)</div><div class="line">        .scaleY(0.1f)</div><div class="line">        .scaleYBy(0.1f)</div><div class="line">        // 旋转</div><div class="line">        .rotation(180)</div><div class="line">        .rotationX(180)</div><div class="line">        .rotationBy(180)</div><div class="line">        .rotationY(180)</div><div class="line">        .rotationYBy(180)</div><div class="line">        // 持续时间</div><div class="line">        .setDuration(1000)</div><div class="line">        // 动画开始时执行 runnable，API 16 添加</div><div class="line">        .withStartAction(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">        // 动画结束时执行 runnable，API 16 添加</div><div class="line">        .withEndAction(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">        .withLayer()            // 硬件加速,API 16添加</div><div class="line">        .setStartDelay(1000)    // 执行延迟</div><div class="line">        // 设置插值器</div><div class="line">        .setInterpolator(new LinearInterpolator())</div><div class="line">        // 设置更新监听</div><div class="line">        .setUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onAnimationUpdate(ValueAnimator animation) &#123;&#125;</div><div class="line">        &#125;)</div><div class="line">        // 动画监听</div><div class="line">        .setListener(new Animator.AnimatorListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onAnimationStart(Animator animation) &#123;&#125;</div><div class="line">            @Override</div><div class="line">            public void onAnimationEnd(Animator animation) &#123;&#125;</div><div class="line">            @Override</div><div class="line">            public void onAnimationCancel(Animator animation) &#123;&#125;</div><div class="line">            @Override</div><div class="line">            public void onAnimationRepeat(Animator animation) &#123;&#125;</div><div class="line">        &#125;)</div><div class="line">        .start();</div></pre></td></tr></table></figure>
<p>举例说明一下 xxxX() 和 xxxXBy() 函数之间的区别。如 scaleY(2f) 和 scaleYBy(2f)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private TextView tv1, tv2;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.act_main);</div><div class="line"></div><div class="line">        Button startBtn = findViewById(R.id.start_btn);</div><div class="line">        tv1 = findViewById(R.id.tv1);</div><div class="line">        tv2 = findViewById(R.id.tv2);</div><div class="line"></div><div class="line">        startBtn.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                tv1.animate().scaleX(2f);</div><div class="line">                tv2.animate().scaleXBy(2f);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>原图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-4c85d0f46e0e3cea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>第一次点击开始动画按钮，效果图如下所示：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-f744e1aa04b08df1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>第二次点击开始动画按钮，效果图如下所示：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-aa7a1ac92a785e49.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/04/Custom View/04.1 精通自定义 View 之属性动画进阶（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/04/Custom View/04.1 精通自定义 View 之属性动画进阶（一）/" itemprop="url">04.1 精通自定义 View 之属性动画进阶（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-04T01:00:00+08:00">
                2019-07-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Custom-View/" itemprop="url" rel="index">
                    <span itemprop="name">Custom View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="4-1-PropertyValuesHolder-与-Keyframe"><a href="#4-1-PropertyValuesHolder-与-Keyframe" class="headerlink" title="4.1 PropertyValuesHolder 与 Keyframe"></a>4.1 PropertyValuesHolder 与 Keyframe</h2><p>ValueAnimator、ObjectAnimator 除了 ofInt()、ofFloat()、ofObject() 函数创建 Animator 实例的方法以外，都还有一个方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// valueAnimator 的</div><div class="line">public static ValueAnimator ofPropertyValuesHolder (</div><div class="line">    PropertyValuesHolder... values) </div><div class="line">// ObjectAnimator的</div><div class="line">public static ObjectAnimator ofPropertyValuesHolder (</div><div class="line">    Object target,PropertyValuesHolder... values)</div></pre></td></tr></table></figure></p>
<h4 id="4-1-1-PropertyValuesHolder"><a href="#4-1-1-PropertyValuesHolder" class="headerlink" title="4.1.1 PropertyValuesHolder"></a>4.1.1 PropertyValuesHolder</h4><h6 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h6><p>PropertyValuesHolder 这个类的意义就是，它其中保存了动画过程中所需要操作的属性和对应的值。我们通过 ofFloat(Object target, String propertyName, float… values) 构造的动画，ofFloat() 的内部实现其实就是将传进来的参数封装成 PropertyValuesHolder 实例来保存动画状态。在封装成 PropertyValuesHolder 实例以后，后期的各种操作也是以 PropertyValuesHolder 为主的。</p>
<p>PropertyValuesHolder 中有很多函数，有些函数的 api 等级是11，有些函数的 api 等级是 14 和 21，具体参考文档<a href="http://developer.android.com/reference/android/animation/PropertyValuesHolder.html" target="_blank" rel="external">《Google：PropertyValuesHolder》</a></p>
<p>首先，我们来看看创建实例的函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public static PropertyValuesHolder ofFloat(String propertyName, float... values)</div><div class="line">public static PropertyValuesHolder ofInt(String propertyName, int... values) </div><div class="line">public static PropertyValuesHolder ofObject(String propertyName, TypeEvaluator evaluator, Object... values)</div><div class="line">public static PropertyValuesHolder ofKeyframe(String propertyName, Keyframe... values)</div></pre></td></tr></table></figure></p>
<h6 id="2-PropertyValuesHolder-之-ofFloat-、ofInt"><a href="#2-PropertyValuesHolder-之-ofFloat-、ofInt" class="headerlink" title="2. PropertyValuesHolder 之 ofFloat()、ofInt()"></a>2. PropertyValuesHolder 之 ofFloat()、ofInt()</h6><p>1）ofFloat()、ofInt()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public static PropertyValuesHolder ofFloat(String propertyName, float... values)</div><div class="line">public static PropertyValuesHolder ofInt(String propertyName, int... values)</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>propertyName</strong>：表示 ObjectAnimator 需要操作的属性名。即 ObjectAnimator 需要通过反射查找对应属性的 setProperty() 函数的那个 property.</li>
<li><strong>values</strong>：属性所对应的参数，同样是可变长参数，可以指定多个，还记得我们在 ObjectAnimator 中讲过，如果只指定了一个，那么 ObjectAnimator 会通过查找 getProperty() 方法来获得初始值。</li>
</ul>
<p>2）ObjectAnimator.ofPropertyValuesHolder()<br>ObjectAnimator 提供了一个方法，构造 PropertyValuesHolder 来构造动画。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public static ObjectAnimator ofPropertyValuesHolder(Object target, </div><div class="line">        PropertyValuesHolder... values)</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>target</strong>：指需要执行动画的控件。</li>
<li><strong>values</strong>：是一个可变长参数，可以传进去多个PropertyValuesHolder 实例，由于每个 PropertyValuesHolder 实例都会针对一个属性做动画，所以如果传进去多个 PropertyValuesHolder 实例，将会对控件的多个属性同时做动画操作。 </li>
</ul>
<p>3）示例</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-f17b350f2aa6422b.gif?imageMogr2/auto-orient/strip" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private TextView mTv;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.act_main);</div><div class="line"></div><div class="line">        Button startBtn = findViewById(R.id.start_btn);</div><div class="line">        mTv = findViewById(R.id.tv);</div><div class="line"></div><div class="line">        startBtn.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                startAnim();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void startAnim() &#123;</div><div class="line">        PropertyValuesHolder rotationHolder = PropertyValuesHolder.ofFloat(&quot;rotation&quot;,</div><div class="line">                60f, -60f, 40f, -40f, 20f, -20f, 10f, -10f, 0f);</div><div class="line">        PropertyValuesHolder alphaHolder = PropertyValuesHolder.ofFloat(&quot;alpha&quot;,</div><div class="line">                0.1f, 1f, 0.1f, 1f);</div><div class="line">        ObjectAnimator animator = ObjectAnimator.ofPropertyValuesHolder(mTv, rotationHolder, alphaHolder);</div><div class="line">        animator.setDuration(3000);</div><div class="line">        animator.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h6 id="3-PropertyValuesHolder-之-ofObject"><a href="#3-PropertyValuesHolder-之-ofObject" class="headerlink" title="3. PropertyValuesHolder 之 ofObject()"></a>3. PropertyValuesHolder 之 ofObject()</h6><p>1）概述<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public static PropertyValuesHolder ofObject(String propertyName, </div><div class="line">        TypeEvaluator evaluator, Object... values)</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>propertyName</strong>：ObjectAnimator 动画操作的属性名。</li>
<li><strong>evaluator</strong>：Evaluator 实例，Evaluator 是将当前动画进度计算出当前值的类，可以使用系统自带的 IntEvaluator、FloatEvaluator 也可以自定义。</li>
<li><strong>values</strong>：可变长参数，表示操作动画属性的值。</li>
</ul>
<p>2）示例：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-db0243fadce74f39.gif?imageMogr2/auto-orient/strip" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private TextView mTv;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.act_main);</div><div class="line"></div><div class="line">        Button startBtn = findViewById(R.id.start_btn);</div><div class="line">        mTv = findViewById(R.id.tv);</div><div class="line"></div><div class="line">        startBtn.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                startAnim();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void startAnim() &#123;</div><div class="line">        PropertyValuesHolder charHolder = PropertyValuesHolder.ofObject(&quot;CharText&quot;,</div><div class="line">                new CharEvaluator(), Character.valueOf(&apos;A&apos;), Character.valueOf(&apos;Z&apos;));</div><div class="line">        ObjectAnimator animator = ObjectAnimator.ofPropertyValuesHolder(mTv, charHolder);</div><div class="line">        animator.setDuration(3000);</div><div class="line">        animator.setInterpolator(new AccelerateInterpolator());</div><div class="line">        animator.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>自定义 View 和 Evaluator<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class MyTextView extends AppCompatTextView &#123;</div><div class="line">    private Character charText;</div><div class="line"></div><div class="line">    public MyTextView(Context context, @Nullable AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setCharText(Character charText) &#123;</div><div class="line">        setText(String.valueOf(charText));</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class CharEvaluator implements TypeEvaluator&lt;Character&gt; &#123;</div><div class="line">    @Override</div><div class="line">    public Character evaluate(float fraction, Character startValue, Character endValue) &#123;</div><div class="line">        int startInt = (int) startValue;</div><div class="line">        int endInt = (int) endValue;</div><div class="line">        int result = (int) (startInt + fraction * (endInt - startInt));</div><div class="line">        return (char) result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="4-1-2-Keyframe"><a href="#4-1-2-Keyframe" class="headerlink" title="4.1.2 Keyframe"></a>4.1.2 Keyframe</h4><h6 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1. 概述"></a>1. 概述</h6><p>如果要控制动画速率的变化，可以通过自定义插值器，也可以通过自定义 Evaluator 来实现。但需要足够的数学知识。 为了解决方便的控制动画速率的问题，谷歌为了我们定义了一个 KeyFrame 的类，KeyFrame 直译过来就是关键帧。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static Keyframe ofFloat(float fraction, float value)</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>fraction</strong>：表示当前的显示进度，即从加速器中 getInterpolation() 函数的返回值。</li>
<li><strong>value</strong>：表示当前应该在的位置。</li>
</ul>
<p>比如 Keyframe.ofFloat(0, 0) 表示动画进度为 0 时，动画所在的数值位置为 0；Keyframe.ofFloat(0.25f, -20f) 表示动画进度为 25% 时，动画所在的数值位置为 -20；Keyframe.ofFloat(1f, 0) 表示动画结束时，动画所在的数值位置为 0。</p>
<p>PropertyValuesHolder 是这样使用 KeyFrame 对象的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static PropertyValuesHolder ofKeyframe(String propertyName, Keyframe... values)</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>propertyName</strong>：动画所要操作的属性名。</li>
<li><strong>values</strong>：Keyframe 的列表，PropertyValuesHolder 会根据每个 Keyframe 的设定，定时将指定的值输出给动画。</li>
</ul>
<p>所以完整的 KeyFrame 的使用代码应该是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Keyframe frame0 = Keyframe.ofFloat(0f, 0);</div><div class="line">Keyframe frame1 = Keyframe.ofFloat(0.1f, -20f);</div><div class="line">Keyframe frame2 = Keyframe.ofFloat(1, 0);</div><div class="line">PropertyValuesHolder frameHolder = PropertyValuesHolder.ofKeyframe(</div><div class="line">        &quot;rotation&quot;,frame0,frame1,frame2);</div><div class="line">Animator animator = ObjectAnimator.ofPropertyValuesHolder(mImage,frameHolder);</div><div class="line">animator.setDuration(1000);</div><div class="line">animator.start();</div></pre></td></tr></table></figure></p>
<h6 id="2-示例"><a href="#2-示例" class="headerlink" title="2. 示例"></a>2. 示例</h6><p><img src="https://upload-images.jianshu.io/upload_images/14186083-29d2aa9f6df19102.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>1）布局文件 act_main.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:orientation=&quot;vertical&quot;</div><div class="line">    android:padding=&quot;20dp&quot;&gt;</div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/start_btn&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;start animation&quot;/&gt;</div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/tel_img&quot;</div><div class="line">        android:layout_width=&quot;70dp&quot;</div><div class="line">        android:layout_height=&quot;70dp&quot;</div><div class="line">        android:layout_margin=&quot;30dp&quot;</div><div class="line">        android:src=&quot;@drawable/icon_tel&quot;/&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>2）MainActivity.java 核心代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Keyframe frame0 = Keyframe.ofFloat(0f, 0);</div><div class="line">Keyframe frame1 = Keyframe.ofFloat(0.1f, -20f);</div><div class="line">Keyframe frame2 = Keyframe.ofFloat(0.2f, 20f);</div><div class="line">Keyframe frame3 = Keyframe.ofFloat(0.3f, -20f);</div><div class="line">Keyframe frame4 = Keyframe.ofFloat(0.4f, 20f);</div><div class="line">Keyframe frame5 = Keyframe.ofFloat(0.5f, -20f);</div><div class="line">Keyframe frame6 = Keyframe.ofFloat(0.6f, 20f);</div><div class="line">Keyframe frame7 = Keyframe.ofFloat(0.7f, -20f);</div><div class="line">Keyframe frame8 = Keyframe.ofFloat(0.8f, 20f);</div><div class="line">Keyframe frame9 = Keyframe.ofFloat(0.9f, -20f);</div><div class="line">Keyframe frame10 = Keyframe.ofFloat(1f, 0);</div><div class="line">PropertyValuesHolder frameHolder = PropertyValuesHolder.ofKeyframe(&quot;rotation&quot;,</div><div class="line">        frame0, frame1, frame2, frame3, frame4, frame5,</div><div class="line">        frame6, frame7, frame8, frame9, frame10);</div><div class="line">Animator animator = ObjectAnimator.ofPropertyValuesHolder(mView, frameHolder);</div><div class="line">animator.setDuration(2000);</div><div class="line">animator.start();</div></pre></td></tr></table></figure></p>
<h6 id="3-ofInt-和-ofFloat"><a href="#3-ofInt-和-ofFloat" class="headerlink" title="3. ofInt 和 ofFloat"></a>3. ofInt 和 ofFloat</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// ofFloat</div><div class="line">public static Keyframe ofFloat(float fraction) </div><div class="line">public static Keyframe ofFloat(float fraction, float value)</div><div class="line">// ofInt</div><div class="line">public static Keyframe ofInt(float fraction)</div><div class="line">public static Keyframe ofInt(float fraction, int value)</div></pre></td></tr></table></figure>
<p>fraction 表示当前关键帧所在的动画进度位置，value 表示当前位置所对应的值。</p>
<p>Keyframe 还有一些常用函数来设置 fraction，value 和 interpolator，定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 设置fraction参数，即Keyframe所对应的进度</div><div class="line">public void setFraction(float fraction) </div><div class="line">// 设置当前Keyframe所对应的值</div><div class="line">public void setValue(Object value)</div><div class="line">// 设置Keyframe动作期间所对应的插值器</div><div class="line">public void setInterpolator(TimeInterpolator interpolator)</div></pre></td></tr></table></figure></p>
<p>如果使用 ofFloat(float fraction) 来构造，也必须使用 setValue(Object value) 来设置这个关键帧所对应的值。</p>
<h6 id="4-插值器"><a href="#4-插值器" class="headerlink" title="4. 插值器"></a>4. 插值器</h6><p>如果给某个 Keyframe 设置上插值器，那么这个插值器就是从上一个 Keyframe 开始到当前设置插值器的 Keyframe 时，这个过程值的计算是利用这个插值器的，比如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Keyframe frame0 = Keyframe.ofFloat(0f, 0);</div><div class="line">Keyframe frame1 = Keyframe.ofFloat(0.1f, -20f);</div><div class="line">frame1.setInterpolator(new BounceInterpolator());</div><div class="line">Keyframe frame2 = Keyframe.ofFloat(1f, 20f);</div><div class="line">frame2.setInterpolator(new LinearInterpolator());</div></pre></td></tr></table></figure></p>
<p>在上面的代码中，我们给 frame1 设置了插值器 BounceInterpolator，那么在 frame0 到 frame1 的中间值计算过程中，就是用的就是回弹插值器；同样，我们给 frame2 设置了线性插值器 LinearInterpolator，所以在 frame1 到 frame2 的中间值计算过程中，使用的就是线性插值器。很显然，给 Keyframe.ofFloat(0f, 0) 设置插值器是无效的，因为它是第一帧。</p>
<h6 id="5-Keyframe-之-ofObject"><a href="#5-Keyframe-之-ofObject" class="headerlink" title="5. Keyframe 之 ofObject"></a>5. Keyframe 之 ofObject</h6><p><img src="https://upload-images.jianshu.io/upload_images/14186083-f02d1264fbae982f.gif?imageMogr2/auto-orient/strip" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public static Keyframe ofObject(float fraction)</div><div class="line">public static Keyframe ofObject(float fraction, Object value)</div></pre></td></tr></table></figure>
<p>同样，如果使用 ofObject(float fraction) 来构造，也必须使用 setValue(Object value) 来设置这个关键帧所对应的值。</p>
<p>还以 TextView 更改字母的例子来使用下 Keyframe.ofObject：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Keyframe frame0 = Keyframe.ofObject(0f, Character.valueOf(&apos;A&apos;));</div><div class="line">Keyframe frame1 = Keyframe.ofObject(0.1f, Character.valueOf(&apos;L&apos;));</div><div class="line">Keyframe frame2 = Keyframe.ofObject(1f, Character.valueOf(&apos;Z&apos;));</div><div class="line">PropertyValuesHolder frameHolder = PropertyValuesHolder.ofKeyframe(&quot;CharText&quot;,</div><div class="line">        frame0, frame1, frame2);</div><div class="line">frameHolder.setEvaluator(new CharEvaluator());</div><div class="line">Animator animator = ObjectAnimator.ofPropertyValuesHolder(mView, frameHolder);</div><div class="line">animator.setDuration(2000);</div><div class="line">animator.start();</div></pre></td></tr></table></figure></p>
<h6 id="6-疑问：如果没有设置进度为0或者进度为1时的关键帧，展示是怎样的？"><a href="#6-疑问：如果没有设置进度为0或者进度为1时的关键帧，展示是怎样的？" class="headerlink" title="6. 疑问：如果没有设置进度为0或者进度为1时的关键帧，展示是怎样的？"></a>6. 疑问：如果没有设置进度为0或者进度为1时的关键帧，展示是怎样的？</h6><ul>
<li>如果去掉第 0 帧，将以第一个关键帧为起始位置。</li>
<li>如果去掉结束帧，将以最后一个关键帧为结束位置。</li>
<li>使用 Keyframe 来构建动画，至少要有两个或两个以上帧，否则奔溃。</li>
</ul>
<h4 id="4-1-3-PropertyValuesHolder-其他函数"><a href="#4-1-3-PropertyValuesHolder-其他函数" class="headerlink" title="4.1.3 PropertyValuesHolder 其他函数"></a>4.1.3 PropertyValuesHolder 其他函数</h4><p>PropertyValuesHolder 除了上面的讲到的 ofInt、ofFloat、ofObject、ofKeyframe 以外，API 11 的还有几个函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// 设置动画的Evaluator</div><div class="line">public void setEvaluator(TypeEvaluator evaluator)</div><div class="line">// 用于设置ofFloat所对应的动画值列表</div><div class="line">public void setFloatValues(float... values)</div><div class="line">// 用于设置ofInt所对应的动画值列表</div><div class="line">public void setIntValues(int... values)</div><div class="line">// 用于设置ofKeyframe所对应的动画值列表</div><div class="line">public void setKeyframes(Keyframe... values)</div><div class="line">// 用于设置ofObject所对应的动画值列表</div><div class="line">public void setObjectValues(Object... values)</div><div class="line">// 设置动画属性名</div><div class="line">public void setPropertyName(String propertyName)</div></pre></td></tr></table></figure></p>
<h4 id="4-1-4-示例：电话响铃效果"><a href="#4-1-4-示例：电话响铃效果" class="headerlink" title="4.1.4 示例：电话响铃效果"></a>4.1.4 示例：电话响铃效果</h4><p><img src="https://upload-images.jianshu.io/upload_images/14186083-81f9947638db226f.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>核心代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">// 左右晃动</div><div class="line">Keyframe frame0 = Keyframe.ofFloat(0f, 0);</div><div class="line">Keyframe frame1 = Keyframe.ofFloat(0.1f, -20f);</div><div class="line">Keyframe frame2 = Keyframe.ofFloat(0.2f, 20f);</div><div class="line">Keyframe frame3 = Keyframe.ofFloat(0.3f, -20f);</div><div class="line">Keyframe frame4 = Keyframe.ofFloat(0.4f, 20f);</div><div class="line">Keyframe frame5 = Keyframe.ofFloat(0.5f, -20f);</div><div class="line">Keyframe frame6 = Keyframe.ofFloat(0.6f, 20f);</div><div class="line">Keyframe frame7 = Keyframe.ofFloat(0.7f, -20f);</div><div class="line">Keyframe frame8 = Keyframe.ofFloat(0.8f, 20f);</div><div class="line">Keyframe frame9 = Keyframe.ofFloat(0.9f, -20f);</div><div class="line">Keyframe frame10 = Keyframe.ofFloat(1f, 0);</div><div class="line">PropertyValuesHolder frameHolder = PropertyValuesHolder.ofKeyframe(&quot;rotation&quot;,</div><div class="line">        frame0, frame1, frame2, frame3, frame4, frame5,</div><div class="line">        frame6, frame7, frame8, frame9, frame10);</div><div class="line">// X 轴缩放</div><div class="line">Keyframe scaleXFrame0 = Keyframe.ofFloat(0f, 1);</div><div class="line">Keyframe scaleXFrame1 = Keyframe.ofFloat(0.1f, 1.2f);</div><div class="line">Keyframe scaleXFrame9 = Keyframe.ofFloat(0.9f, 1.2f);</div><div class="line">Keyframe scaleXFrame10 = Keyframe.ofFloat(1f, 1);</div><div class="line">PropertyValuesHolder scaleXholder = PropertyValuesHolder.ofKeyframe(&quot;scaleX&quot;,</div><div class="line">        scaleXFrame0, scaleXFrame1, scaleXFrame9, scaleXFrame10);</div><div class="line">// Y 轴缩放</div><div class="line">Keyframe scaleYFrame0 = Keyframe.ofFloat(0f, 1);</div><div class="line">Keyframe scaleYFrame1 = Keyframe.ofFloat(0.1f, 1.2f);</div><div class="line">Keyframe scaleYFrame9 = Keyframe.ofFloat(0.9f, 1.2f);</div><div class="line">Keyframe scaleYFrame10 = Keyframe.ofFloat(1f, 1);</div><div class="line">PropertyValuesHolder scaleYholder = PropertyValuesHolder.ofKeyframe(&quot;scaleY&quot;,</div><div class="line">        scaleYFrame0, scaleYFrame1, scaleYFrame9, scaleYFrame10);</div><div class="line"></div><div class="line">Animator animator = ObjectAnimator.ofPropertyValuesHolder(mView,</div><div class="line">        frameHolder, scaleXholder, scaleYholder);</div><div class="line">animator.setDuration(2000);</div><div class="line">animator.start();</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/03/Custom View/03.6 精通自定义 View 之属性动画（六）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/03/Custom View/03.6 精通自定义 View 之属性动画（六）/" itemprop="url">03.6 精通自定义 View 之属性动画（六）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-03T06:00:00+08:00">
                2019-07-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Custom-View/" itemprop="url" rel="index">
                    <span itemprop="name">Custom View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="3-6-Animator-动画的-XML-实现"><a href="#3-6-Animator-动画的-XML-实现" class="headerlink" title="3.6 Animator 动画的 XML 实现"></a>3.6 Animator 动画的 XML 实现</h2><p>在 xml 中对应 animator 总共有三个标签，分别是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;animator /&gt;: 对应ValueAnimator</div><div class="line">&lt;objectAnimator /&gt;: 对应ObjectAnimator</div><div class="line">&lt;set /&gt;: 对应AnimatorSet</div></pre></td></tr></table></figure></p>
<h4 id="3-6-1-animator-标签"><a href="#3-6-1-animator-标签" class="headerlink" title="3.6.1 animator 标签"></a>3.6.1 animator 标签</h4><h6 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h6><p>下面是完整的 animator 所有的字段及取值范围：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;animator</div><div class="line">    android:duration=&quot;int&quot;</div><div class="line">    android:valueFrom=&quot;float | int | color&quot;</div><div class="line">    android:valueTo=&quot;float | int | color&quot;</div><div class="line">    android:startOffset=&quot;int&quot;</div><div class="line">    android:repeatCount=&quot;int&quot;</div><div class="line">    android:repeatMode=[&quot;repeat&quot; | &quot;reverse&quot;]</div><div class="line">    android:valueType=[&quot;intType&quot; | &quot;floatType&quot;]</div><div class="line">    android:interpolator=[&quot;@android:interpolator/XXX&quot;]/&gt;</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>android:duration</strong>：每次动画播放的时长。</li>
<li><strong>android:valueFrom</strong>：初始动化值；取值范围为 float、int 和 color，如果取值为 float 对应的值样式应该为 89.0，取值为 Int 时，对应的值样式为：89；当取值为 clolor 时，对应的值样式为 #333333。</li>
<li><strong>android:valueTo</strong>：动画结束值；取值范围同样是 float、int 和 color 这三种类型的值。</li>
<li><strong>android:startOffset</strong>：动画激活延时；对应代码中的 startDelay(long delay) 函数；</li>
<li><strong>android:repeatCount</strong>：动画重复次数</li>
<li><strong>android:repeatMode</strong>：动画重复模式，取值为 repeat 和 reverse；repeat 表示正序重播，reverse 表示倒序重播</li>
<li><strong>android:valueType</strong>：表示参数值类型，取值为 intType 和 floatType；与 android:valueFrom、android:valueTo 相对应。如果这里的取值为 intType，那么 android:valueFrom、android:valueTo 的值也就要对应的是 int 类型的数值。如果这里的数值是 floatType，那么 android:valueFrom、android:valueTo 的值也要对应的设置为 float 类型的值。非常注意的是，如果 android:valueFrom、android:valueTo 的值设置为 color 类型的值，那么不需要设置这个参数。</li>
<li><strong>android:interpolator</strong>：设置加速器；有关系统加速器所对应的 xml 值对照表如下：</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-cf80cc3cfd34b03a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>加载 XML 文件到程序中的方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ValueAnimator valueAnimator = (ValueAnimator) AnimatorInflater.loadAnimator(</div><div class="line">    MainActivity.this,R.animator.animator);</div><div class="line">valueAnimator.start();</div></pre></td></tr></table></figure></p>
<h6 id="2-示例"><a href="#2-示例" class="headerlink" title="2. 示例"></a>2. 示例</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;animator xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">          android:valueFrom=&quot;0&quot;</div><div class="line">          android:valueTo=&quot;300&quot;</div><div class="line">          android:duration=&quot;1000&quot;</div><div class="line">          android:valueType=&quot;intType&quot;</div><div class="line">          android:interpolator=&quot;@android:anim/bounce_interpolator&quot;/&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">ValueAnimator valueAnimator = (ValueAnimator) AnimatorInflater.loadAnimator(</div><div class="line">        MainActivity.this, R.animator.animator);</div><div class="line">valueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">   @Override</div><div class="line">   public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">       int offset = (int)animation.getAnimatedValue();</div><div class="line">       mTv1.layout(offset, offset, mTv1.getWidth() + offset,</div><div class="line">                   mTv1.getHeight() + offset);</div><div class="line">   &#125;</div><div class="line">&#125;);</div><div class="line">valueAnimator.start();</div></pre></td></tr></table></figure>
<h4 id="3-6-2-objectAnimator-标签"><a href="#3-6-2-objectAnimator-标签" class="headerlink" title="3.6.2 objectAnimator 标签"></a>3.6.2 objectAnimator 标签</h4><h6 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1. 概述"></a>1. 概述</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;objectAnimator</div><div class="line">    android:propertyName=&quot;string&quot;</div><div class="line">    android:duration=&quot;int&quot;</div><div class="line">    android:valueFrom=&quot;float | int | color&quot;</div><div class="line">    android:valueTo=&quot;float | int | color&quot;</div><div class="line">    android:startOffset=&quot;int&quot;</div><div class="line">    android:repeatCount=&quot;int&quot;</div><div class="line">    android:repeatMode=[&quot;repeat&quot; | &quot;reverse&quot;]</div><div class="line">    android:valueType=[&quot;intType&quot; | &quot;floatType&quot;]</div><div class="line">    android:interpolator=[&quot;@android:interpolator/XXX&quot;]/&gt;</div></pre></td></tr></table></figure>
<ul>
<li><strong>android:propertyName</strong>：对应属性名，即 ObjectAnimator 所需要操作的属性名。其它字段的意义与 animator 的意义与取值是一样的，下面再重新列举一下。</li>
</ul>
<h6 id="2-示例-1"><a href="#2-示例-1" class="headerlink" title="2. 示例"></a>2. 示例</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;objectAnimator xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:propertyName=&quot;TranslationY&quot;</div><div class="line">    android:duration=&quot;2000&quot;</div><div class="line">    android:valueFrom=&quot;0.0&quot;</div><div class="line">    android:valueTo=&quot;400.0&quot;</div><div class="line">    android:interpolator=&quot;@android:anim/accelerate_interpolator&quot;</div><div class="line">    android:valueType=&quot;floatType&quot;</div><div class="line">    android:repeatCount=&quot;1&quot;</div><div class="line">    android:repeatMode=&quot;reverse&quot;</div><div class="line">    android:startOffset=&quot;2000&quot;/&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animator = (ObjectAnimator) AnimatorInflater.loadAnimator(</div><div class="line">        MainActivity.this, R.animator.object_animator);</div><div class="line">animator.setTarget(mTv1);</div><div class="line">animator.start();</div></pre></td></tr></table></figure>
<h6 id="3-color"><a href="#3-color" class="headerlink" title="3. color"></a>3. color</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;objectAnimator xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:propertyName=&quot;BackgroundColor&quot;</div><div class="line">    android:duration=&quot;5000&quot;</div><div class="line">    android:valueFrom=&quot;#ffff00ff&quot;</div><div class="line">    android:valueTo=&quot;#ffffff00&quot;/&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animator = (ObjectAnimator) AnimatorInflater.loadAnimator(</div><div class="line">        MainActivity.this, R.animator.color_animator);</div><div class="line">animator.setTarget(mTv1);</div><div class="line">animator.start();</div></pre></td></tr></table></figure>
<h4 id="3-6-3-set-标签"><a href="#3-6-3-set-标签" class="headerlink" title="3.6.3 set 标签"></a>3.6.3 set 标签</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;set android:ordering=[&quot;together&quot; | &quot;sequentially&quot;]&gt;</div></pre></td></tr></table></figure>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:ordering=&quot;together&quot;&gt;</div><div class="line">    &lt;objectAnimator</div><div class="line">        android:propertyName=&quot;x&quot;</div><div class="line">        android:duration=&quot;500&quot;</div><div class="line">        android:valueFrom=&quot;0&quot;</div><div class="line">        android:valueTo=&quot;400&quot;</div><div class="line">        android:valueType=&quot;floatType&quot;/&gt;</div><div class="line">    &lt;objectAnimator</div><div class="line">        android:propertyName=&quot;y&quot;</div><div class="line">        android:duration=&quot;500&quot;</div><div class="line">        android:valueFrom=&quot;0&quot;</div><div class="line">        android:valueTo=&quot;300&quot;</div><div class="line">        android:valueType=&quot;floatType&quot;/&gt;</div><div class="line">&lt;/set&gt;</div></pre></td></tr></table></figure></p>
<p>加载：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">AnimatorSet set = (AnimatorSet) AnimatorInflater.loadAnimator(</div><div class="line">        MainActivity.this, R.animator.set_animator);</div><div class="line">set.setTarget(mTv1);</div><div class="line">set.start();</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/03/Custom View/03.5 精通自定义 View 之属性动画（五）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/03/Custom View/03.5 精通自定义 View 之属性动画（五）/" itemprop="url">03.5 精通自定义 View 之属性动画（五）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-03T05:00:00+08:00">
                2019-07-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Custom-View/" itemprop="url" rel="index">
                    <span itemprop="name">Custom View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="3-5-组合动画——AnimatorSet"><a href="#3-5-组合动画——AnimatorSet" class="headerlink" title="3.5 组合动画——AnimatorSet"></a>3.5 组合动画——AnimatorSet</h2><p>ValueAnimator 和 ObjectAnimator 都只能单单实现一个动画，那如果我们想要使用一个组合动画，就需要用到 AnimatorSet。</p>
<p>AnimatorSet 针对 ValueAnimator 和 ObjectAnimator 都是适用的，但一般而言，我们不会用到 ValueAnimator 的组合动画，所以我们这篇仅讲解 ObjectAnimator 下的组合动画实现。</p>
<p>在 AnimatorSet 中直接给为我们提供了两个方法 playSequentially 和 playTogether，playSequentially 表示所有动画依次播放，playTogether 表示所有动画一起开始。</p>
<h4 id="3-5-1-playSequentially-与-playTogether-函数"><a href="#3-5-1-playSequentially-与-playTogether-函数" class="headerlink" title="3.5.1 playSequentially() 与 playTogether() 函数"></a>3.5.1 playSequentially() 与 playTogether() 函数</h4><h6 id="1-playSequentially"><a href="#1-playSequentially" class="headerlink" title="1. playSequentially()"></a>1. playSequentially()</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public void playSequentially(Animator... items);</div><div class="line">public void playSequentially(List&lt;Animator&gt; items);</div></pre></td></tr></table></figure>
<p>这里有两种声明，第一个是我们最常用的，它的参数是可变长参数，也就是说我们可以传进去任意多个 Animator 对象。这些对象的动画会逐个播放。第二个构造函数，是传进去一个 List&lt; Animator&gt; 的列表。原理一样，也是逐个去取 List 中的动画对象，然后逐个播放。</p>
<p>示例：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-5e9f4c01a7c476e3.gif?imageMogr2/auto-orient/strip" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private Button mButton;</div><div class="line">    private TextView mTv1, mTv2;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.act_main);</div><div class="line"></div><div class="line">        mButton =  findViewById(R.id.btn);</div><div class="line">        mTv1 =  findViewById(R.id.tv_1);</div><div class="line">        mTv2 =  findViewById(R.id.tv_2);</div><div class="line"></div><div class="line">        mButton.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                doPlaySequentiallyAnimator();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void doPlaySequentiallyAnimator() &#123;</div><div class="line">        ObjectAnimator tv1BgAnimator = ObjectAnimator.ofInt(mTv1, </div><div class="line">                &quot;BackgroundColor&quot;, 0xffff00ff, 0xffffff00, 0xffff00ff);</div><div class="line">        ObjectAnimator tv1TranslateY = ObjectAnimator.ofFloat(mTv1, </div><div class="line">                &quot;translationY&quot;, 0, 300, 0);</div><div class="line">        ObjectAnimator tv2TranslateY = ObjectAnimator.ofFloat(mTv2, </div><div class="line">                &quot;translationY&quot;, 0, 400, 0);</div><div class="line"></div><div class="line">        AnimatorSet animatorSet = new AnimatorSet();</div><div class="line">        animatorSet.playSequentially(tv1BgAnimator, tv1TranslateY, tv2TranslateY);</div><div class="line">        animatorSet.setDuration(1000);</div><div class="line">        animatorSet.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>布局 act_main.xml：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/btn&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:padding=&quot;10dp&quot;</div><div class="line">        android:text=&quot;start anim&quot;/&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:id=&quot;@+id/tv_2&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_alignParentRight=&quot;true&quot;</div><div class="line">        android:layout_marginRight=&quot;30dp&quot;</div><div class="line">        android:background=&quot;#ff00ff&quot;</div><div class="line">        android:padding=&quot;10dp&quot;</div><div class="line">        android:text=&quot;TextView-2&quot; /&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:id=&quot;@+id/tv_1&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_toLeftOf=&quot;@id/tv_2&quot;</div><div class="line">        android:layout_marginRight=&quot;30dp&quot;</div><div class="line">        android:background=&quot;#ffff00&quot;</div><div class="line">        android:padding=&quot;10dp&quot;</div><div class="line">        android:text=&quot;TextView-1&quot; /&gt;</div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure></p>
<h6 id="2-playTogether"><a href="#2-playTogether" class="headerlink" title="2. playTogether()"></a>2. playTogether()</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public void playTogether(Animator... items);</div><div class="line">public void playTogether(Collection&lt;Animator&gt; items);</div></pre></td></tr></table></figure>
<p>将上例中的代码更改为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// animatorSet.playSequentially(tv1BgAnimator, tv1TranslateY, tv2TranslateY);</div><div class="line">animatorSet.playTogether(tv1BgAnimator, tv1TranslateY, tv2TranslateY);</div></pre></td></tr></table></figure></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-75a764faeec10d66.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>即三个动画同时播放。</p>
<h6 id="3、playSequentially-和-playTogether-函数的真正意义"><a href="#3、playSequentially-和-playTogether-函数的真正意义" class="headerlink" title="3、playSequentially 和 playTogether 函数的真正意义"></a>3、playSequentially 和 playTogether 函数的真正意义</h6><p>想必大家都看到赛马，在赛马开始前，每个马都会被放在起点的小门后面，到点了，门打开，马开始一起往前跑。而假如我们把每匹马看做是一个动画，那我们的 playTogether 就相当于赛马场里每个赛道上门的意义（当比赛开始时，每个赛道上的门会打开，马就可以开始比赛了）；也就是说，playTogether 只是一个时间点上的一起开始，对于开始后，各个动画怎么操作就是他们自己的事了，至于各个动画结不结束也是他们自已的事了。所以最恰当的描述就是门只负责打开，打开之后马咋跑，门也管不着，最后，马回不回来跟门也没啥关系。门的责任只是到点就打开而已。放在动画上，就是在激活动画之后，动画开始后的操作只是动画自己来负责。至于动画结不结束，也只有动画自己知道。</p>
<p>而 playSequentially 的意义就是当一匹马回来以后，再放另一匹。那如果上匹马永远没回来，那下一匹马也永远不会被放出来。<br>放到动画上，就是把激活一个动画之后，动画之后的操作就是动画自己来负责了，这个动画结束之后，再激活下一个动画。如果上一个动画没有结束，那下一个动画就永远也不会被激活。</p>
<p>首先用 playTogether 来看个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator tv1BgAnimator = ObjectAnimator.ofInt(mTv1,</div><div class="line">        &quot;BackgroundColor&quot;, 0xffff00ff, 0xffffff00, 0xffff00ff);</div><div class="line">ObjectAnimator tv1TranslateY = ObjectAnimator.ofFloat(mTv1,</div><div class="line">        &quot;translationY&quot;, 0, 300, 0);</div><div class="line">tv1TranslateY.setStartDelay(1000);</div><div class="line">tv1TranslateY.setRepeatCount(ValueAnimator.INFINITE);</div><div class="line">ObjectAnimator tv2TranslateY = ObjectAnimator.ofFloat(mTv2,</div><div class="line">        &quot;translationY&quot;, 0, 400, 0);</div><div class="line">tv2TranslateY.setStartDelay(1000);</div><div class="line"></div><div class="line">AnimatorSet animatorSet = new AnimatorSet();</div><div class="line">animatorSet.playTogether(tv1BgAnimator, tv1TranslateY, tv2TranslateY);</div><div class="line">animatorSet.setDuration(1000);</div><div class="line">animatorSet.start();</div></pre></td></tr></table></figure></p>
<p>在这个例子中，我们将 tv1TranslateY 开始延迟 1000 毫秒开始，并设为无限循环。tv2TranslateY 设为开始延迟 1000 毫秒。而tv1BgAnimator 则是没有任何设置，所以是默认直接开始。我们来看效果图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-aa0dd7dac5a3a77b.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>将上述例子做如下更改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// animatorSet.playTogether(tv1BgAnimator, tv1TranslateY, tv2TranslateY);</div><div class="line">animatorSet.playSequentially(tv1BgAnimator, tv1TranslateY, tv2TranslateY);</div></pre></td></tr></table></figure></p>
<p>使用 playSequentially 来逐个播放这三个动画，首先是tv1BgAnimator，动画结束之后，激活 tv1TranslateY。不过由于设置了延时，故 1000 毫秒再开始，而且该动画会无限循环。无限循环也就是说它永远也不会结束。那么第三个动画 tv2TranslateY 也永远不会开始。效果图如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-a7a097fbfc347421.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>总结：</p>
<ul>
<li>playTogether 和 playSequentially 在激活动画后，控件的动画情况与它们无关，他们只负责定时激活控件动画。</li>
<li>playSequentially 只有上一个控件做完动画以后，才会激活下一个控件的动画，如果上一控件的动画是无限循环，那下一个控件就别再指望能做动画了。</li>
</ul>
<h6 id="4-实现无限循环动画"><a href="#4-实现无限循环动画" class="headerlink" title="4. 实现无限循环动画"></a>4. 实现无限循环动画</h6><p>因为 AnimatorSet 中没有设置循环次数的函数，所以得为每个动画设置了无限循环，并且只能用 playTogether() 函数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator tv1BgAnimator = ObjectAnimator.ofInt(mTv1,</div><div class="line">        &quot;BackgroundColor&quot;, 0xffff00ff, 0xffffff00, 0xffff00ff);</div><div class="line">tv1BgAnimator.setRepeatCount(ValueAnimator.INFINITE);</div><div class="line">ObjectAnimator tv1TranslateY = ObjectAnimator.ofFloat(mTv1,</div><div class="line">        &quot;translationY&quot;, 0, 300, 0);</div><div class="line">tv1TranslateY.setRepeatCount(ValueAnimator.INFINITE);</div><div class="line">ObjectAnimator tv2TranslateY = ObjectAnimator.ofFloat(mTv2,</div><div class="line">        &quot;translationY&quot;, 0, 400, 0);</div><div class="line">tv2TranslateY.setRepeatCount(ValueAnimator.INFINITE);</div><div class="line"></div><div class="line">AnimatorSet animatorSet = new AnimatorSet();</div><div class="line">animatorSet.playTogether(tv1BgAnimator, tv1TranslateY, tv2TranslateY);</div><div class="line">animatorSet.setDuration(1000);</div><div class="line">animatorSet.start();</div></pre></td></tr></table></figure></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-d38d7f24f286dbca.gif?imageMogr2/auto-orient/strip" alt=""></p>
<h4 id="3-5-2-AnimatorSet-Builder"><a href="#3-5-2-AnimatorSet-Builder" class="headerlink" title="3.5.2 AnimatorSet.Builder"></a>3.5.2 AnimatorSet.Builder</h4><h6 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h6><p>playTogether 和 playSequentially，分别能实现一起开始动画和逐个开始动画。但并不是非常自由的组合动画，比如我们有三个动画 A、B、C 我们想先播放 C 然后同时播放 A 和 B。利用 playTogether 和 playSequentially 是没办法实现的，所以为了更方便的组合动画，谷歌的开发人员另外给我们提供一个类 AnimatorSet.Builder。</p>
<p>我们这里使用 AnimatorSet.Builder 实现两个控件一同开始动画。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator tv1BgAnimator = ObjectAnimator.ofInt(mTv1,</div><div class="line">        &quot;BackgroundColor&quot;, 0xffff00ff, 0xffffff00, 0xffff00ff);</div><div class="line">ObjectAnimator tv1TranslateY = ObjectAnimator.ofFloat(mTv1,</div><div class="line">        &quot;translationY&quot;, 0, 300, 0);</div><div class="line">ObjectAnimator tv2TranslateY = ObjectAnimator.ofFloat(mTv2,</div><div class="line">        &quot;translationY&quot;, 0, 400, 0);</div><div class="line"></div><div class="line">AnimatorSet animatorSet = new AnimatorSet();</div><div class="line">AnimatorSet.Builder builder = animatorSet.play(tv1BgAnimator);</div><div class="line">builder.with(tv1TranslateY).with(tv2TranslateY);</div><div class="line">// animatorSet.playTogether(tv1BgAnimator, tv1TranslateY, tv2TranslateY);</div><div class="line">animatorSet.setDuration(1000);</div><div class="line">animatorSet.start();</div></pre></td></tr></table></figure></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-e31f09c7c1458d53.gif?imageMogr2/auto-orient/strip" alt=""></p>
<h6 id="2-AnimatorSet-Builder-的函数"><a href="#2-AnimatorSet-Builder-的函数" class="headerlink" title="2. AnimatorSet.Builder 的函数"></a>2. AnimatorSet.Builder 的函数</h6><p>从上面的代码中，我们可以看到 AnimatorSet.Builder 是通过 animatorSet.play(tv1BgAnimator) 生成的，这是生成AnimatorSet.Builder对象的唯一途径！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// 表示要播放哪个动画</div><div class="line">public Builder play(Animator anim)</div><div class="line">// 和前面动画一起执行</div><div class="line">public Builder with(Animator anim)</div><div class="line">// 执行前面的动画后才执行该动画</div><div class="line">public Builder before(Animator anim)</div><div class="line">// 执行先执行这个动画再执行前面动画</div><div class="line">public Builder after(Animator anim)</div><div class="line">// 延迟 n 毫秒之后执行动画</div><div class="line">public Builder after(long delay)</div></pre></td></tr></table></figure></p>
<p>play(Animator anim) 表示当前在播放哪个动画，另外的 with(Animator anim)、before(Animator anim)、after(Animator anim) 都是以 play 中的当前所播放的动画为基准的。</p>
<p>比如，当 play(playAnim) 与 before(beforeAnim) 共用，则表示在播放 beforeAnim 之前，先播放 playAnim 动画；同样，当 play(playAnim) 与 after(afterAnim) 共用时，则表示在在播放 afterAnim 动画之后，再播放 playAnim 动画。</p>
<p>每个函数的返回值都是 Builder 对象，于是可以使用串行方式使用它们：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">animatorSet.play(tv1BgAnimator).with(tv1TranslateY).with(tv2TranslateY);</div></pre></td></tr></table></figure></p>
<h4 id="3-5-3-AnimatorSet-监听器"><a href="#3-5-3-AnimatorSet-监听器" class="headerlink" title="3.5.3 AnimatorSet 监听器"></a>3.5.3 AnimatorSet 监听器</h4><p>在 AnimatorSet 中也可以添加监听器，对应的监听器为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public static interface AnimatorListener &#123;</div><div class="line">    // 当AnimatorSet开始时调用</div><div class="line">    void onAnimationStart(Animator animation);</div><div class="line">    // 当AnimatorSet结束时调用</div><div class="line">    void onAnimationEnd(Animator animation);</div><div class="line">    // 当AnimatorSet被取消时调用</div><div class="line">    void onAnimationCancel(Animator animation);</div><div class="line">    /**</div><div class="line">     * 当 AnimatorSet 重复时调用，由于 AnimatorSet 没有设置 </div><div class="line">     * repeat 的函数，所以这个方法永远不会被调用。</div><div class="line">     */</div><div class="line">    void onAnimationRepeat(Animator animation);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private AnimatorSet mAnimatorSet;</div><div class="line">    private TextView mTv1, mTv2;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.act_main);</div><div class="line"></div><div class="line">        mTv1 =  findViewById(R.id.tv_1);</div><div class="line">        mTv2 =  findViewById(R.id.tv_2);</div><div class="line"></div><div class="line">        findViewById(R.id.start_btn).setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                mAnimatorSet = doPlayAnimatorSet();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        findViewById(R.id.cancel_btn).setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                if (mAnimatorSet != null) &#123;</div><div class="line">                    mAnimatorSet.cancel();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private AnimatorSet doPlayAnimatorSet() &#123;</div><div class="line">        ObjectAnimator tv1TranslateY = ObjectAnimator.ofFloat(mTv1,</div><div class="line">                &quot;translationY&quot;, 0, 400, 0);</div><div class="line">        ObjectAnimator tv2TranslateY = ObjectAnimator.ofFloat(mTv2,</div><div class="line">                &quot;translationY&quot;, 0, 400, 0);</div><div class="line">        tv2TranslateY.setRepeatCount(ValueAnimator.INFINITE);</div><div class="line"></div><div class="line">        AnimatorSet animatorSet = new AnimatorSet();</div><div class="line">        animatorSet.play(tv1TranslateY).with(tv2TranslateY);</div><div class="line">        animatorSet.addListener(new Animator.AnimatorListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onAnimationStart(Animator animation) &#123;</div><div class="line">                Log.e(&quot;xian&quot;, &quot;animator start&quot;);</div><div class="line">            &#125;</div><div class="line">            @Override</div><div class="line">            public void onAnimationEnd(Animator animation) &#123;</div><div class="line">                Log.e(&quot;xian&quot;, &quot;animator end&quot;);</div><div class="line">            &#125;</div><div class="line">            @Override</div><div class="line">            public void onAnimationCancel(Animator animation) &#123;</div><div class="line">                Log.e(&quot;xian&quot;, &quot;animator cancel&quot;);</div><div class="line">            &#125;</div><div class="line">            @Override</div><div class="line">            public void onAnimationRepeat(Animator animation) &#123;</div><div class="line">                Log.e(&quot;xian&quot;, &quot;animator repeat&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        animatorSet.setDuration(1000);</div><div class="line">        animatorSet.start();</div><div class="line"></div><div class="line">        return animatorSet;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-165bcafa582d0d1e.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>日志输出如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-41da58e3c9eab1e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>总结一下 AnimatorSet 的监听：<br>1、AnimatorSet 的监听函数也只是用来监听 AnimatorSet 的状态的，与其中的动画无关。<br>2、AnimatorSet 中没有设置循环的函数，所以 AnimatorSet 监听器中永远无法运行到 onAnimationRepeat() 中。</p>
</blockquote>
<h4 id="3-5-4-常用函数"><a href="#3-5-4-常用函数" class="headerlink" title="3.5.4 常用函数"></a>3.5.4 常用函数</h4><h6 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1. 概述"></a>1. 概述</h6><p>在 AnimatorSet 中还有几个函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 设置单次动画时长</div><div class="line">public AnimatorSet setDuration(long duration);</div><div class="line">// 设置加速器</div><div class="line">public void setInterpolator(TimeInterpolator interpolator)</div><div class="line">// 设置ObjectAnimator动画目标控件</div><div class="line">public void setTarget(Object target)</div></pre></td></tr></table></figure></p>
<p>在 AnimatorSet 中设置以后，会覆盖单个 ObjectAnimator 中的设置；即如果 AnimatorSet 中没有设置，那么就以 ObjectAnimator 中的设置为准。如果 AnimatorSet 中设置以后，ObjectAnimator 中的设置就会无效。</p>
<p>下面我们简单举个例子来看下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator tv1TranslateY = ObjectAnimator.ofFloat(mTv1, &quot;translationY&quot;, 0, 400, 0);</div><div class="line">tv1TranslateY.setDuration(500000000);</div><div class="line">tv1TranslateY.setInterpolator(new BounceInterpolator());</div><div class="line"></div><div class="line">ObjectAnimator tv2TranslateY = ObjectAnimator.ofFloat(mTv2, &quot;translationY&quot;, 0, 400, 0);</div><div class="line">tv2TranslateY.setInterpolator(new AccelerateDecelerateInterpolator());</div><div class="line"></div><div class="line">AnimatorSet animatorSet = new AnimatorSet();</div><div class="line">animatorSet.play(tv2TranslateY).with(tv1TranslateY);</div><div class="line">animatorSet.setDuration(2000);</div><div class="line">animatorSet.start();</div></pre></td></tr></table></figure></p>
<p>在第这个例子中，我们通过 animatorSet.setDuration(2000); 设置为所有动画单词运动时长为 2000 毫秒，虽然我们给 tv1TranslateY 设置了单次动画时长为 tv1TranslateY.setDuration(500000000); 但由于 AnimatorSet 设置了 setDuration(2000) 这个参数以后，单个动画的时长设置将无效。所以每个动画的时长为 2000 毫秒。</p>
<p>但我们这里还分别给 tv1 和 tv2 设置了加速器，但并没有给 AnimatorSet 设置加速器，那么 tv1、tv2 将按各自加速器的表现形式做动画。同样，如果我们给 AnimatorSet 设置上了加速器，那么单个动画中所设置的加速器都将无效，以 AnimatorSet 中的加速器为准。</p>
<h6 id="2-setTarget-Object-target-函数"><a href="#2-setTarget-Object-target-函数" class="headerlink" title="2. setTarget(Object target) 函数"></a>2. setTarget(Object target) 函数</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 设置 ObjectAnimator 动画目标控件</div><div class="line">public void setTarget(Object target)</div></pre></td></tr></table></figure>
<p>这个函数是用来设置目标控件的，也就是说，只要通过 AnimatorSet 的 setTartget 函数设置了目标控件，那么单个动画中的目标控件都以 AnimatorSet 设置的为准。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator tv1BgAnimator = ObjectAnimator.ofInt(mTv1, &quot;BackgroundColor&quot;, 0xffff00ff, 0xffffff00, 0xffff00ff);</div><div class="line">ObjectAnimator tv2TranslateY = ObjectAnimator.ofFloat(mTv2, &quot;translationY&quot;, 0, 400, 0);</div><div class="line"></div><div class="line">AnimatorSet animatorSet = new AnimatorSet();</div><div class="line">animatorSet.playTogether(tv1BgAnimator,tv2TranslateY);</div><div class="line">animatorSet.setDuration(2000);</div><div class="line">animatorSet.setTarget(mTv2);</div><div class="line">animatorSet.start();</div></pre></td></tr></table></figure></p>
<p>在这段代码中，我们给 tv1 设置了改变背景色，给 tv2 设置了上下移动。但由于我们通过 animatorSet.setTarget(mTv2); 将各个动画的目标控件设置为 mTv2，所以 tv1 将不会有任何动画，所有的动画都会发生在 tv2 上。</p>
<h6 id="3-setStartDelay-long-startDelay-函数"><a href="#3-setStartDelay-long-startDelay-函数" class="headerlink" title="3. setStartDelay(long startDelay) 函数"></a>3. setStartDelay(long startDelay) 函数</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 设置延时开始动画时长</div><div class="line">public void setStartDelay(long startDelay)</div></pre></td></tr></table></figure>
<p>上面我们讲了，当 AnimatorSet 所拥有的函数与单个动画所拥有的函数冲突时，就以 AnimatorSet 设置为准。但唯一的例外就是 setStartDelay。</p>
<ul>
<li>AnimatorSet 的延时是仅针对性的延长 AnimatorSet 激活时间的，对单个动画的延时设置没有影响。</li>
<li>AnimatorSet 真正激活延时 = AnimatorSet.startDelay + 第一个动画.startDelay</li>
<li>在 AnimatorSet 激活之后，第一个动画绝对是会开始运行的，后面的动画则根据自己是否延时自行处理。</li>
</ul>
<h4 id="3-5-5-示例：路径动画"><a href="#3-5-5-示例：路径动画" class="headerlink" title="3.5.5 示例：路径动画"></a>3.5.5 示例：路径动画</h4><p><img src="https://upload-images.jianshu.io/upload_images/14186083-669df7152448f16f.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>代码 MainActivity.java：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private Button btn1, btn2, btn3, btn4, btn5;</div><div class="line">    private boolean mIsMenuOpen = false;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.act_main);</div><div class="line"></div><div class="line">        Button menu = findViewById(R.id.menu);</div><div class="line">        btn1 = findViewById(R.id.btn1);</div><div class="line">        btn2 = findViewById(R.id.btn2);</div><div class="line">        btn3 = findViewById(R.id.btn3);</div><div class="line">        btn4 = findViewById(R.id.btn4);</div><div class="line">        btn5 = findViewById(R.id.btn5);</div><div class="line"></div><div class="line">        menu.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                if (mIsMenuOpen) &#123;</div><div class="line">                    closeMenu();</div><div class="line">                    mIsMenuOpen = false;</div><div class="line">                &#125; else &#123;</div><div class="line">                    openMenu();</div><div class="line">                    mIsMenuOpen = true;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void openMenu() &#123;</div><div class="line">        doAnimateOpen(btn1, 0, 5, 600);</div><div class="line">        doAnimateOpen(btn2, 1, 5, 600);</div><div class="line">        doAnimateOpen(btn3, 2, 5, 600);</div><div class="line">        doAnimateOpen(btn4, 3, 5, 600);</div><div class="line">        doAnimateOpen(btn5, 4, 5, 600);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void closeMenu() &#123;</div><div class="line">        doAnimatColse(btn1, 0, 5, 600);</div><div class="line">        doAnimatColse(btn2, 1, 5, 600);</div><div class="line">        doAnimatColse(btn3, 2, 5, 600);</div><div class="line">        doAnimatColse(btn4, 3, 5, 600);</div><div class="line">        doAnimatColse(btn5, 4, 5, 600);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void doAnimateOpen(View view, int index, int total, int radius) &#123;</div><div class="line">        double degree = Math.toRadians(90) / (total - 1) * index;</div><div class="line">        int translationX = -(int) (Math.sin(degree) * radius);</div><div class="line">        int translationY = -(int) (Math.cos(degree) * radius);</div><div class="line">        AnimatorSet animatorSet = new AnimatorSet();</div><div class="line">        animatorSet.playTogether(</div><div class="line">                ObjectAnimator.ofFloat(view, &quot;translationX&quot;, 0, translationX),</div><div class="line">                ObjectAnimator.ofFloat(view, &quot;translationY&quot;, 0, translationY),</div><div class="line">                ObjectAnimator.ofFloat(view, &quot;scaleX&quot;, 0f, 1f),</div><div class="line">                ObjectAnimator.ofFloat(view, &quot;scaleY&quot;, 0f, 1f),</div><div class="line">                ObjectAnimator.ofFloat(view, &quot;alpha&quot;, 0f, 1f));</div><div class="line">        animatorSet.setDuration(500);</div><div class="line">        animatorSet.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void doAnimatColse(View view, int index, int total, int radius) &#123;</div><div class="line">        double degree = Math.toRadians(90) / (total - 1) * index;</div><div class="line">        int translationX = -(int) (Math.sin(degree) * radius);</div><div class="line">        int translationY = -(int) (Math.cos(degree) * radius);</div><div class="line">        AnimatorSet animatorSet = new AnimatorSet();</div><div class="line">        animatorSet.playTogether(</div><div class="line">                ObjectAnimator.ofFloat(view, &quot;translationX&quot;, translationX, 0),</div><div class="line">                ObjectAnimator.ofFloat(view, &quot;translationY&quot;, translationY, 0),</div><div class="line">                ObjectAnimator.ofFloat(view, &quot;scaleX&quot;, 1f, 0f),</div><div class="line">                ObjectAnimator.ofFloat(view, &quot;scaleY&quot;, 1f, 0f),</div><div class="line">                ObjectAnimator.ofFloat(view, &quot;alpha&quot;, 1f, 0f));</div><div class="line">        animatorSet.setDuration(500);</div><div class="line">        animatorSet.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>布局文件 act_main：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;FrameLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:padding=&quot;20dp&quot;&gt;</div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/btn1&quot;</div><div class="line">        style=&quot;@style/MenuItemStyle&quot;</div><div class="line">        android:background=&quot;@drawable/circle1&quot;/&gt;</div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/btn2&quot;</div><div class="line">        style=&quot;@style/MenuItemStyle&quot;</div><div class="line">        android:background=&quot;@drawable/circle2&quot;/&gt;</div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/btn3&quot;</div><div class="line">        style=&quot;@style/MenuItemStyle&quot;</div><div class="line">        android:background=&quot;@drawable/circle3&quot;/&gt;</div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/btn4&quot;</div><div class="line">        style=&quot;@style/MenuItemStyle&quot;</div><div class="line">        android:background=&quot;@drawable/circle4&quot;/&gt;</div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/btn5&quot;</div><div class="line">        style=&quot;@style/MenuItemStyle&quot;</div><div class="line">        android:background=&quot;@drawable/circle5&quot;/&gt;</div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/menu&quot;</div><div class="line">        style=&quot;@style/MenuStyle&quot;</div><div class="line">        android:background=&quot;@drawable/circle&quot;/&gt;</div><div class="line">&lt;/FrameLayout&gt;</div></pre></td></tr></table></figure></p>
<p>引用资源 circle.xml：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:shape=&quot;oval&quot;&gt;</div><div class="line">    &lt;solid android:color=&quot;@color/colorAccent&quot;/&gt;</div><div class="line">    &lt;solid android:color=&quot;#983B90&quot;/&gt;</div><div class="line">    &lt;solid android:color=&quot;#785B90&quot;/&gt;</div><div class="line">    &lt;solid android:color=&quot;#587BA0&quot;/&gt;</div><div class="line">    &lt;solid android:color=&quot;#389BF0&quot;/&gt;</div><div class="line">    &lt;solid android:color=&quot;#18DB00&quot;/&gt;</div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure></p>
<p>主题样式 style.xml：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;resources&gt;</div><div class="line">    ...</div><div class="line">    &lt;style name=&quot;MenuStyle&quot; &gt;</div><div class="line">        &lt;item name=&quot;android:layout_width&quot;&gt;50dp&lt;/item&gt;</div><div class="line">        &lt;item name=&quot;android:layout_height&quot;&gt;50dp&lt;/item&gt;</div><div class="line">        &lt;item name=&quot;android:layout_gravity&quot;&gt;right|bottom&lt;/item&gt;</div><div class="line">    &lt;/style&gt;</div><div class="line">    &lt;style name=&quot;MenuItemStyle&quot; &gt;</div><div class="line">        &lt;item name=&quot;android:layout_width&quot;&gt;40dp&lt;/item&gt;</div><div class="line">        &lt;item name=&quot;android:layout_height&quot;&gt;40dp&lt;/item&gt;</div><div class="line">        &lt;item name=&quot;android:layout_margin&quot;&gt;5dp&lt;/item&gt;</div><div class="line">        &lt;item name=&quot;android:layout_gravity&quot;&gt;right|bottom&lt;/item&gt;</div><div class="line">    &lt;/style&gt;</div><div class="line">&lt;/resources&gt;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/03/Custom View/03.4 精通自定义 View 之属性动画（四）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/03/Custom View/03.4 精通自定义 View 之属性动画（四）/" itemprop="url">03.4 精通自定义 View 之属性动画（四）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-03T04:00:00+08:00">
                2019-07-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Custom-View/" itemprop="url" rel="index">
                    <span itemprop="name">Custom View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="3-4-ObjectAnimator"><a href="#3-4-ObjectAnimator" class="headerlink" title="3.4 ObjectAnimator"></a>3.4 ObjectAnimator</h2><h4 id="3-4-1-概述"><a href="#3-4-1-概述" class="headerlink" title="3.4.1 概述"></a>3.4.1 概述</h4><h6 id="1-引入"><a href="#1-引入" class="headerlink" title="1. 引入"></a>1. 引入</h6><p>ObjectAnimator 派生自 ValueAnimator，所以 ValueAnimator 能用的方法，ObjectAnimator 都能用，ObjectAnimator 是 ValueAnimator 的子类。</p>
<p>ObjectAnimator 重载了几个方法，例如 ofInt()，ofFloat() 等，这里我以 ofFloat() 做个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animator = ObjectAnimator.ofFloat(mView, &quot;alpha&quot;, 1, 0, 1);</div><div class="line">animator.setDuration(2000);</div><div class="line">animator.start();</div></pre></td></tr></table></figure></p>
<p>其构造函数如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static ObjectAnimator ofFloat(Object target, String propertyName,  float... values)</div></pre></td></tr></table></figure></p>
<ul>
<li>第一个参数用于指定这个动画要操作的是哪个控件。</li>
<li>第二个参数用于指定这个动画要操作这个控件的哪个属性。</li>
<li>第三个参数是可变长参数，是指这个属性值如何变化。</li>
</ul>
<h6 id="2-set-函数"><a href="#2-set-函数" class="headerlink" title="2. set 函数"></a>2. set 函数</h6><p>ObjectAnimator 做动画，是通过指定属性所对应的 set 方法来改变的。比如，我们上面指定的改变 alpha 的属性值，ObjectAnimator 在做动画时就会到指定控件（TextView）中去找对应的 setAlpha() 方法来改变控件中对应的值。在 View 中有关动画，总共有下面几组 set 方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// 1. 透明度：alpha  </div><div class="line">public void setAlpha(float alpha)  </div><div class="line">  </div><div class="line">// 2. 旋转度数：rotation、rotationX、rotationY  </div><div class="line">public void setRotation(float rotation)  </div><div class="line">public void setRotationX(float rotationX)  </div><div class="line">public void setRotationY(float rotationY)  </div><div class="line">  </div><div class="line">// 3. 平移：translationX、translationY  </div><div class="line">public void setTranslationX(float translationX)   </div><div class="line">public void setTranslationY(float translationY)  </div><div class="line">  </div><div class="line">// 4. 缩放：scaleX、scaleY  </div><div class="line">public void setScaleX(float scaleX)  </div><div class="line">public void setScaleY(float scaleY)</div></pre></td></tr></table></figure></p>
<p>注意：</p>
<ul>
<li>要使用 ObjectAnimator 来构造对画，要操作的控件中，必须存在对应的属性的 set 方法，而且参数类型必须与构造所使用的ofFloat() 或者 ofInt() 函数一致。</li>
<li>set 方法的命名必须以骆驼拼写法命名，即 set 后每个单词首字母大写，其余字母小写，即类似于 setPropertyName 所对应的属性为propertyName。</li>
</ul>
<p>1）改变旋转度数 rotation、rotationX、rotationY</p>
<ul>
<li>float rotationX：表示围绕 X 轴旋转，rotationX 表示旋转度数</li>
<li>float rotationY：表示围绕 Y 轴旋转，rotationY 表示旋转度数</li>
<li>float rotation：表示围绕 Z 轴（垂直于屏幕）旋转，rotation 表示旋转度数</li>
</ul>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animator = ObjectAnimator.ofFloat(mView, &quot;rotationX&quot;, 0, 270, 0);</div><div class="line">// ObjectAnimator animator = ObjectAnimator.ofFloat(mView, &quot;rotationY&quot;, 0, 180, 0);</div><div class="line">// ObjectAnimator animator = ObjectAnimator.ofFloat(mView, &quot;rotation&quot;, 0, 270, 0);</div><div class="line">animator.setDuration(2000);</div><div class="line">animator.start();</div></pre></td></tr></table></figure></p>
<p>2）移动 translationX、translationY</p>
<ul>
<li>float translationX：表示在 X 轴上的平移距离，以当前控件为原点，向右为正方向，参数 translationX 表示移动的距离。</li>
<li>float translationY：表示在 Y 轴上的平移距离，以当前控件为原点，向下为正方向，参数 translationY 表示移动的距离。</li>
</ul>
<p>3）缩放 scaleX、scaleY</p>
<ul>
<li>float scaleX：在 X 轴上缩放，scaleX 表示缩放倍数</li>
<li>float scaleY：在 Y 轴上缩放，scaleY 表示缩放倍数</li>
</ul>
<p>4）改变透明度 alpha</p>
<ul>
<li>float alpha：改变透明度</li>
</ul>
<h4 id="3-4-2-ObjectAnimator-动画原理"><a href="#3-4-2-ObjectAnimator-动画原理" class="headerlink" title="3.4.2 ObjectAnimator 动画原理"></a>3.4.2 ObjectAnimator 动画原理</h4><p><img src="https://upload-images.jianshu.io/upload_images/3983615-03594160fc705404?imageMogr2/auto-orient/strip|imageView2/2/w/1187/format/webp" alt=""></p>
<p>与 ValueAnimator 不同的是最后一步，在 ValueAnimator 中，我们要通过添加监听器来监听当前数字值。而在 ObjectAnimator 中，则是先根据属性值拼装成对应的 set 函数的名字，比如这里的 scaleY 的拼装方法就是将属性的第一个字母强制大写后，与 set 拼接，所以就是 setScaleY 。然后通过反射找到对应控件的 setScaleY(float scaleY) 函数，将当前数字值做为 setScaleY(float scale) 的参数将其传入。</p>
<p>如果我们要自定义 ObjectAnimator 属性就要注意以下几个点：</p>
<ul>
<li>在命名时 set 之后的名字就是属性的名字。同时属性名字第一个字母不区分大小写，后面的名字必须与属性的名字相同。</li>
<li>在知道参数类型后我们才能确定我们是调用 ofFloat 还是 ofInt，这个参数是根据 setXXX 方法中的参数类型决定的。例如：setAlpha(float alpha) 其中参数类型是 float 所以上面我们使用的是 ofFloat，当然 ObjectAnimator 继承 ValueAnimatior 也有。ofObject()支持任意类型，不过和前面我们讲到的一样这里我们就要自定义自己的估值器了。</li>
</ul>
<h4 id="3-4-3-自定义-ObjectAnimator-属性"><a href="#3-4-3-自定义-ObjectAnimator-属性" class="headerlink" title="3.4.3 自定义 ObjectAnimator 属性"></a>3.4.3 自定义 ObjectAnimator 属性</h4><p><img src="https://upload-images.jianshu.io/upload_images/14186083-7e772b9076b48c45.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>自定义 FallingBallImageView 和 Evaluator<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public class FallingBallImageView extends AppCompatImageView &#123;</div><div class="line">    public FallingBallImageView(Context context, @Nullable AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setFallingPos(Point pos) &#123;</div><div class="line">        layout(pos.x, pos.y, pos.x + getWidth(), pos.y + getHeight());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static class FallingBallEvaluator implements TypeEvaluator&lt;Point&gt; &#123;</div><div class="line">        private Point point = new Point();</div><div class="line">        @Override</div><div class="line">        public Point evaluate(float fraction, Point startValue, Point endValue) &#123;</div><div class="line">            point.x = (int)(startValue.x + fraction * (endValue.x - startValue.x));</div><div class="line">            if (fraction * 2 &lt; 1) &#123;</div><div class="line">                point.y = (int) (startValue.y + fraction * 2 * (endValue.y - startValue.y));</div><div class="line">            &#125; else &#123;</div><div class="line">                point.y = endValue.y;</div><div class="line">            &#125;</div><div class="line">            return point;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在代码中，开始动画：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.act_main);</div><div class="line"></div><div class="line">        final FallingBallImageView view = findViewById(R.id.ball_img);</div><div class="line">        findViewById(R.id.start_btn).setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                ObjectAnimator animator = ObjectAnimator.ofObject(view, &quot;fallingPos&quot;,</div><div class="line">                        new FallingBallImageView.FallingBallEvaluator(),</div><div class="line">                        new Point(0, 0), new Point(500, 500));</div><div class="line">                animator.setDuration(2000);</div><div class="line">                animator.start();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>布局文件 act_main.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:layout_gravity=&quot;center_horizontal&quot;</div><div class="line">    android:orientation=&quot;horizontal&quot;&gt;</div><div class="line"></div><div class="line">    &lt;com.xxt.xtest.FallingBallImageView</div><div class="line">        android:id=&quot;@+id/ball_img&quot;</div><div class="line">        android:layout_width=&quot;50dp&quot;</div><div class="line">        android:layout_height=&quot;50dp&quot;</div><div class="line">        android:src=&quot;@drawable/circle&quot;/&gt;</div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/start_btn&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_marginLeft=&quot;30dp&quot;</div><div class="line">        android:text=&quot;开启动画&quot;/&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>其中，drawable/circle.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;shape</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:shape=&quot;oval&quot;&gt;</div><div class="line">    &lt;solid android:color=&quot;#FF0000&quot;/&gt;</div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure></p>
<h4 id="3-4-4-何时需要实现对应的-get-函数"><a href="#3-4-4-何时需要实现对应的-get-函数" class="headerlink" title="3.4.4 何时需要实现对应的 get 函数"></a>3.4.4 何时需要实现对应的 get 函数</h4><p>ObjectAnimator 有三个构造函数：ofInt()、ofFloat() 和 ofObject()，它们的最后一个参数都是可变长参数，用于指定动画值的变化区间。如果我们只定义一个值，如上例中改成：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animator = ObjectAnimator.ofObject(view, &quot;fallingPos&quot;,</div><div class="line">                        new FallingBallImageView.FallingBallEvaluator(),</div><div class="line">                        new Point(500, 500));</div></pre></td></tr></table></figure></p>
<p>则会发生异常，信息如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-e4d89fda63bedd35.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>当且仅当我们只给动画一个值时，程序才会调用属性对应的 get 函数来得到动画初始值。如果没有初始值，就会使用系统默认值。比如 ofInt() 函数中使用的参数类型是 int 类型，而 int 类型的默认值是 0，动画就会从 0 开始。所以上述自定义控件 FallingBallImageView 设置 get 函数，那么将会以 get 函数的返回值作为初始值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class FallingBallImageView extends AppCompatImageView &#123;</div><div class="line">    ...</div><div class="line">    public Point getFallingPos() &#123;</div><div class="line">        return new Point(0, 0);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>总结：当且仅当动画只有一个过渡值时，系统才会调用属性对应的 get 函数来得到动画的初始值。当不存在 get 函数时，则会去动画参数类型的默认值作为初始值；当无法取得动画参数类型的默认值时，则会直接奔溃。</p>
</blockquote>
<h4 id="3-4-5-常用函数"><a href="#3-4-5-常用函数" class="headerlink" title="3.4.5 常用函数"></a>3.4.5 常用函数</h4><p>用法和效果与 ValueAnimator 的函数是完全一样的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/03/Custom View/03.3 精通自定义 View 之属性动画（三）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/03/Custom View/03.3 精通自定义 View 之属性动画（三）/" itemprop="url">03.3 精通自定义 View 之属性动画（三）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-03T03:00:00+08:00">
                2019-07-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Custom-View/" itemprop="url" rel="index">
                    <span itemprop="name">Custom View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="3-3-ValueAnimator-进阶——ofObject"><a href="#3-3-ValueAnimator-进阶——ofObject" class="headerlink" title="3.3 ValueAnimator 进阶——ofObject"></a>3.3 ValueAnimator 进阶——ofObject</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static ValueAnimator ofObject(TypeEvaluator evaluator, Object... values)</div></pre></td></tr></table></figure>
<h4 id="3-3-1-示例：字母从-A-变化到-Z"><a href="#3-3-1-示例：字母从-A-变化到-Z" class="headerlink" title="3.3.1 示例：字母从 A 变化到 Z"></a>3.3.1 示例：字母从 A 变化到 Z</h4><p><img src="https://upload-images.jianshu.io/upload_images/14186083-7be4c63a0f016955.gif?imageMogr2/auto-orient/strip" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">private void startAnim() &#123;</div><div class="line">    ValueAnimator animator = ValueAnimator.ofObject(new CharEvaluator(),</div><div class="line">            Character.valueOf(&apos;A&apos;), Character.valueOf(&apos;Z&apos;));</div><div class="line">    animator.setDuration(3000);</div><div class="line">    animator.setInterpolator(new AccelerateInterpolator());</div><div class="line">    animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">        @Override</div><div class="line">        public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">            char text = (Character) animation.getAnimatedValue();</div><div class="line">            mView.setText(String.valueOf(text));</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    animator.start();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class CharEvaluator implements TypeEvaluator&lt;Character&gt; &#123;</div><div class="line">    @Override</div><div class="line">    public Character evaluate(float fraction, Character startValue, Character endValue) &#123;</div><div class="line">        int startInt = (int) startValue;</div><div class="line">        int endInt = (int) endValue;</div><div class="line">        int value = (int) (startInt + fraction * (endInt - startInt));</div><div class="line">        return (char) value;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-3-2-示例：抛物动画"><a href="#3-3-2-示例：抛物动画" class="headerlink" title="3.3.2 示例：抛物动画"></a>3.3.2 示例：抛物动画</h4><p><img src="https://upload-images.jianshu.io/upload_images/14186083-3e1482dc4d082b7f.gif?imageMogr2/auto-orient/strip" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">private void startAnim() &#123;</div><div class="line">    ValueAnimator animator = ValueAnimator.ofObject(new FallingBallEvaluator(),</div><div class="line">            new Point(0, mTop), new Point(500, 500));</div><div class="line">    animator.setDuration(3000);</div><div class="line">    animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">        @Override</div><div class="line">        public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">            Point p = (Point) animation.getAnimatedValue();</div><div class="line">            mView.layout(p.x, p.y, p.x + mView.getWidth(), p.y + mView.getHeight());</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    animator.start();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class FallingBallEvaluator implements TypeEvaluator&lt;Point&gt; &#123;</div><div class="line">    private Point point = new Point();</div><div class="line">    @Override</div><div class="line">    public Point evaluate(float fraction, Point startValue, Point endValue) &#123;</div><div class="line">        point.x = (int)(startValue.x + fraction * (endValue.x - startValue.x));</div><div class="line">        if (fraction * 2 &lt; 1) &#123;</div><div class="line">            point.y = (int) (startValue.y + fraction * 2 * (endValue.y - startValue.y));</div><div class="line">        &#125; else &#123;</div><div class="line">            point.y = endValue.y;</div><div class="line">        &#125;</div><div class="line">        return point;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/03/Custom View/03.2 精通自定义 View 之属性动画（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/03/Custom View/03.2 精通自定义 View 之属性动画（二）/" itemprop="url">03.2 精通自定义 View 之属性动画（二）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-03T02:00:00+08:00">
                2019-07-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Custom-View/" itemprop="url" rel="index">
                    <span itemprop="name">Custom View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="3-2-自定义插值器与-Evaluator"><a href="#3-2-自定义插值器与-Evaluator" class="headerlink" title="3.2 自定义插值器与 Evaluator"></a>3.2 自定义插值器与 Evaluator</h2><p>视图动画，只能设置插值器；但对于 Animator 而言，不仅可以设置插值器，还可以设置 Evaluator。</p>
<h4 id="3-2-1-自定义插值器"><a href="#3-2-1-自定义插值器" class="headerlink" title="3.2.1 自定义插值器"></a>3.2.1 自定义插值器</h4><p>插值器就是用来控制动画的区间值如何被计算出来的。</p>
<h6 id="1、系统自带插值器"><a href="#1、系统自带插值器" class="headerlink" title="1、系统自带插值器"></a>1、系统自带插值器</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public class AccelerateDecelerateInterpolator extends BaseInterpolator  &#123;</div><div class="line">    public AccelerateDecelerateInterpolator() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @SuppressWarnings(&#123;&quot;UnusedDeclaration&quot;&#125;)</div><div class="line">    public AccelerateDecelerateInterpolator(Context context, AttributeSet attrs) &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public float getInterpolation(float input) &#123;</div><div class="line">        return (float)(Math.cos((input + 1) * Math.PI) / 2.0f) + 0.5f;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">// 最终实现的接口：TimeInterpolator</div><div class="line">public interface TimeInterpolator &#123;</div><div class="line">    float getInterpolation(float input);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在 TimeInterpolator 的代码里，它只有一个函数 float getInterpolation(float input)。</p>
<ul>
<li>参数 input：input 是 Float 类型的，它的取值范围是 0 ~ 1，表示当前动画的进度。取 0 时表示动画刚开始，取 1 时表示动画结束，取 0.5 时表示动画中间的位置，其他以此类推。它是时间概念。</li>
<li>返回值：表示当前实际想要显示的进度。取值可以超过 ，也可以小于 0。超过 1 表示已经超过目标值，小于 0 表示小于开始位置。</li>
</ul>
<p>而 AccelerateDecelerateInterpolator 返回的显示进度值为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">return (float)(Math.cos((input + 1) * Math.PI) / 2.0f) + 0.5f;</div></pre></td></tr></table></figure></p>
<p>input 是从 0 到 1，即cos(π) 到 cos(2π) 的结果值是从 -1 到 1。最终返回结果还是从 0 到 1，但是由于 Math.cos() 导致速率变化了，先加速后减速。</p>
<h6 id="2、自定义插值器示例"><a href="#2、自定义插值器示例" class="headerlink" title="2、自定义插值器示例"></a>2、自定义插值器示例</h6><p>想要先减速后加速的效果，可以重写 getInterpolation 方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">float x = (-1 + input * 2.0f) / 4f; // -0.25 ~ 0.25</div><div class="line">float y = (float) Math.tan(x * Math.PI);</div><div class="line">return y / 2f + 0.5f;</div></pre></td></tr></table></figure></p>
<p>由于 tan 函数曲线变化不明显，导致加速减速效果也不明显，趋向于匀速。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">class DecelerateAccelerateInterpolator implements TimeInterpolator &#123;</div><div class="line">    public DecelerateAccelerateInterpolator() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @SuppressWarnings(&#123;&quot;UnusedDeclaration&quot;&#125;)</div><div class="line">    public DecelerateAccelerateInterpolator(Context context, AttributeSet attrs) &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public float getInterpolation(float input) &#123;</div><div class="line">        float x = (-1 + input * 2.0f) / 4f; // -0.25 ~ 0.25</div><div class="line">        float y = (float) Math.tan(x * Math.PI);</div><div class="line">        return y / 2f + 0.5f;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">animator.setInterpolator(new DecelerateAccelerateInterpolator());</div></pre></td></tr></table></figure></p>
<h4 id="3-2-2-Evaluator"><a href="#3-2-2-Evaluator" class="headerlink" title="3.2.2 Evaluator"></a>3.2.2 Evaluator</h4><h6 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h6><p><img src="https://upload-images.jianshu.io/upload_images/9125154-ce9829a138c8d3c5.png?imageMogr2/auto-orient/strip|imageView2/2/w/949/format/webp" alt=""></p>
<p>上图所述的 4 个步骤的具体含义是：<br>1）ofInt（0，400）：表示指定动画的数值区间，从0运动到400。<br>2）插值器：在动画开始后通过插值器会返回当前动画进度所对应的数值进度，这个数值进度是以小数表示的，如0.2。<br>3）Evaluator：我们通过监听器拿到的是当前动画所对应的具体数值，而不是用小数表示的数值。那么必须有一个地方会根据当前的数值进度将其转换为对应的数值，这个地方就是Evaluator。Evaluator用于将从插值器返回的数值进度（小数，0 - 1.0）转换成对应的数值。<br>4）监听器返回：在 AnimatorUpdateListener 监听器中使用 animation.getAnimatedValue() 函数拿到 Evaluator 中返回的数值。</p>
<h6 id="2-各种-Evaluator"><a href="#2-各种-Evaluator" class="headerlink" title="2. 各种 Evaluator"></a>2. 各种 Evaluator</h6><p>插值器返回的小数值表示的是当前动画的数值进度，这对于无论是使用 ofFloat() 函数还是使用 ofInt() 函数定义的动画都是适用的。因为无论是什么动画，它的进度必然在 0～1 之间。0 表示还没开始，1 表示动画结束，这对于任何动画都是适用的。</p>
<p>而 Evaluator 则不一样，它把插值器返回的小数进度转换成当前数值进度所对应的值。如果使用 ofInt() 函数来定义动画，动画中的值应该都是 Integer 类型的，所对应的 Evaluator 在返回值时，必然返回 Integer 类型的值；如果使用 ofFloat() 函数来定义动画，动画中的值都是 Float 类型的，Evaluator 在返回值时，必然返回 Float 类型的值。</p>
<p>所以，每种定义方式所对应的 Evaluator 必然是它专用的。Evaluator 专用的原因在于动画数值类型不一样，在通过 Evaluator 返回时会报强转错误，所以只有在动画数值类型一样时，所对应的 Evaluator 才能通用。ofInt() 函数对应的 Evaluator 类名为 IntEvaluator，而 ofFloat() 函数对应的 Evaluator 类名为 FloatEvaluator。</p>
<p>通过 animator.setEvaluator() 函数来设置 Evaluator，比如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">private void startAnimationArgbEvaluator() &#123;</div><div class="line">    ValueAnimator animator =  ValueAnimator.ofInt(0xffffff00, 0xff0000ff);</div><div class="line">    // 设置Evaluator</div><div class="line">    animator.setEvaluator(new ArgbEvaluator());</div><div class="line">    animator.setDuration(3000);</div><div class="line"></div><div class="line">    animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">        @Override</div><div class="line">        public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">            int curValue = (Integer) animation.getAnimatedValue();</div><div class="line">            tv_text.setBackgroundColor(curValue);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    animator.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ofInt() 函数的默认 Evaluator 是 IntEvaluator，而 ofFloat() 函数的默认 Evaluator 则是 FloatEvaluator。</p>
<p>可以继续看下 IntEvaluator 的源码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class IntEvaluator implements TypeEvaluator&lt;Integer&gt; &#123;</div><div class="line">    public Integer evaluate(float fraction, Integer startValue, </div><div class="line">                Integer endValue) &#123;</div><div class="line">        int startInt = startValue;</div><div class="line">        // 当前的值 = 100 + (400 - 100) * 显示进度</div><div class="line">        return (int)(startInt + fraction * (endValue - startInt));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在 IntEvaluator 中只有一个函数 evaluate(float fraction, Integer startValue, Integer endValue)：</p>
<ul>
<li>fraction 参数就是插值器中的返回值，表示当前动画的数值进度，以百分制的小数表示。</li>
<li>startValue 和 endValue 分别对应 ofInt(int start，int end) 函数中 start 和 end 的数值。假设当我们定义的动画 ofInt(100，400) 进行到数值进度 20% 的时候，那么此时在 evaluate() 函数中，fraction 的值就是 0.2，startValue 的值是 100，endValue 的值是 400。</li>
<li>返回值就是当前数值进度所对应的具体数值，这个数值就是我们在 AnimatorUpdateListener 监听器中通过 animation.getAnimatedValue() 函数得到的数值。</li>
</ul>
<p>总之：既可以通过重写插值器改变数值进度来改变数值位置，也可以通过改变 Evaluator 中数值进度所对应的具体数值来改变数值位置。</p>
<h6 id="3-简单实现-Evaluator"><a href="#3-简单实现-Evaluator" class="headerlink" title="3. 简单实现 Evaluator"></a>3. 简单实现 Evaluator</h6><p>自定义 MyEvaluator，并设定一个位移量。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class MyEvaluator implements TypeEvaluator&lt;Integer&gt; &#123;</div><div class="line">    private int offset;</div><div class="line">    public MyEvaluator(int offset) &#123;</div><div class="line">        this.offset = offset;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    public Integer evaluate(float fraction, Integer startValue, Integer endValue) &#123;</div><div class="line">        int startInt = startValue;</div><div class="line">        return (int) (startInt + (endValue - startInt) * fraction + offset);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mView = findViewById(R.id.tv);</div><div class="line">ValueAnimator animator = ValueAnimator.ofInt(0, 400);</div><div class="line">animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">    @Override</div><div class="line">    public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">        int curValue = (Integer) animation.getAnimatedValue();</div><div class="line">        mView.layout(curValue, curValue,</div><div class="line">                curValue + mView.getWidth(),</div><div class="line">                curValue + mView.getHeight());</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">animator.setDuration(1000);</div><div class="line">animator.setEvaluator(new MyEvaluator(200));</div><div class="line">animator.start();</div></pre></td></tr></table></figure></p>
<h6 id="4-自定义-Evaluator-实现倒序输出"><a href="#4-自定义-Evaluator-实现倒序输出" class="headerlink" title="4. 自定义 Evaluator 实现倒序输出"></a>4. 自定义 Evaluator 实现倒序输出</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class ReverseEvaluator implements TypeEvaluator&lt;Integer&gt; &#123;</div><div class="line">    private boolean isReverse = true;</div><div class="line">    public MyEvaluator() &#123;</div><div class="line">    &#125;</div><div class="line">    public MyEvaluator(boolean isReverse) &#123;</div><div class="line">        this.isReverse = isReverse;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    public Integer evaluate(float fraction, Integer startValue, Integer endValue) &#123;</div><div class="line">        int startInt = startValue;</div><div class="line">        if (isReverse) &#123;</div><div class="line">            return (int) (endValue - (endValue - startInt) * fraction);</div><div class="line">        &#125; else &#123;</div><div class="line">            return (int) (startInt + (endValue - startInt) * fraction);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h6 id="5-ArgbEvaluator"><a href="#5-ArgbEvaluator" class="headerlink" title="5. ArgbEvaluator"></a>5. ArgbEvaluator</h6><p>除 IntEvaluator 和 FloatEvaluator 外，在 android.animation 包下还有另一个 Evaluator，名为 ArgbEvaluator，它是用来实现颜色值过渡转换的。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14186083-2e9430c61cdc0015.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public void startAnim(View v) &#123;</div><div class="line">    ValueAnimator animator = ValueAnimator.ofInt(0xFFFFFF00, 0xFF0000FF);</div><div class="line">    animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">        @Override</div><div class="line">        public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">            int curValue = (Integer) animation.getAnimatedValue();</div><div class="line">            mView.setBackgroundColor(curValue);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    animator.setDuration(3000);</div><div class="line">    animator.setEvaluator(new ArgbEvaluator());</div><div class="line">    animator.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>实现原理：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">public class ArgbEvaluator implements TypeEvaluator &#123;</div><div class="line">    public Object evaluate(float fraction, Object startValue, Object endValue) &#123;</div><div class="line">        int startInt = (Integer) startValue;</div><div class="line">        float startA = ((startInt &gt;&gt; 24) &amp; 0xff) / 255.0f;</div><div class="line">        float startR = ((startInt &gt;&gt; 16) &amp; 0xff) / 255.0f;</div><div class="line">        float startG = ((startInt &gt;&gt;  8) &amp; 0xff) / 255.0f;</div><div class="line">        float startB = ( startInt        &amp; 0xff) / 255.0f;</div><div class="line"></div><div class="line">        int endInt = (Integer) endValue;</div><div class="line">        float endA = ((endInt &gt;&gt; 24) &amp; 0xff) / 255.0f;</div><div class="line">        float endR = ((endInt &gt;&gt; 16) &amp; 0xff) / 255.0f;</div><div class="line">        float endG = ((endInt &gt;&gt;  8) &amp; 0xff) / 255.0f;</div><div class="line">        float endB = ( endInt        &amp; 0xff) / 255.0f;</div><div class="line"></div><div class="line">        // convert from sRGB to linear</div><div class="line">        startR = (float) Math.pow(startR, 2.2);</div><div class="line">        startG = (float) Math.pow(startG, 2.2);</div><div class="line">        startB = (float) Math.pow(startB, 2.2);</div><div class="line"></div><div class="line">        endR = (float) Math.pow(endR, 2.2);</div><div class="line">        endG = (float) Math.pow(endG, 2.2);</div><div class="line">        endB = (float) Math.pow(endB, 2.2);</div><div class="line"></div><div class="line">        // compute the interpolated color in linear space</div><div class="line">        float a = startA + fraction * (endA - startA);</div><div class="line">        float r = startR + fraction * (endR - startR);</div><div class="line">        float g = startG + fraction * (endG - startG);</div><div class="line">        float b = startB + fraction * (endB - startB);</div><div class="line"></div><div class="line">        // convert back to sRGB in the [0..255] range</div><div class="line">        a = a * 255.0f;</div><div class="line">        r = (float) Math.pow(r, 1.0 / 2.2) * 255.0f;</div><div class="line">        g = (float) Math.pow(g, 1.0 / 2.2) * 255.0f;</div><div class="line">        b = (float) Math.pow(b, 1.0 / 2.2) * 255.0f;</div><div class="line"></div><div class="line">        return Math.round(a) &lt;&lt; 24 | Math.round(r) &lt;&lt; 16 | Math.round(g) &lt;&lt; 8 | Math.round(b);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">78</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
