<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="King">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="King">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="King">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/8/"/>





  <title>King</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">King</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">xianxiaotao</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/24/ANDROID/ANDROID 工具类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/24/ANDROID/ANDROID 工具类/" itemprop="url">ANDROID | 工具类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-24T10:24:07+08:00">
                2016-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>常用工具类：</p>
<ul>
<li>L.java 日志</li>
</ul>
<h3 id="一、日志工具类-L-java"><a href="#一、日志工具类-L-java" class="headerlink" title="一、日志工具类(L.java)"></a>一、日志工具类(L.java)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line">package com.xxt.util;</div><div class="line"></div><div class="line">import android.util.Log;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Log统一管理类</div><div class="line"> *     isDebug  控制是否输出日志</div><div class="line"> *     level  控制输出日志等级</div><div class="line"> *     LV: VERBOSE</div><div class="line"> *     LD: DEBUG</div><div class="line"> *     LI: INFO</div><div class="line"> *     LW: WARN</div><div class="line"> *     LE: ERROR</div><div class="line"> *</div><div class="line"> * Created by xianxiaotao on 17/3/2.</div><div class="line"> */</div><div class="line">public class L &#123;</div><div class="line"></div><div class="line">    private static final String TAG = <span class="string">"LOG"</span>;</div><div class="line"></div><div class="line">    // 输出日志等级</div><div class="line">    public static final int LV = 1;</div><div class="line">    public static final int LD = 2;</div><div class="line">    public static final int LI = 3;</div><div class="line">    public static final int LW = 4;</div><div class="line">    public static final int LE = 5;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 输出日志总开关，可以在Application的onCreate方法中初始化</div><div class="line">     */</div><div class="line">    public static boolean isDebug = <span class="literal">true</span>;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 输出日志等级，值为LV，则输出所有日志，值为LE，则只输出Error日志</div><div class="line">     */</div><div class="line">    public static int level = LV;</div><div class="line"></div><div class="line">    private <span class="function"><span class="title">L</span></span>() &#123;&#125;  /* cannot be instantiated */</div><div class="line"></div><div class="line">    public static void v(String msg) &#123;</div><div class="line">        <span class="keyword">if</span> (isDebug &amp;&amp; level &lt;= LV)</div><div class="line">            Log.v(TAG, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void d(String msg) &#123;</div><div class="line">        <span class="keyword">if</span> (isDebug &amp;&amp; level &lt;= LD)</div><div class="line">            Log.d(TAG, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void i(String msg) &#123;</div><div class="line">        <span class="keyword">if</span> (isDebug &amp;&amp; level &lt;= LI)</div><div class="line">            Log.i(TAG, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void w(String msg) &#123;</div><div class="line">        <span class="keyword">if</span> (isDebug &amp;&amp; level &lt;= LW)</div><div class="line">            Log.w(TAG, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void e(String msg) &#123;</div><div class="line">        <span class="keyword">if</span> (isDebug &amp;&amp; level &lt;= LE)</div><div class="line">            Log.e(TAG, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void v(String tag, String msg) &#123;</div><div class="line">        <span class="keyword">if</span> (isDebug &amp;&amp; level &lt;= LV)</div><div class="line">            Log.v(tag, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void d(String tag, String msg) &#123;</div><div class="line">        <span class="keyword">if</span> (isDebug &amp;&amp; level &lt;= LD)</div><div class="line">            Log.d(tag, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void i(String tag, String msg) &#123;</div><div class="line">        <span class="keyword">if</span> (isDebug &amp;&amp; level &lt;= LI)</div><div class="line">            Log.i(tag, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void w(String tag, String msg) &#123;</div><div class="line">        <span class="keyword">if</span> (isDebug &amp;&amp; level &lt;= LW)</div><div class="line">            Log.w(tag, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void e(String tag, String msg) &#123;</div><div class="line">        <span class="keyword">if</span> (isDebug &amp;&amp; level &lt;= LE)</div><div class="line">            Log.e(tag, msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/23/ANDROID/ANDROID 6.0 动态权限/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/23/ANDROID/ANDROID 6.0 动态权限/" itemprop="url">ANDROID | 动态权限</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-23T10:24:07+08:00">
                2016-10-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ANDROID/" itemprop="url" rel="index">
                    <span itemprop="name">ANDROID</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Android6.0及以上版本中，即使在AndroidManifest.xml文件里配置了如下权限：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.CALL_PHONE"</span>/&gt;</div></pre></td></tr></table></figure></p>
<p>运行时会也会报错：<br>java.lang.SecurityException: Permission Denial: starting Intent { act=android.intent.action.CALL dat=tel:xxxxxx cmp=com.android.server.telecom/.components.UserCallActivity } from ProcessRecord{ece7708 3894:com.test.xianxiaotao.test/u0a79} (pid=3894, uid=10079) with revoked permission android.permission.CALL_PHONE</p>
<p>这是因为Android6.0及以上版本增添了<a href="https://developer.android.com/training/permissions/requesting.html" target="_blank" rel="external">动态权限</a>。在哪个页面需要这个权限只需要直接去请求就行了，而且还有了相应的监听的方法供你来判断。具体使用参考如下代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private EditText editText;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        <span class="built_in">set</span>ContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        // 动态请求权限</div><div class="line">        ActivityCompat.requestPermissions(MainActivity.this, new String[]&#123;Manifest.permission.CALL_PHONE&#125;, 0x11);</div><div class="line">        editText = (EditText) findViewById(R.id.editText);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 拨打</div><div class="line">     * @param v 触发监听事件的view</div><div class="line">     */</div><div class="line">    public void call(View v) &#123;</div><div class="line">        String number = editText.getText().toString();</div><div class="line">        <span class="keyword">if</span> (null == number || number.length() == 0)</div><div class="line">            <span class="built_in">return</span>;</div><div class="line">        Intent intent = new Intent();</div><div class="line">        intent.setAction(Intent.ACTION_CALL);</div><div class="line">        intent.setData(Uri.parse(<span class="string">"tel://"</span> + number));</div><div class="line">        startActivity(intent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 监听权限是否允许</div><div class="line">     * @param requestCode</div><div class="line">     * @param permissions</div><div class="line">     * @param grantResults</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) &#123;</div><div class="line">        super.onRequestPermissionsResult(requestCode, permissions, grantResults);</div><div class="line">        <span class="keyword">if</span> (requestCode == 0x11) &#123;</div><div class="line">            <span class="keyword">if</span> (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED)</div><div class="line">                Log.i(<span class="string">"CMCC"</span>, <span class="string">"权限被允许"</span>);</div><div class="line">            <span class="keyword">else</span></div><div class="line">                Log.i(<span class="string">"CMCC"</span>, <span class="string">"权限被拒绝"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><img src="http://ww1.sinaimg.cn/large/adc90466ly1fd7n9a1fgpj20b605q3yu" alt=""></p>
<blockquote>
<p>使用权限的页面中弹出提示框并被允许，则以后不再弹出。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/02/JAVA/Socket如何演化成Tomcat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/02/JAVA/Socket如何演化成Tomcat/" itemprop="url">JAVA | Socket如何演化成Tomcat</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-02T14:09:57+08:00">
                2016-08-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>模拟请求表单；</li>
<li>简易服务器代码获取请求；</li>
<li>HTTP协议；</li>
<li>抽象封装Response和Request；</li>
<li>将与客户端的交互封装成Servlet；</li>
<li>使用分发器多线程处理各种业务；</li>
<li>分发器使用的上下文及全局变量；</li>
<li>利用反射优化代码；</li>
<li>在配置文件中设置路径与Servlet的对应关系；</li>
<li>完整源码下载链接</li>
</ul>
<h3 id="一、请求表单"><a href="#一、请求表单" class="headerlink" title="一、请求表单"></a>一、请求表单</h3><p>首先在前端模拟一个注册请求表单，代码如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;注册&lt;/title&gt;</div><div class="line">    &lt;meta http-equiv=<span class="string">"content-type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>/&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;form method=<span class="string">"post"</span> action=<span class="string">"http://localhost:8888/index.html"</span>&gt;</div><div class="line">        昵称：&lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"username"</span> id=<span class="string">"username"</span>/&gt;</div><div class="line">        密码：&lt;input <span class="built_in">type</span>=<span class="string">"password"</span> name=<span class="string">"password"</span> id=<span class="string">"password"</span>/&gt;</div><div class="line">        兴趣：&lt;input <span class="built_in">type</span>=<span class="string">"checkbox"</span> name=<span class="string">"fav"</span> value=<span class="string">"0"</span>/&gt;篮球</div><div class="line">             &lt;input <span class="built_in">type</span>=<span class="string">"checkbox"</span> name=<span class="string">"fav"</span> value=<span class="string">"1"</span>/&gt;足球</div><div class="line">             &lt;input <span class="built_in">type</span>=<span class="string">"checkbox"</span> name=<span class="string">"fav"</span> value=<span class="string">"2"</span>/&gt;冰球</div><div class="line">             &lt;input <span class="built_in">type</span>=<span class="string">"submit"</span> value=<span class="string">"注册"</span>/&gt;</div><div class="line">    &lt;/form&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>method是请求方式，默认为get，其数据量小，安全性不高，而post量大，安全性相对高；<br>action为请求的服务器路径；id用于前端区分唯一性；<br>name用于服务器区分唯一性，如要提交数据给后台，必须声明name；<br>此处fav的值对应多个，用于测试服务器解析参数。</p>
</blockquote>
<h3 id="二、简易服务器"><a href="#二、简易服务器" class="headerlink" title="二、简易服务器"></a>二、简易服务器</h3><p>用一个简易的服务器代码输出来自浏览器的请求信息。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">public class Server &#123;</div><div class="line">    private ServerSocket server;</div><div class="line">    private boolean isRunning = <span class="literal">true</span>;</div><div class="line">    </div><div class="line">    // 开启服务</div><div class="line">    public void <span class="function"><span class="title">start</span></span>() &#123;</div><div class="line">        try &#123;</div><div class="line">            server = new ServerSocket(8888);</div><div class="line">            <span class="keyword">while</span> (isRunning) &#123;</div><div class="line">                receive();</div><div class="line">            &#125;</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            stop();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 处理请求并响应</div><div class="line">    private void <span class="function"><span class="title">receive</span></span>() &#123;</div><div class="line">        try &#123;</div><div class="line">            Socket client = server.accept();</div><div class="line">            </div><div class="line">            // 以下代码临时用于接受客户端的请求信息</div><div class="line">            byte[] data = new byte[1024 * 10];</div><div class="line">            int len = client.getInputStream().read(data);</div><div class="line">            String requestInfo = new String(data, 0, len).trim();</div><div class="line">            requestInfo = URLDecoder.decode(requestInfo, <span class="string">"utf-8"</span>);</div><div class="line">            System.out.println(requestInfo);</div><div class="line">            </div><div class="line">            // 以下代码为返回信息，遵从HTTP协议</div><div class="line">            // TODO</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 关闭服务</div><div class="line">    public void <span class="function"><span class="title">stop</span></span>() &#123;</div><div class="line">        isRunning = <span class="literal">true</span>;</div><div class="line">        CloseUtil.closeServerSocket(server);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>开启上述服务器，以默认或GET方式发送表单，服务端接收到的信息是：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">GET /index.html?username=先小涛&amp;password=123456&amp;fav=0&amp;fav=2 HTTP/1.1</div><div class="line">Host: localhost:8888</div><div class="line">Accept: text/html,application/xhtml xml,application/xml;q=0.9,*/*;q=0.8</div><div class="line">Accept-Language: zh-cn</div><div class="line">Connection: keep-alive</div><div class="line">Accept-Encoding: gzip, deflate</div><div class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/600.8.9 (KHTML, like Gecko) Version/8.0.8 Safari/600.8.9</div></pre></td></tr></table></figure></p>
<p>以POST方式发送表单，服务端接收到的信息是：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">POST /index.html HTTP/1.1</div><div class="line">Host: localhost:8888</div><div class="line">Content-Type: application/x-www-form-urlencoded</div><div class="line">Origin: file://</div><div class="line">Connection: keep-alive</div><div class="line">Accept: text/html,application/xhtml xml,application/xml;q=0.9,*/*;q=0.8</div><div class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/600.8.9 (KHTML, like Gecko) Version/8.0.8 Safari/600.8.9</div><div class="line">Accept-Language: zh-cn</div><div class="line">Accept-Encoding: gzip, deflate</div><div class="line">Content-Length: 102</div><div class="line"></div><div class="line">username=先小涛&amp;password=123456&amp;fav=0&amp;fav=2</div></pre></td></tr></table></figure></p>
<h3 id="三、HTTP协议"><a href="#三、HTTP协议" class="headerlink" title="三、HTTP协议"></a>三、HTTP协议</h3><p>上述两段请求信息由于请求方式不同导致略有差别，而这些固定格式的信息是由遵从HTTP协议的浏览器负责生成的。服务端响应的信息也要遵从HTTP协议，否则客户端无法解析返回的数据。HTTP响应格式与请求一样，由三个部分构成，分别是：<br>1、HTTP协议版本、状态代码、描述<br>2、响应头(Response Head)<br>3、响应正文(Response Content)<br>可以用代码方式拼接响应字符串：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// 响应正文</div><div class="line">StringBuilder responseContext = new StringBuilder();</div><div class="line">responseContext.append(<span class="string">"&lt;html&gt;&lt;title&gt;HTTP响应示例&lt;/title&gt;&lt;body&gt;I defined a tomcat&lt;/body&gt;&lt;/html&gt;"</span>);</div><div class="line">// 响应全文</div><div class="line">StringBuilder response = new StringBuilder();</div><div class="line">response.append(<span class="string">"HTTP/1.1"</span>).append(<span class="string">" "</span>).append(<span class="string">"200"</span>).append(<span class="string">" "</span>).append(<span class="string">"OK"</span>);</div><div class="line">response.append(<span class="string">"Server:xianxiaotao Server/0.0.1"</span>).append(<span class="string">"\r\n"</span>);</div><div class="line">response.append(<span class="string">"Date:"</span>).append(new Date()).append(<span class="string">"\r\n"</span>);</div><div class="line">response.append(<span class="string">"Content-type:text/html;charset=utf-8"</span>).append(<span class="string">"\r\n"</span>);</div><div class="line">response.append(<span class="string">"Content-Length:"</span>).append(responseContext.toString().getBytes().length).append(<span class="string">"\r\n"</span>);</div><div class="line">response.append(<span class="string">"\r\n"</span>);</div><div class="line">response.append(responseContext);</div><div class="line">// 返回数据</div><div class="line">BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(client.getOutputStream()));</div><div class="line">bw.write(response.toString());</div><div class="line">bw.flush();</div><div class="line">bw.close();</div></pre></td></tr></table></figure></p>
<p>HTTP协议中常用的一些信息：<br>1、状态代码：<br>200 OK<br>400 Bad Request<br>404 Not Found<br>405 Method Not Allowed<br>500 Server Error</p>
<p>2、内容类型：<br>超文本：Content-type:text/html;charset=GBK<br>纯文本：Content-type:text/plain;charset=GBK<br>下载流：Content-type:application/octet-stream</p>
<blockquote>
<p>响应信息都是固定格式，不必每次都要拼字符串，可抽取共性封装成Response对象。Request如是。</p>
</blockquote>
<h3 id="四、Response"><a href="#四、Response" class="headerlink" title="四、Response"></a>四、Response</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">public class Response &#123;</div><div class="line">    public static final String CRLF = <span class="string">"\r\n"</span>;   // 回车符</div><div class="line">    public static final String BLANK = <span class="string">" "</span>;     // 空格符</div><div class="line">    </div><div class="line">    private StringBuilder headInfo;             // 头信息</div><div class="line">    private StringBuilder content;              // 正文</div><div class="line">    private int len;                            // 正文长度</div><div class="line">    private BufferedWriter bw;                  // 推送信息到客户端的流</div><div class="line">    </div><div class="line">    private <span class="function"><span class="title">Response</span></span>() &#123;</div><div class="line">        headInfo = new StringBuilder();</div><div class="line">        content = new StringBuilder();</div><div class="line">        len = 0;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public Response(Socket socket) &#123;</div><div class="line">        this();</div><div class="line">        try &#123;</div><div class="line">            bw = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            headInfo = null;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 构建正文</div><div class="line">    public Response <span class="built_in">print</span>(String info) &#123;</div><div class="line">        content.append(info);</div><div class="line">        len += info.getBytes().length;</div><div class="line">        <span class="built_in">return</span> this;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 构建正文+回车</div><div class="line">    public Response println(String info) &#123;</div><div class="line">        content.append(info).append(CRLF);</div><div class="line">        len += (info + CRLF).getBytes().length;</div><div class="line">        <span class="built_in">return</span> this;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 生产响应头信息</div><div class="line">    private void createHeadInfo(int code) &#123;</div><div class="line">        headInfo.append(<span class="string">"HTTP/1.1"</span>).append(BLANK).append(code).append(BLANK);</div><div class="line">        switch (code) &#123;</div><div class="line">            <span class="keyword">case</span> 200:</div><div class="line">                headInfo.append(<span class="string">"OK"</span>);</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            <span class="keyword">case</span> 404:</div><div class="line">                headInfo.append(<span class="string">"NOT FOUND"</span>);</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            <span class="keyword">case</span> 500:</div><div class="line">                headInfo.append(<span class="string">"SERVER ERROR"</span>);</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">        &#125;</div><div class="line">        headInfo.append(<span class="string">"Server:xianxiaotao Server/0.0.1"</span>).append(CRLF);</div><div class="line">        headInfo.append(<span class="string">"Date:"</span>).append(new Date()).append(CRLF);</div><div class="line">        headInfo.append(<span class="string">"Content-type:text/html;charset=utf-8"</span>).append(CRLF);</div><div class="line">        headInfo.append(<span class="string">"Content-Length:"</span>).append(len).append(CRLF);</div><div class="line">        headInfo.append(CRLF);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 推送到客户端</div><div class="line">    public void pushToClient(int code) throws IOException &#123;</div><div class="line">        <span class="keyword">if</span> (null == headInfo) </div><div class="line">            code = 500;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            createHeadInfo(code);</div><div class="line">            bw.append(headInfo.toString());</div><div class="line">            bw.append(content.toString());</div><div class="line">            bw.flush();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public void <span class="function"><span class="title">close</span></span>() &#123;</div><div class="line">        CloseUtil.closeIO(bw);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="五、Request"><a href="#五、Request" class="headerlink" title="五、Request"></a>五、Request</h3><p>主要解析请求信息中的请求方式和参数，并将结果封装成Request对象。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div></pre></td><td class="code"><pre><div class="line">public class Request &#123;</div><div class="line">    public static final String CRLF = <span class="string">"\r\n"</span>;</div><div class="line">    </div><div class="line">    private String method;          // 请求方式</div><div class="line">    private String url;             // 请求资源</div><div class="line">    private Map&lt;String, List&lt;String&gt;&gt; parameterMapValues;   // 请求参数</div><div class="line">    private BufferedInputStream bis;// 流</div><div class="line">    private String requestInfo;     // 请求信息</div><div class="line">    </div><div class="line">    private <span class="function"><span class="title">Request</span></span>() &#123;</div><div class="line">        method = <span class="string">""</span>;</div><div class="line">        url = <span class="string">""</span>;</div><div class="line">        parameterMapValues = new HashMap&lt;&gt;();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public Request(Socket client) &#123;</div><div class="line">        this();</div><div class="line">        try &#123;</div><div class="line">            this.bis = new BufferedInputStream(client.getInputStream());</div><div class="line">            byte[] buf = new byte[10240];</div><div class="line">            int len = bis.read(buf);</div><div class="line">            requestInfo = new String(buf, 0, len);</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            <span class="built_in">return</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        parseRequestInfo();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * 解析请求信息</div><div class="line">     */</div><div class="line">    private void <span class="function"><span class="title">parseRequestInfo</span></span>() &#123;</div><div class="line">        <span class="keyword">if</span> (null == requestInfo || requestInfo.trim().length() == 0) </div><div class="line">            <span class="built_in">return</span>;</div><div class="line">        </div><div class="line">        String paramString = <span class="string">""</span>;    // 请求参数</div><div class="line">        String firstLine = requestInfo.substring(0, requestInfo.indexOf(CRLF));</div><div class="line">        int idx = firstLine.indexOf(<span class="string">"/"</span>);</div><div class="line">        this.method = firstLine.substring(0, idx).trim();</div><div class="line">        String urlStr = firstLine.substring(idx, firstLine.indexOf(<span class="string">"HTTP/"</span>)).trim();</div><div class="line">        <span class="keyword">if</span> (method.equalsIgnoreCase(<span class="string">"post"</span>)) &#123;</div><div class="line">            this.url = urlStr;</div><div class="line">            paramString = requestInfo.substring(requestInfo.lastIndexOf(CRLF)).trim();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equalsIgnoreCase(<span class="string">"get"</span>)) &#123;</div><div class="line">            <span class="keyword">if</span> (urlStr.contains(<span class="string">"?"</span>)) &#123; // 是否存在参数</div><div class="line">                String[] urlArray = urlStr.split(<span class="string">"\\?"</span>);</div><div class="line">                this.url = urlArray[0];</div><div class="line">                paramString = urlArray[1];</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                this.url = urlStr;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (paramString.equals(<span class="string">""</span>)) </div><div class="line">            <span class="built_in">return</span>;</div><div class="line">        parseParams(paramString);   // 解析请求参数</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * 解析请求信息中的参数</div><div class="line">     * @param paramString</div><div class="line">     */</div><div class="line">    private void parseParams(String paramString) &#123;</div><div class="line">        StringTokenizer token = new StringTokenizer(paramString, <span class="string">"&amp;"</span>);</div><div class="line">        <span class="keyword">while</span> (token.hasMoreTokens()) &#123;</div><div class="line">            String str = token.nextToken();</div><div class="line">            String[] keyAndVal = str.split(<span class="string">"="</span>);</div><div class="line">            <span class="keyword">if</span> (keyAndVal.length == 1) &#123;    // 只有参数没有值</div><div class="line">                keyAndVal = Arrays.copyOf(keyAndVal, 2);</div><div class="line">                keyAndVal[1] = null;</div><div class="line">            &#125;</div><div class="line">            String key = keyAndVal[0].trim();</div><div class="line">            String val = (null == keyAndVal[1] ? null : decode(keyAndVal[1].trim(), <span class="string">"utf-8"</span>));</div><div class="line">            <span class="keyword">if</span> (!parameterMapValues.containsKey(key)) &#123;</div><div class="line">                parameterMapValues.put(key, new ArrayList&lt;&gt;());</div><div class="line">            &#125;</div><div class="line">            List&lt;String&gt; values = parameterMapValues.get(key);</div><div class="line">            values.add(val);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * 解决中文问题</div><div class="line">     * @param value 需要正确显示中文的字符</div><div class="line">     * @param code 字符集（gbk、utf-8等）</div><div class="line">     * @<span class="built_in">return</span> String 如异常则返回null</div><div class="line">     */</div><div class="line">    private String decode(String value, String code) &#123;</div><div class="line">        try &#123;</div><div class="line">            <span class="built_in">return</span> URLDecoder.decode(value, code);</div><div class="line">        &#125; catch (UnsupportedEncodingException e) &#123;&#125;</div><div class="line">        </div><div class="line">        <span class="built_in">return</span> null;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * 获取网页对应name的多个值</div><div class="line">     * @param name</div><div class="line">     * @<span class="built_in">return</span> String[] 一个name有多个值</div><div class="line">     */</div><div class="line">    public String[] getParameterValues(String name) &#123;</div><div class="line">        List&lt;String&gt; values = parameterMapValues.get(name);</div><div class="line">        <span class="keyword">if</span> (null == values)</div><div class="line">            <span class="built_in">return</span> null;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="built_in">return</span> values.toArray(new String[0]);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * 获取网页对应name的值</div><div class="line">     * @param name</div><div class="line">     * @<span class="built_in">return</span> String name对应的值</div><div class="line">     */</div><div class="line">    public String getParameter(String name) &#123;</div><div class="line">        String[] values = getParameterValues(name);</div><div class="line">        <span class="built_in">return</span> (null == values) ? null : values[0];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String <span class="function"><span class="title">getUrl</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> url;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void <span class="built_in">set</span>Url(String url) &#123;</div><div class="line">        this.url = url;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>需要注意参数值为中文、一参多值的情况。</p>
</blockquote>
<h3 id="六、Servlet"><a href="#六、Servlet" class="headerlink" title="六、Servlet"></a>六、Servlet</h3><p>客户端与服务器端的交互形式不定，如登录、注册、查看信息等。可抽象出一个抽象类，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public abstract class Servlet &#123;</div><div class="line">    public void service(Request req, Response rep) throws Exception &#123;</div><div class="line">        <span class="keyword">do</span>Get(req, rep);</div><div class="line">        <span class="keyword">do</span>Post(req, rep);</div><div class="line">    &#125;</div><div class="line">    public abstract void <span class="keyword">do</span>Get(Request req, Response rep) throws Exception;</div><div class="line">    public abstract void <span class="keyword">do</span>Post(Request req, Response rep) throws Exception;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>具体的交互业务类Servlet继承抽象类，利用JAVA的多态优化其他代码。示例如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class RegisterServlet extends Servlet &#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="keyword">do</span>Get(Request req, Response rep) throws Exception &#123;</div><div class="line">        rep.println(<span class="string">"&lt;html&gt;&lt;title&gt;HTTP响应示例&lt;/title&gt;&lt;body&gt;欢迎用户"</span> + req.getParameter(<span class="string">"username"</span>) + <span class="string">"注册成功&lt;/body&gt;&lt;/html&gt;"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="keyword">do</span>Post(Request req, Response rep) throws Exception &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="七、分发器Dispatcher"><a href="#七、分发器Dispatcher" class="headerlink" title="七、分发器Dispatcher"></a>七、分发器Dispatcher</h3><p>既然交互方式不定，同一种交互方式的交互次数不定，需要借助分发器（多线程）进行优化处理。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 分发器，多线程（一个请求响应，创建一个此对象）</div><div class="line"> * @author xianxiaotao</div><div class="line"> */</div><div class="line">public class Dispatcher implements Runnable &#123;</div><div class="line">    private Socket client;</div><div class="line">    private Request req;</div><div class="line">    private Response rep;</div><div class="line">    private int code = 200;     // 默认200</div><div class="line">    </div><div class="line">    public Dispatcher(Socket client) &#123;</div><div class="line">        this.client = client;</div><div class="line">        try &#123;</div><div class="line">            req = new Request(client.getInputStream());</div><div class="line">            rep = new Response(client.getOutputStream());</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            code = 500;</div><div class="line">            <span class="built_in">return</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void <span class="function"><span class="title">run</span></span>() &#123;</div><div class="line">        try &#123;</div><div class="line">            // 根据请求参数中的url找到对应的Servlet</div><div class="line">            Servlet servlet = WebApp.getServlet(req.getUrl());  </div><div class="line">            <span class="keyword">if</span> (null == servlet)    // 找不到处理</div><div class="line">                this.code = 404;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                servlet.service(req, rep);</div><div class="line">            rep.pushToClient(code);</div><div class="line">        &#125; catch (Exception e) &#123;</div><div class="line">            this.code = 500;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        // 再推送一次</div><div class="line">        try &#123;</div><div class="line">            rep.pushToClient(code);</div><div class="line">        &#125; catch (IOException e) &#123;&#125;</div><div class="line">        </div><div class="line">        CloseUtil.closeSocket(client);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="八、上下文ServletContext和全局变量WebApp"><a href="#八、上下文ServletContext和全局变量WebApp" class="headerlink" title="八、上下文ServletContext和全局变量WebApp"></a>八、上下文ServletContext和全局变量WebApp</h3><p>分发器需要根据请求参数中的url，从上下文中找出对应的Servlet来做相应的处理。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 上下文</div><div class="line"> * @author xianxiaotao</div><div class="line"> */</div><div class="line">public class ServletContext &#123;</div><div class="line">    private Map&lt;String, String&gt; mapping;    // url(/register) ——&gt; 别名(register)</div><div class="line">    private Map&lt;String, Servlet&gt; servlet;   // 别名(register) ——&gt; 对应的Servlet(RegisterServlet)，后期使用反射其全类名获取对象</div><div class="line">    </div><div class="line">    public <span class="function"><span class="title">ServletContext</span></span>() &#123;</div><div class="line">        mapping = new HashMap&lt;&gt;();</div><div class="line">        servlet = new HashMap&lt;&gt;();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Map&lt;String, String&gt; <span class="function"><span class="title">getMapping</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> mapping;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void <span class="built_in">set</span>Mapping(Map&lt;String, String&gt; mapping) &#123;</div><div class="line">        this.mapping = mapping;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Map&lt;String, Servlet&gt; <span class="function"><span class="title">getServlet</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> servlet;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void <span class="built_in">set</span>Servlet(Map&lt;String, Servlet&gt; servlet) &#123;</div><div class="line">        this.servlet = servlet;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>创建WebApp，保存全局变量（上下文），以及对应的操作（解析、获取）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public class WebApp &#123;</div><div class="line">    private static ServletContext context;</div><div class="line">    </div><div class="line">    // 初始化请求资源路径与Servlet的对应关系，临时代码，后期解析配置文件获取对应关系</div><div class="line">    static &#123;</div><div class="line">        context = new ServletContext();</div><div class="line">        Map&lt;String, String&gt; mapping = context.getMapping();</div><div class="line">        mapping.put(<span class="string">"/reg"</span>, <span class="string">"register"</span>);</div><div class="line">        mapping.put(<span class="string">"/register"</span>, <span class="string">"register"</span>);</div><div class="line">        Map&lt;String, Servlet&gt; servlet = context.getServlet();</div><div class="line">        servlet.put(<span class="string">"register"</span>, new RegisterServlet());</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * 根据url获取对应的Servlet</div><div class="line">     * @param url 表单Action中的值</div><div class="line">     * @<span class="built_in">return</span> Servlet</div><div class="line">     */</div><div class="line">    public static Servlet getServlet(String url) &#123;</div><div class="line">        <span class="keyword">if</span> (null == url || url.trim().length() == 0)</div><div class="line">            <span class="built_in">return</span> null;</div><div class="line">        <span class="built_in">return</span> context.getServlet().get(context.getMapping().get(url));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>如果将上下文中存放的Servlet对象，改成存放对象全类名字符串。需要对象时，利用JAVA中的反射技术创建对象，这将极大优化内存。</p>
</blockquote>
<h3 id="九、反射"><a href="#九、反射" class="headerlink" title="九、反射"></a>九、反射</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Map&lt;String, String &gt; servlet = context.getServlet();</div><div class="line">servlet.put(<span class="string">"register"</span>, <span class="string">"com.xian.blog.xtomcat.RegisterServlet"</span>);</div><div class="line"></div><div class="line">public static Servlet getServlet(String url) throws InstantiationException, IllegalAccessException, ClassNotFoundException &#123;</div><div class="line">    <span class="keyword">if</span> (null == url || url.trim().length() == 0)</div><div class="line">        <span class="built_in">return</span> null;</div><div class="line">    String servletName = context.getServlet().get(context.getMapping().get(url));</div><div class="line">    <span class="built_in">return</span> (Servlet)Class.forName(servletName).newInstance();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="十、Xml配置文件"><a href="#十、Xml配置文件" class="headerlink" title="十、Xml配置文件"></a>十、Xml配置文件</h3><p>将请求资源路径与Servlet的对应关系写死在程序中，不便于代码维护扩展。最好的方式将其配置的xml文件中，程序负责解析而不用经常修改代码。配置文件格式如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</div><div class="line">&lt;web-app&gt;</div><div class="line">    &lt;servlet&gt;</div><div class="line">        &lt;servlet-name&gt;register&lt;/servlet-name&gt;</div><div class="line">        &lt;servlet-class&gt;com.xian.blog.xtomcat.RegisterServlet&lt;/servlet-class&gt;</div><div class="line">    &lt;/servlet&gt;</div><div class="line">    &lt;servlet-mapping&gt;</div><div class="line">        &lt;servlet-name&gt;register&lt;/servlet-name&gt;</div><div class="line">        &lt;url-pattern&gt;/reg&lt;/url-pattern&gt;</div><div class="line">        &lt;url-pattern&gt;/register&lt;/url-pattern&gt;</div><div class="line">    &lt;/servlet-mapping&gt;</div><div class="line">&lt;/web-app&gt;</div></pre></td></tr></table></figure></p>
<p>从文件中抽象出2个对象<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 存放配置信息：</div><div class="line"> * &lt;servlet&gt;</div><div class="line"> *      &lt;servlet-name&gt;register&lt;/servlet-name&gt;</div><div class="line"> *      &lt;servlet-class&gt;com.xian.blog.xtomcat.RegisterServlet&lt;/servlet-class&gt;</div><div class="line"> * &lt;/servlet&gt;</div><div class="line"> * @author xianxiaotao</div><div class="line"> */</div><div class="line">public class Entity &#123;</div><div class="line">    private String name;</div><div class="line">    private String clzz;</div><div class="line">    public String <span class="function"><span class="title">getName</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> name;</div><div class="line">    &#125;</div><div class="line">    public void <span class="built_in">set</span>Name(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line">    public String <span class="function"><span class="title">getClzz</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> clzz;</div><div class="line">    &#125;</div><div class="line">    public void <span class="built_in">set</span>Clzz(String clzz) &#123;</div><div class="line">        this.clzz = clzz;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line"> * 存放配置信息：</div><div class="line"> * &lt;servlet-mapping&gt;</div><div class="line"> *      &lt;servlet-name&gt;register&lt;/servlet-name&gt;</div><div class="line"> *      &lt;url-pattern&gt;/reg&lt;/url-pattern&gt;</div><div class="line"> *      &lt;url-pattern&gt;/register&lt;/url-pattern&gt;</div><div class="line"> * &lt;/servlet-mapping&gt;</div><div class="line"> * @author xianxiaotao</div><div class="line"> */</div><div class="line">public class Mapping &#123;</div><div class="line">    private String name;</div><div class="line">    private List&lt;String&gt; urlPattern;</div><div class="line">    public <span class="function"><span class="title">Mapping</span></span>() &#123;</div><div class="line">        urlPattern = new ArrayList&lt;&gt;();</div><div class="line">    &#125;</div><div class="line">    public String <span class="function"><span class="title">getName</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> name;</div><div class="line">    &#125;</div><div class="line">    public void <span class="built_in">set</span>Name(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line">    public List&lt;String&gt; <span class="function"><span class="title">getUrlPattern</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> urlPattern;</div><div class="line">    &#125;</div><div class="line">    public void <span class="built_in">set</span>UrlPattern(List&lt;String&gt; urlPattern) &#123;</div><div class="line">        this.urlPattern = urlPattern;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>具体子类实现DefaultHandler中的方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line">public class WebHandler extends DefaultHandler &#123;</div><div class="line">    private List&lt;Entity&gt; entityList;</div><div class="line">    private List&lt;Mapping&gt; mappingList;</div><div class="line">    private Entity entity;</div><div class="line">    private Mapping mapping;</div><div class="line">    private String beginTag;</div><div class="line">    private boolean isMapping;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void startDocument() throws SAXException &#123;</div><div class="line">        // 文档解析开始</div><div class="line">        entityList = new ArrayList&lt;&gt;();</div><div class="line">        mappingList = new ArrayList&lt;&gt;();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    @Override</div><div class="line">    public void startElement(String uri, String <span class="built_in">local</span>Name, String qName, Attributes attributes) throws SAXException &#123;</div><div class="line">        // 开始元素</div><div class="line">        <span class="keyword">if</span> (null != qName) &#123;</div><div class="line">            beginTag = qName;</div><div class="line">            <span class="keyword">if</span> (qName.equals(<span class="string">"servlet"</span>)) &#123;</div><div class="line">                isMapping = <span class="literal">false</span>;</div><div class="line">                entity = new Entity();</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (qName.equals(<span class="string">"servlet-mapping"</span>)) &#123;</div><div class="line">                isMapping = <span class="literal">true</span>;</div><div class="line">                mapping = new Mapping();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    @Override</div><div class="line">    public void characters(char[] ch, int start, int length) throws SAXException &#123;</div><div class="line">        // 处理元素</div><div class="line">        <span class="keyword">if</span> (null != beginTag) &#123;</div><div class="line">            String str = new String(ch, start, length);</div><div class="line">            <span class="keyword">if</span> (isMapping) &#123;</div><div class="line">                <span class="keyword">if</span> (beginTag.equals(<span class="string">"servlet-name"</span>)) &#123;</div><div class="line">                    mapping.setName(str);</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (beginTag.equals(<span class="string">"url-pattern"</span>)) &#123;</div><div class="line">                    mapping.getUrlPattern().add(str);</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span> (beginTag.equals(<span class="string">"servlet-name"</span>)) &#123;</div><div class="line">                    entity.setName(str);</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (beginTag.equals(<span class="string">"servlet-class"</span>)) &#123;</div><div class="line">                    entity.setClzz(str);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    @Override</div><div class="line">    public void endElement(String uri, String <span class="built_in">local</span>Name, String qName) throws SAXException &#123;</div><div class="line">        // 结束元素</div><div class="line">        <span class="keyword">if</span> (null != qName) &#123;</div><div class="line">            <span class="keyword">if</span> (qName.equals(<span class="string">"servlet"</span>)) &#123;</div><div class="line">                entityList.add(entity);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (qName.equals(<span class="string">"servlet-mapping"</span>)) &#123;</div><div class="line">                mappingList.add(mapping);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        beginTag = null;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void endDocument() throws SAXException &#123;</div><div class="line">        // 文档解析结束</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public List&lt;Entity&gt; <span class="function"><span class="title">getEntityList</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> entityList;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void <span class="built_in">set</span>EntityList(List&lt;Entity&gt; entityList) &#123;</div><div class="line">        this.entityList = entityList;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public List&lt;Mapping&gt; <span class="function"><span class="title">getMappingList</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> mappingList;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void <span class="built_in">set</span>MappingList(List&lt;Mapping&gt; mappingList) &#123;</div><div class="line">        this.mappingList = mappingList;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>解析配置文件代码如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// 初始化请求资源路径与Servlet的对应关系，临时代码，后期解析配置文件获取对应关系</div><div class="line">static &#123;</div><div class="line">    try &#123;</div><div class="line">        SAXParserFactory factory = SAXParserFactory.newInstance();  // 获取解析工厂</div><div class="line">        SAXParser parser = factory.newSAXParser();</div><div class="line">        WebHandler handler = new WebHandler();</div><div class="line">        parser.parse(Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="string">"com/xian/blog/xtomcat/web.xml"</span>), handler);</div><div class="line">        </div><div class="line">        context = new ServletContext();</div><div class="line">        Map&lt;String, String &gt; servlet = context.getServlet();</div><div class="line">        <span class="keyword">for</span> (Entity entity : handler.getEntityList())</div><div class="line">            servlet.put(entity.getName(), entity.getClzz());</div><div class="line">        </div><div class="line">        Map&lt;String, String&gt; mapping = context.getMapping();</div><div class="line">        <span class="keyword">for</span> (Mapping mapp : handler.getMappingList()) &#123;</div><div class="line">            List&lt;String&gt; urlPatterns = mapp.getUrlPattern();</div><div class="line">            <span class="keyword">for</span> (String url : urlPatterns) &#123;</div><div class="line">                mapping.put(url, mapp.getName());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; catch (Exception e) &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="十一、完整代码下载链接"><a href="#十一、完整代码下载链接" class="headerlink" title="十一、完整代码下载链接"></a>十一、完整代码下载链接</h3><p><a href="https://pan.baidu.com/s/1bo3Dd0r" target="_blank" rel="external">https://pan.baidu.com/s/1bo3Dd0r</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/17/JAVA/JAVA聊天室原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/17/JAVA/JAVA聊天室原理/" itemprop="url">JAVA | 聊天室原理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-17T19:35:41+08:00">
                2016-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>JAVA为基于TCP协议开发提供了相关API，具体代码如下。<br>客户端：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Socket client = new Socket(<span class="string">"localhost"</span>, 9876);	// 创建客户端，并指定服务器端地址和端口</div><div class="line">DataOutputStream dos = new DataOutputStream(client.getOutputStream());</div><div class="line">dos.writeUTF(<span class="string">"客户端向服务器端发送数据"</span>);           // 客户端向服务器发送数据</div><div class="line">		</div><div class="line">DataInputStream dis = new DataInputStream(client.getInputStream());</div><div class="line">String msg = dis.readUTF();                     // 客户端接受服务器端返回的数据</div><div class="line">System.out.println(msg);</div><div class="line">client.close();</div></pre></td></tr></table></figure></p>
<p>服务端：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">ServerSocket server = new ServerSocket(9876);   // 创建服务器并指定端口</div><div class="line">Socket socket = server.accept();                // 接受客户端连接（阻塞式）</div><div class="line"></div><div class="line">DataInputStream dis = new DataInputStream(socket.getInputStream());</div><div class="line">String msg = dis.readUTF();                     // 读取客户端请求数据</div><div class="line"></div><div class="line">DataOutputStream dos = new DataOutputStream(socket.getOutputStream());</div><div class="line">dos.writeUTF(<span class="string">"服务器接受的数据："</span> + msg);          // 服务器端返回客户端数据</div><div class="line">dos.flush();</div><div class="line">server.close();</div></pre></td></tr></table></figure></p>
<blockquote>
<p>上述代码中，只建立一次请求，为实现双方多次交互，则需要加入循环处理；而且客户端发送数据和接受数据都在一个线程中，意味着客户端不发送数据就接受不了服务端返回的数据，因此他们需要在不同的线程中处理各自的业务。服务器端同理。</p>
</blockquote>
<h3 id="客户端实现多线程"><a href="#客户端实现多线程" class="headerlink" title="客户端实现多线程"></a>客户端实现多线程</h3><p>发送数据线程：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">public class Send implements Runnable &#123;</div><div class="line">    private BufferedReader console;     // 测试时使用控制台输入信息</div><div class="line">    private DataOutputStream dos;       // 输出流（发送数据）</div><div class="line">    private boolean isRunning = <span class="literal">true</span>;   // 控制线程运行</div><div class="line">    </div><div class="line">    public Send(Socket client) &#123;</div><div class="line">        console = new BufferedReader(new InputStreamReader(System.in));</div><div class="line">        try &#123;</div><div class="line">            dos = new DataOutputStream(client.getOutputStream());</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            end();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    private String <span class="function"><span class="title">getMsgFromConsole</span></span>() &#123;</div><div class="line">        try &#123; <span class="built_in">return</span> console.readLine(); &#125; catch (IOException e) &#123;&#125;</div><div class="line">        <span class="built_in">return</span> <span class="string">""</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    private void <span class="function"><span class="title">end</span></span>() &#123;    // 出现异常则结束线程</div><div class="line">        isRunning = <span class="literal">false</span>; </div><div class="line">        CloseUtil.closeIO(console, dos);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    private void <span class="function"><span class="title">send</span></span>() &#123;   // 发送数据</div><div class="line">        String msg = getMsgFromConsole();</div><div class="line">        try &#123;</div><div class="line">            <span class="keyword">if</span> (null != msg &amp;&amp; msg.length() &gt; 0)</div><div class="line">                dos.writeUTF(msg);</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">    	    end();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public void <span class="function"><span class="title">run</span></span>() &#123;     // 线程体</div><div class="line">        <span class="keyword">while</span> (isRunning)</div><div class="line">            send();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接受数据线程：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">public class Receive implements Runnable &#123;</div><div class="line">    private DataInputStream dis;      // 输入流（接受数据）</div><div class="line">    private boolean isRunning = <span class="literal">true</span>; // 控制线程运行</div><div class="line"></div><div class="line">    public Receive (Socket client) &#123;</div><div class="line">        try &#123;</div><div class="line">            dis = new DataInputStream(client.getInputStream());</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            end();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void <span class="function"><span class="title">end</span></span>() &#123;              // 出现异常则结束线程</div><div class="line">        isRunning = <span class="literal">false</span>; </div><div class="line">        CloseUtil.closeIO(dis);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private String <span class="function"><span class="title">receive</span></span>() &#123;        // 接受数据</div><div class="line">        String msg = <span class="string">""</span>;</div><div class="line">        try &#123;</div><div class="line">            msg = dis.readUTF();</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            end();</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> msg;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void <span class="function"><span class="title">run</span></span>() &#123;</div><div class="line">        <span class="keyword">while</span> (isRunning) </div><div class="line">            System.out.println(receive());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>客户端只需开启Send、Receive两个线程：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Socket client = new Socket(<span class="string">"localhost"</span>, 9876); // 创建客户端，并指定服务器端地址和端口</div><div class="line">new Thread(new Send(client)).start();</div><div class="line">new Thread(new Receive(client)).start();</div></pre></td></tr></table></figure></p>
<h3 id="服务端实现群聊"><a href="#服务端实现群聊" class="headerlink" title="服务端实现群聊"></a>服务端实现群聊</h3><p>群聊，将服务端作为中转站，转发所有客户消息给其他客户（不需转给自己）。因此，服务端需要管理所有的连接通道，每个通道封装数据信息以及对应的操作。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">public class Server &#123;</div><div class="line">    // 保存连接通道	</div><div class="line">    private List&lt;ChatChannel&gt; channels = new ArrayList&lt;&gt;();</div><div class="line">	</div><div class="line">    // 启动服务</div><div class="line">    public void start() throws IOException &#123;</div><div class="line">        @SuppressWarnings(<span class="string">"resource"</span>)</div><div class="line">        ServerSocket server = new ServerSocket(9876);</div><div class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</div><div class="line">            Socket client = server.accept();</div><div class="line">            ChatChannel channel = new ChatChannel(client);</div><div class="line">            channels.add(channel);</div><div class="line">            new Thread(channel).start();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    // 连接通道类</div><div class="line">    private class ChatChannel implements Runnable &#123;</div><div class="line">        private DataInputStream dis;</div><div class="line">        private DataOutputStream dos;</div><div class="line">        private boolean isRunning = <span class="literal">true</span>;</div><div class="line">		</div><div class="line">        public ChatChannel(Socket socket) &#123;</div><div class="line">            try &#123;</div><div class="line">                dis = new DataInputStream(socket.getInputStream());</div><div class="line">                dos = new DataOutputStream(socket.getOutputStream());</div><div class="line">            &#125; catch (IOException e) &#123;</div><div class="line">                end();</div><div class="line">            &#125;</div><div class="line">    	&#125;</div><div class="line">		</div><div class="line">        private String <span class="function"><span class="title">receive</span></span>() &#123;</div><div class="line">            String msg = <span class="string">""</span>;</div><div class="line">            try &#123;</div><div class="line">                msg = dis.readUTF();</div><div class="line">            &#125; catch (IOException e) &#123;</div><div class="line">                end();</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">return</span> msg;</div><div class="line">        &#125;</div><div class="line">		</div><div class="line">        private void send(String msg) &#123;</div><div class="line">            <span class="keyword">if</span> (null == msg || msg.length() == 0)</div><div class="line">                <span class="built_in">return</span>;</div><div class="line">            try &#123;</div><div class="line">                dos.writeUTF(msg);</div><div class="line">                dos.flush();</div><div class="line">            &#125; catch (IOException e) &#123;</div><div class="line">                end();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">		</div><div class="line">        private void <span class="function"><span class="title">end</span></span>() &#123;</div><div class="line">            CloseUtil.closeIO(dis, dos);</div><div class="line">            isRunning = <span class="literal">false</span>;</div><div class="line">            channels.remove(this);</div><div class="line">        &#125;</div><div class="line">		</div><div class="line">        @Override</div><div class="line">        public void <span class="function"><span class="title">run</span></span>() &#123;</div><div class="line">            <span class="keyword">while</span> (isRunning) &#123;</div><div class="line">                String msg = receive();</div><div class="line">                <span class="keyword">for</span> (ChatChannel other : channels) &#123;</div><div class="line">                    <span class="keyword">if</span> (other == this)</div><div class="line">                        <span class="built_in">continue</span>;</div><div class="line">                    other.send(msg);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>开启服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">new Server().start();</div></pre></td></tr></table></figure></p>
<h3 id="私聊"><a href="#私聊" class="headerlink" title="私聊"></a>私聊</h3><p>要找到对应的用户进行私聊，需要对每个客户端进行唯一性标示，即创建客户端的时候指定用户名/ID并发送给服务端，服务端在创建对应的ChatChannel时，保存获取到的用户名/ID信息。而私聊的代码实现就是将信息转发到指定的ChatChannel连接通道中。</p>
<blockquote>
<p>按照面向对象编程的思想，用户信息、消息本体都要封装成一个个的对象。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/13/JAVA/JAVA多线程断点下载/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/13/JAVA/JAVA多线程断点下载/" itemprop="url">JAVA | 多线程断点下载</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-13T20:46:25+08:00">
                2016-07-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>基本原理：利用URLConnection获取要下载文件的长度、头部等相关信息，并设置响应的头部信息。并且通过URLConnection获取输入流，将文件分成指定的块，每一块单独开辟一个线程完成数据的读取、写入。通过输入流读取下载文件的信息，然后将读取的信息用RandomAccessFile随机写入到本地文件中。同时，每个线程写入的数据都文件指针也就是写入数据的长度，需要保存在一个临时文件中。这样当本次下载没有完成的时候，下次下载的时候就从这个文件中读取上一次下载的文件长度，然后继续接着上一次的位置开始下载。并且将本次下载的长度写入到这个文件中。</p>
<h3 id="最简单的下载代码："><a href="#最简单的下载代码：" class="headerlink" title="最简单的下载代码："></a>最简单的下载代码：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">package com.xian.blog;</div><div class="line"></div><div class="line">import java.io.BufferedInputStream;</div><div class="line">import java.io.BufferedOutputStream;</div><div class="line">import java.io.FileOutputStream;</div><div class="line">import java.net.HttpURLConnection;</div><div class="line">import java.net.URL;</div><div class="line"></div><div class="line">public class SimpleDownload &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        try &#123;</div><div class="line">            URL url = new URL(<span class="string">"http://ww1.sinaimg.cn/large/adc90466gy1fcptk0wnt2j20e90ifmz4"</span>);</div><div class="line">            HttpURLConnection conn = (HttpURLConnection) url.openConnection();</div><div class="line">            conn.setConnectTimeout(3000);</div><div class="line">            int code = conn.getResponseCode();</div><div class="line">			</div><div class="line">            <span class="keyword">if</span> (200 == code) &#123;</div><div class="line">                BufferedInputStream <span class="keyword">in</span> = new BufferedInputStream(conn.getInputStream());</div><div class="line">                BufferedOutputStream out = new BufferedOutputStream(new FileOutputStream(<span class="string">"/Users/xianxiaotao/desktop/activitylife.png"</span>));</div><div class="line">                byte[] buf = new byte[1024];</div><div class="line">                int len = -1;</div><div class="line">                <span class="keyword">while</span> (-1 != (len = in.read(buf)))</div><div class="line">                    out.write(buf, 0, len);</div><div class="line">                in.close();</div><div class="line">                out.close();</div><div class="line">            &#125;</div><div class="line">        &#125; catch (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>上述代码简易，但不适合大型文件下载。</p>
</blockquote>
<h3 id="多线程断点下载代码："><a href="#多线程断点下载代码：" class="headerlink" title="多线程断点下载代码："></a>多线程断点下载代码：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div></pre></td><td class="code"><pre><div class="line">package com.xian.blog;</div><div class="line"></div><div class="line">import java.io.BufferedInputStream;</div><div class="line">import java.io.File;</div><div class="line">import java.io.IOException;</div><div class="line">import java.io.RandomAccessFile;</div><div class="line">import java.net.HttpURLConnection;</div><div class="line">import java.net.URL;</div><div class="line"></div><div class="line">public class XDownloadTask extends Thread&#123;</div><div class="line">    private static final String DIR_PATH = <span class="string">"/Users/xianxiaotao/downloads"</span>;  // 下载目录</div><div class="line">    private static final int THREAD_AMOUNT = 3;				    // 总线程数</div><div class="line">	</div><div class="line">    private URL url;		// 目标下载地址</div><div class="line">    private File dataFile;	// 本地文件</div><div class="line">    private File tempFile;	// 存储线程下载进度的临时文件</div><div class="line">    private long totalLength;	// 服务端文件总长度</div><div class="line">    private long threadLenght;	// 每个线程要下载的长度</div><div class="line">    private long totalFinish;	// 记录：总共完成了多少</div><div class="line">    private long begin;		// 用来记录下载开始时间</div><div class="line">	</div><div class="line">    public XDownloadTask(String address) throws IOException &#123;</div><div class="line">	url = new URL(address);								// 记住下载地址</div><div class="line">	dataFile = new File(DIR_PATH, address.substring(address.lastIndexOf(<span class="string">"/"</span>) + 1));	// 截取地址中的文件名，创建本地文件</div><div class="line">	tempFile = new File(dataFile.getAbsolutePath() + <span class="string">".temp"</span>);			// 在本地文件所在文件夹中创建临时文件</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    public void <span class="function"><span class="title">run</span></span>() &#123;</div><div class="line">	try &#123;</div><div class="line">	    HttpURLConnection conn = (HttpURLConnection) url.openConnection();</div><div class="line">	    conn.setConnectTimeout(10000);</div><div class="line">			</div><div class="line">            totalLength = conn.getContentLength();					// 获取服务端发送过来的文件长度</div><div class="line">	    threadLenght = (totalLength + THREAD_AMOUNT - 1) / THREAD_AMOUNT;		// 计算每个线程要下载的长度</div><div class="line">			</div><div class="line">	    <span class="keyword">if</span> (!tempFile.exists()) &#123;							// 如果临时文件不存在</div><div class="line">		RandomAccessFile raf = new RandomAccessFile(tempFile, <span class="string">"rw"</span>);		// 创建临时文件，用来记录每个线程已下载多少</div><div class="line">		<span class="keyword">for</span> (int i = 0; i &lt; THREAD_AMOUNT; i++)</div><div class="line">		    raf.writeInt(0);</div><div class="line">	        raf.close();</div><div class="line">	    &#125;</div><div class="line">			</div><div class="line">	    <span class="keyword">for</span> (int i = 0; i &lt; THREAD_AMOUNT; i++)	// 按线程数循环</div><div class="line">		new DownloadThread(i).start();		// 开启线程，每个线程将会下载一部分数据到本地文件中</div><div class="line">			</div><div class="line">	    begin = System.currentTimeMillis();		// 记录开始时间</div><div class="line">	&#125; catch (IOException e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    private class DownloadThread extends Thread &#123;</div><div class="line">	private int id;		// 用来标记当前线程是下载任务中的第几个线程</div><div class="line">		</div><div class="line">	public DownloadThread(int id) &#123;</div><div class="line">	    this.id = id;</div><div class="line">	&#125;</div><div class="line">		</div><div class="line">	public void <span class="function"><span class="title">run</span></span>() &#123;</div><div class="line">	    try &#123;</div><div class="line">		RandomAccessFile tempRaf = new RandomAccessFile(tempFile, <span class="string">"rws"</span>);	// 记录进度的临时文件</div><div class="line">		tempRaf.seek(id * 4);							// 将指针移动到当前线程的位置</div><div class="line">		int threadFinish = tempRaf.readInt();					// 读取当前线程已完成了多少</div><div class="line">		synchronized(XDownloadTask.this) &#123;					// 多个下载线程之间同步</div><div class="line">		    totalFinish += threadFinish;					// 统计所有线程总共完成了多少</div><div class="line">		&#125;</div><div class="line">				</div><div class="line">		long start = id * threadLenght + threadFinish;				// 计算当前线程起始位置</div><div class="line">		long end = id * threadLenght + threadLenght - 1;			// 计算当前线程结束位置</div><div class="line">		System.out.println(<span class="string">"线程"</span> + id + <span class="string">": "</span> + start + <span class="string">"-"</span> + end);</div><div class="line">				</div><div class="line">		HttpURLConnection conn = (HttpURLConnection) url.openConnection();</div><div class="line">		conn.setConnectTimeout(10000);</div><div class="line">		conn.setRequestProperty(<span class="string">"Range"</span>, <span class="string">"bytes="</span> + start + <span class="string">"-"</span> + end);		// 设置当前线程下载的范围</div><div class="line">				</div><div class="line">		BufferedInputStream <span class="keyword">in</span> = new BufferedInputStream(conn.getInputStream());// 获取连接的输入流</div><div class="line">		RandomAccessFile dataRaf = new RandomAccessFile(dataFile, <span class="string">"rws"</span>);	// 保存数据的本地文件</div><div class="line">		dataRaf.seek(start);							// 设置当前线程保存数据的位置</div><div class="line">				</div><div class="line">		byte[] buf = new byte[1024];</div><div class="line">		int len = -1;</div><div class="line">		<span class="keyword">while</span> (-1 != (len = in.read(buf))) &#123;</div><div class="line">		    dataRaf.write(buf, 0, len);</div><div class="line">		    threadFinish += len;</div><div class="line">		    tempRaf.seek(id * 4);</div><div class="line">		    tempRaf.writeInt(threadFinish);		// 将当前线程完成了多少写入到临时文件</div><div class="line">		    synchronized (XDownloadTask.this) &#123;</div><div class="line">			totalFinish += len;</div><div class="line">		    &#125;</div><div class="line">		&#125;</div><div class="line">				</div><div class="line">		dataRaf.close();</div><div class="line">		tempRaf.close();</div><div class="line">				</div><div class="line">		System.out.println(<span class="string">"线程"</span> + id + <span class="string">"下载完毕"</span>);</div><div class="line">		<span class="keyword">if</span> (totalFinish == totalLength) &#123;</div><div class="line">		    System.out.println(<span class="string">"下载完成，耗时："</span> + (System.currentTimeMillis() - begin));</div><div class="line">		    tempFile.delete();</div><div class="line">		&#125;</div><div class="line">	    &#125; catch (IOException e) &#123;</div><div class="line">		e.printStackTrace();</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    public static void main(String[] args) throws IOException &#123;</div><div class="line">	new XDownloadTask(<span class="string">"http://ww1.sinaimg.cn/large/adc90466gy1fcptk0wnt2j20e90ifmz4"</span>).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/04/JAVA/反射工具类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/04/JAVA/反射工具类/" itemprop="url">JAVA | 反射工具类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-04T00:00:00+08:00">
                2016-01-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Invoking-Arbitrary-Methods："><a href="#Invoking-Arbitrary-Methods：" class="headerlink" title="Invoking Arbitrary Methods："></a>Invoking Arbitrary Methods：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Method sqrt = Math.class.getMethod(<span class="string">"sqrt"</span>, double.class);</div><div class="line">double x = (Double) sqrt.invoke(null, 100); // 此方法为静态方法，隐式参数为null</div></pre></td></tr></table></figure>
<h4 id="ReflectionUtils："><a href="#ReflectionUtils：" class="headerlink" title="ReflectionUtils："></a>ReflectionUtils：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div></pre></td><td class="code"><pre><div class="line">package com.xian.reflection;</div><div class="line"></div><div class="line">import java.lang.annotation.Annotation;</div><div class="line">import java.lang.reflect.AccessibleObject;</div><div class="line">import java.lang.reflect.Array;</div><div class="line">import java.lang.reflect.Constructor;</div><div class="line">import java.lang.reflect.Field;</div><div class="line">import java.lang.reflect.Method;</div><div class="line">import java.lang.reflect.Modifier;</div><div class="line">import java.util.ArrayList;</div><div class="line"></div><div class="line">/**</div><div class="line"> * ReflectionUtils : </div><div class="line"> * 1 Get all features of a class</div><div class="line"> * 2 A generic toString method that works <span class="keyword">for</span> any class</div><div class="line"> * 3 Copy array</div><div class="line"> * </div><div class="line"> * @author xianxiaotao</div><div class="line"> */</div><div class="line">public class ReflectionUtils &#123;</div><div class="line">    /**</div><div class="line">     * flag to contain annotation and exception string</div><div class="line">     */</div><div class="line">    private static int flag = 0b00000000_00000000_00000000_00000000;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * flag : contain annotation string</div><div class="line">     */</div><div class="line">    public static final int CONTAIN_ANNOTATION = 0b00000000_00000000_00000000_00000001;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * flag : contain exception string</div><div class="line">     */</div><div class="line">    public static final int CONTAIN_EXCEPTION  = 0b00000000_00000000_00000000_00000010;</div><div class="line">    </div><div class="line">    // Cycles of references could cause an infinite recursion. Therefore, </div><div class="line">    // the ObjectAnalyzer keeps track of objects that were already visited</div><div class="line">    private static ArrayList&lt;Object&gt; visited = new ArrayList&lt;&gt;();</div><div class="line">    </div><div class="line">    // Suppresses default constructor, ensuring non-instantiability.</div><div class="line">    private <span class="function"><span class="title">ReflectionUtils</span></span>() &#123;&#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * Get all features of a class</div><div class="line">     * @param className</div><div class="line">     * @<span class="built_in">return</span></div><div class="line">     * @throws ClassNotFoundException</div><div class="line">     */</div><div class="line">    public static String getClass(String className) throws ClassNotFoundException &#123;</div><div class="line">        StringBuilder sb = new StringBuilder();</div><div class="line">        Class&lt;?&gt; clazz = Class.forName(className);</div><div class="line">        Class&lt;?&gt; superClazz = clazz.getSuperclass();</div><div class="line">        sb.append(clazz.getPackage().getName()).append(<span class="string">"\n\n"</span>);</div><div class="line">        sb.append(getAnnotations(clazz.getDeclaredAnnotations()));</div><div class="line">        sb.append(getModifiers(clazz.getModifiers()));</div><div class="line">        sb.append(<span class="string">"class "</span>).append(className);</div><div class="line">        <span class="keyword">if</span> (superClazz != null &amp;&amp; superClazz != Object.class)</div><div class="line">            sb.append(<span class="string">" extends "</span>).append(superClazz.getName());</div><div class="line">        </div><div class="line">        Class&lt;?&gt;[] interfaces = clazz.getInterfaces();</div><div class="line">        <span class="keyword">if</span> (interfaces.length &gt; 0)</div><div class="line">            sb.append(<span class="string">" implements "</span>);</div><div class="line">        <span class="keyword">for</span> (int i = 0; i &lt; interfaces.length; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (i &gt; 0) sb.append(<span class="string">", "</span>);</div><div class="line">            sb.append(interfaces[i].getName());</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        sb.append(<span class="string">" &#123;\n"</span>);</div><div class="line">        sb.append(getConstructors(clazz)).append(<span class="string">"\n"</span>);</div><div class="line">        sb.append(getMethods(clazz)).append(<span class="string">"\n"</span>);</div><div class="line">        sb.append(getFields(clazz)).append(<span class="string">"\n"</span>);</div><div class="line">        sb.append(<span class="string">"&#125;\n"</span>);</div><div class="line">        <span class="built_in">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * Get all constructors</div><div class="line">     * @param clazz</div><div class="line">     * @<span class="built_in">return</span> String</div><div class="line">     */</div><div class="line">    public static String getConstructors(Class&lt;?&gt; clazz) &#123;</div><div class="line">        StringBuilder sb = new StringBuilder();</div><div class="line">        Constructor&lt;?&gt;[] constructors = clazz.getDeclaredConstructors();</div><div class="line">        <span class="keyword">for</span> (Constructor&lt;?&gt; c : constructors) &#123;</div><div class="line">            sb.append(getAnnotations(c.getDeclaredAnnotations()));</div><div class="line">            String name = c.getName();</div><div class="line">            sb.append(<span class="string">"    "</span>);</div><div class="line">            String modifiers = Modifier.toString(c.getModifiers());</div><div class="line">            <span class="keyword">if</span> (modifiers.length() &gt; 0)</div><div class="line">                sb.append(modifiers).append(<span class="string">" "</span>);</div><div class="line">            sb.append(name).append(<span class="string">"("</span>);</div><div class="line">            String paramStr = getParamTypes(c.getParameterTypes());</div><div class="line">            sb.append(paramStr).append(<span class="string">")"</span>);</div><div class="line">            sb.append(getExceptions(c.getExceptionTypes()));</div><div class="line">            sb.append(<span class="string">";\n"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    private static String getExceptions(Class&lt;?&gt;[] es) &#123;</div><div class="line">        StringBuilder sb = new StringBuilder();</div><div class="line">        <span class="keyword">if</span> (isContainException() &amp;&amp; es != null &amp;&amp; es.length &gt; 0) &#123;</div><div class="line">            sb.append(<span class="string">" throws "</span>);</div><div class="line">            <span class="keyword">for</span> (int i = 0; i &lt; es.length; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (i &gt; 0) sb.append(<span class="string">", "</span>);</div><div class="line">                sb.append(es[i].getName());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * get annotation of a class, method or field</div><div class="line">     * @param as</div><div class="line">     * @<span class="built_in">return</span></div><div class="line">     */</div><div class="line">    private static String getAnnotations(Annotation[] as) &#123;</div><div class="line">        StringBuilder sb = new StringBuilder();</div><div class="line">        <span class="keyword">if</span> (isContainAnnotation() &amp;&amp; as != null &amp;&amp; as.length &gt; 0) &#123;</div><div class="line">            sb.append(<span class="string">"    @"</span>);</div><div class="line">            <span class="keyword">for</span> (int i = 0; i &lt; as.length; i++) &#123;</div><div class="line">                sb.append(as[i].annotationType().getName()).append(<span class="string">"\n"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * get parameter types</div><div class="line">     * @param paramTypes</div><div class="line">     * @<span class="built_in">return</span></div><div class="line">     */</div><div class="line">    private static String getParamTypes(Class&lt;?&gt;[] paramTypes) &#123;</div><div class="line">        StringBuilder sb = new StringBuilder();</div><div class="line">        <span class="keyword">for</span> (int i = 0; i &lt; paramTypes.length; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (i &gt; 0) sb.append(<span class="string">", "</span>);</div><div class="line">            sb.append(paramTypes[i].getName());</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    private static String getModifiers(int modifier) &#123;</div><div class="line">        String modifiers = Modifier.toString(modifier);</div><div class="line">        <span class="keyword">if</span> (modifiers.length() &gt; 0)</div><div class="line">            <span class="built_in">return</span> modifiers + <span class="string">" "</span>;</div><div class="line">        <span class="built_in">return</span> <span class="string">""</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * Get all methods of a class</div><div class="line">     * @param clazz</div><div class="line">     * @<span class="built_in">return</span></div><div class="line">     */</div><div class="line">    public static String getMethods(Class&lt;?&gt; clazz) &#123;</div><div class="line">        <span class="built_in">return</span> getMethods(clazz, null);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * Gets the method <span class="keyword">for</span> the specified method name</div><div class="line">     * @param clazz</div><div class="line">     * @<span class="built_in">return</span></div><div class="line">     */</div><div class="line">    public static String getMethods(Class&lt;?&gt; clazz, String methodName) &#123;</div><div class="line">        StringBuilder sb = new StringBuilder();</div><div class="line">        Method[] methods = clazz.getDeclaredMethods();</div><div class="line">        <span class="keyword">for</span> (Method m : methods) &#123;</div><div class="line">            sb.append(getAnnotations(m.getDeclaredAnnotations()));</div><div class="line">            Class&lt;?&gt; <span class="built_in">return</span>Type = m.getReturnType();</div><div class="line">            String name = m.getName();</div><div class="line">            <span class="keyword">if</span> (methodName != null &amp;&amp; !methodName.equals(name))</div><div class="line">                <span class="built_in">continue</span>;</div><div class="line">            sb.append(<span class="string">"    "</span>).append(getModifiers(m.getModifiers())).append(<span class="built_in">return</span>Type.getName()).append(<span class="string">" "</span> + name + <span class="string">"("</span>);</div><div class="line">            String paramStr = getParamTypes(m.getParameterTypes());</div><div class="line">            sb.append(paramStr).append(<span class="string">")"</span>);</div><div class="line">            sb.append(getExceptions(m.getExceptionTypes()));</div><div class="line">            sb.append(<span class="string">";\n"</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * Get all fields of a class</div><div class="line">     * @param clazz</div><div class="line">     * @<span class="built_in">return</span></div><div class="line">     */</div><div class="line">    public static String getFields(Class&lt;?&gt; clazz) &#123;</div><div class="line">        StringBuilder sb = new StringBuilder();</div><div class="line">        Field[] fields = clazz.getDeclaredFields();</div><div class="line">        <span class="keyword">for</span> (Field f : fields) &#123;</div><div class="line">            Class&lt;?&gt; <span class="built_in">type</span> = f.getType();</div><div class="line">            sb.append(<span class="string">"    "</span>).append(getModifiers(f.getModifiers())).append(type.getName()).append(<span class="string">" "</span>).append(f.getName()).append(<span class="string">";\n"</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * ReflectionUtils.setFlag(ReflectionUtils.CONTAIN_EXCEPTION | ReflectionUtils.CONTAIN_ANNOTATION);</div><div class="line">     * @param state</div><div class="line">     */</div><div class="line">    public static void <span class="built_in">set</span>Flag(int state) &#123;</div><div class="line">        flag = state;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    private static boolean <span class="function"><span class="title">isContainException</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> (flag &amp; CONTAIN_EXCEPTION) == CONTAIN_EXCEPTION ? <span class="literal">true</span> : <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    private static boolean <span class="function"><span class="title">isContainAnnotation</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> (flag &amp; CONTAIN_ANNOTATION) == CONTAIN_ANNOTATION ? <span class="literal">true</span> : <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     * Converts an object to a string representation that lists all fields.</div><div class="line">     * @param obj</div><div class="line">     * @<span class="built_in">return</span> a string with the object<span class="string">'s class name and all field names and values</span></div><div class="line">     */</div><div class="line">    public static String toString(Object obj) &#123;</div><div class="line">        if (obj == null) return "null";</div><div class="line">        if (visited.contains(obj)) return "...";</div><div class="line">        visited.add(obj);</div><div class="line">        </div><div class="line">        Class&lt;?&gt; clazz = obj.getClass();</div><div class="line">        if (clazz == String.class) return (String) obj;</div><div class="line">        if (clazz.isArray()) &#123;</div><div class="line">            String r = clazz.getComponentType() + "[]&#123;";</div><div class="line">            for (int i = 0; i &lt; Array.getLength(obj); i++) &#123;</div><div class="line">                if (i &gt; 0) r += ",";</div><div class="line">                Object val = Array.get(obj, i);</div><div class="line">                if (clazz.getComponentType().isPrimitive()) r += val;</div><div class="line">                else r += toString(val);    // recursion</div><div class="line">            &#125;</div><div class="line">            return r + "&#125;";</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        // others : inspect the fields of this class and all superclasses</div><div class="line">        String r = clazz.getName();</div><div class="line">        do &#123;</div><div class="line">            r += " [";</div><div class="line">            Field[] fields = clazz.getDeclaredFields();</div><div class="line">            AccessibleObject.setAccessible(fields, true);   // uses the setAccessible convenience method to make all fields accessible</div><div class="line">            for (Field f : fields) &#123;                        // get the names and values of all fields</div><div class="line">                if (!Modifier.isStatic(f.getModifiers())) &#123;</div><div class="line">                    if (!r.endsWith("[")) r += ",";</div><div class="line">                    r += f.getName() + "=";</div><div class="line">                    try &#123;</div><div class="line">                        Class&lt;?&gt; t = f.getType();</div><div class="line">                        Object val = f.get(obj);</div><div class="line">                        if (t.isPrimitive()) r += val;</div><div class="line">                        else r += toString(val);</div><div class="line">                    &#125; catch (Exception e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            r += "]";</div><div class="line">            </div><div class="line">            clazz = clazz.getSuperclass();</div><div class="line">            if (clazz.getSuperclass() != Object.class) </div><div class="line">                clazz = null;</div><div class="line">        &#125; while (clazz != null);</div><div class="line">        </div><div class="line">        return r;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">    * This method grows an array by allocating a new array of the same type and copying all elements.</div><div class="line">    * @param a the array to grow. This can be an object array or a primitive type array</div><div class="line">    * @return a larger array that contains all elements of a.</div><div class="line">    */</div><div class="line">    public static Object copyOf(Object arr, int newLength) &#123;</div><div class="line">        Class&lt;?&gt; clazz = arr.getClass();</div><div class="line">        if (!clazz.isArray()) return null;</div><div class="line">        </div><div class="line">        Class&lt;?&gt; componentType = clazz.getComponentType();</div><div class="line">        int length = Array.getLength(arr);</div><div class="line">        Object newArray = Array.newInstance(componentType, newLength);</div><div class="line">        System.arraycopy(arr, 0, newArray, 0, Math.min(length, newLength));</div><div class="line">        return newArray;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // clear static ArrayList var(visited)</div><div class="line">    public static void clean() &#123;</div><div class="line">        visited.clear();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // unit test</div><div class="line">    public static void main(String[] args) throws ClassNotFoundException &#123;</div><div class="line">        // setFlag(CONTAIN_EXCEPTION | CONTAIN_ANNOTATION);</div><div class="line">        // System.out.println(getClass("java.lang.String"));</div><div class="line">        </div><div class="line">        /*</div><div class="line">        // 使用方式如下或者在自定义类中toString方法里添加 ReflectionUtils.clear(); return ReflectionUtils.toString(this);</div><div class="line">        ArrayList&lt;Integer&gt; squares = new ArrayList&lt;&gt;(); </div><div class="line">        for (int i = 1; i &lt;= 5; i++)</div><div class="line">            squares.add(i * i);</div><div class="line">        System.out.println(ReflectionUtils.toString(squares));</div><div class="line">        ReflectionUtils.clear();</div><div class="line">        */</div><div class="line">        </div><div class="line">        System.out.println(new Manager("xian xiaotao", 300000, 2020, 1, 1));</div><div class="line">        // com.xian.reflection.Manager [name=xian xiaotao, salary=300000.0, hireDay=2020-01-01]</div><div class="line">        // com.xian.reflection.Manager [bonus=0.0] [id=0,name=xian xiaotao,salary=300000.0,hireDay=java.time.LocalDate [year=2020,month=1,day=1]]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line">java.lang</div><div class="line"></div><div class="line">public final class java.lang.String implements java.io.Serializable, java.lang.Comparable, java.lang.CharSequence &#123;</div><div class="line">    public java.lang.String([B, int, int);</div><div class="line">    public java.lang.String([B, java.nio.charset.Charset);</div><div class="line">    public java.lang.String([B, java.lang.String) throws java.io.UnsupportedEncodingException;</div><div class="line">    public java.lang.String([B, int, int, java.nio.charset.Charset);</div><div class="line">    public java.lang.String([B, int, int, java.lang.String) throws java.io.UnsupportedEncodingException;</div><div class="line">    java.lang.String([C, boolean);</div><div class="line">    public java.lang.String(java.lang.StringBuilder);</div><div class="line">    public java.lang.String(java.lang.StringBuffer);</div><div class="line">    public java.lang.String([B);</div><div class="line">    public java.lang.String([I, int, int);</div><div class="line">    public java.lang.String();</div><div class="line">    public java.lang.String([C);</div><div class="line">    public java.lang.String(java.lang.String);</div><div class="line">    public java.lang.String([C, int, int);</div><div class="line">    @java.lang.Deprecated</div><div class="line">    public java.lang.String([B, int);</div><div class="line">    @java.lang.Deprecated</div><div class="line">    public java.lang.String([B, int, int, int);</div><div class="line"></div><div class="line">    public boolean equals(java.lang.Object);</div><div class="line">    public java.lang.String toString();</div><div class="line">    public int <span class="built_in">hash</span>Code();</div><div class="line">    public volatile int compareTo(java.lang.Object);</div><div class="line">    public int compareTo(java.lang.String);</div><div class="line">    public int indexOf(java.lang.String, int);</div><div class="line">    static int indexOf([C, int, int, java.lang.String, int);</div><div class="line">    static int indexOf([C, int, int, [C, int, int, int);</div><div class="line">    public int indexOf(int);</div><div class="line">    public int indexOf(java.lang.String);</div><div class="line">    public int indexOf(int, int);</div><div class="line">    public static java.lang.String valueOf(char);</div><div class="line">    public static java.lang.String valueOf(java.lang.Object);</div><div class="line">    public static java.lang.String valueOf(boolean);</div><div class="line">    public static java.lang.String valueOf([C, int, int);</div><div class="line">    public static java.lang.String valueOf([C);</div><div class="line">    public static java.lang.String valueOf(double);</div><div class="line">    public static java.lang.String valueOf(<span class="built_in">float</span>);</div><div class="line">    public static java.lang.String valueOf(long);</div><div class="line">    public static java.lang.String valueOf(int);</div><div class="line">    private static void checkBounds([B, int, int);</div><div class="line">    public int length();</div><div class="line">    public boolean isEmpty();</div><div class="line">    public char charAt(int);</div><div class="line">    public int codePointAt(int);</div><div class="line">    public int codePointBefore(int);</div><div class="line">    public int codePointCount(int, int);</div><div class="line">    public int offsetByCodePoints(int, int);</div><div class="line">    public void getChars(int, int, [C, int);</div><div class="line">    void getChars([C, int);</div><div class="line">    public [B getBytes();</div><div class="line">    public [B getBytes(java.lang.String) throws java.io.UnsupportedEncodingException;</div><div class="line">    @java.lang.Deprecated</div><div class="line">    public void getBytes(int, int, [B, int);</div><div class="line">    public [B getBytes(java.nio.charset.Charset);</div><div class="line">    public boolean contentEquals(java.lang.StringBuffer);</div><div class="line">    public boolean contentEquals(java.lang.CharSequence);</div><div class="line">    private boolean nonSyncContentEquals(java.lang.AbstractStringBuilder);</div><div class="line">    public boolean equalsIgnoreCase(java.lang.String);</div><div class="line">    public int compareToIgnoreCase(java.lang.String);</div><div class="line">    public boolean regionMatches(int, java.lang.String, int, int);</div><div class="line">    public boolean regionMatches(boolean, int, java.lang.String, int, int);</div><div class="line">    public boolean startsWith(java.lang.String);</div><div class="line">    public boolean startsWith(java.lang.String, int);</div><div class="line">    public boolean endsWith(java.lang.String);</div><div class="line">    private int indexOfSupplementary(int, int);</div><div class="line">    public int lastIndexOf(int, int);</div><div class="line">    static int lastIndexOf([C, int, int, [C, int, int, int);</div><div class="line">    static int lastIndexOf([C, int, int, java.lang.String, int);</div><div class="line">    public int lastIndexOf(java.lang.String, int);</div><div class="line">    public int lastIndexOf(int);</div><div class="line">    public int lastIndexOf(java.lang.String);</div><div class="line">    private int lastIndexOfSupplementary(int, int);</div><div class="line">    public java.lang.String substring(int);</div><div class="line">    public java.lang.String substring(int, int);</div><div class="line">    public java.lang.CharSequence subSequence(int, int);</div><div class="line">    public java.lang.String concat(java.lang.String);</div><div class="line">    public java.lang.String replace(char, char);</div><div class="line">    public java.lang.String replace(java.lang.CharSequence, java.lang.CharSequence);</div><div class="line">    public boolean matches(java.lang.String);</div><div class="line">    public boolean contains(java.lang.CharSequence);</div><div class="line">    public java.lang.String replaceFirst(java.lang.String, java.lang.String);</div><div class="line">    public java.lang.String replaceAll(java.lang.String, java.lang.String);</div><div class="line">    public [Ljava.lang.String; split(java.lang.String, int);</div><div class="line">    public [Ljava.lang.String; split(java.lang.String);</div><div class="line">    public static transient java.lang.String join(java.lang.CharSequence, [Ljava.lang.CharSequence;);</div><div class="line">    public static java.lang.String join(java.lang.CharSequence, java.lang.Iterable);</div><div class="line">    public java.lang.String toLowerCase(java.util.Locale);</div><div class="line">    public java.lang.String toLowerCase();</div><div class="line">    public java.lang.String toUpperCase();</div><div class="line">    public java.lang.String toUpperCase(java.util.Locale);</div><div class="line">    public java.lang.String trim();</div><div class="line">    public [C toCharArray();</div><div class="line">    public static transient java.lang.String format(java.util.Locale, java.lang.String, [Ljava.lang.Object;);</div><div class="line">    public static transient java.lang.String format(java.lang.String, [Ljava.lang.Object;);</div><div class="line">    public static java.lang.String copyValueOf([C, int, int);</div><div class="line">    public static java.lang.String copyValueOf([C);</div><div class="line">    public native java.lang.String intern();</div><div class="line"></div><div class="line">    private final [C value;</div><div class="line">    private int <span class="built_in">hash</span>;</div><div class="line">    private static final long serialVersionUID;</div><div class="line">    private static final [Ljava.io.ObjectStreamField; serialPersistentFields;</div><div class="line">    public static final java.util.Comparator CASE_INSENSITIVE_ORDER;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/03/JAVA/equals正确姿势/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/03/JAVA/equals正确姿势/" itemprop="url">JAVA | equals的正确姿势</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-03T00:00:00+08:00">
                2016-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>职员（Employee）及其子类（Manager），当判断对象是否等同取决于所有属性时，建议使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (getClass() != otherObject.getClass()) <span class="built_in">return</span> <span class="literal">false</span>;</div></pre></td></tr></table></figure></p>
<p>而不是<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (!(otherObject instanceof Employee)) <span class="built_in">return</span> <span class="literal">false</span>;</div></pre></td></tr></table></figure></p>
<p>如果当父类能够明确判断对象是否相同的条件时，可以使用instanceof。比如，实际中职员都有一个唯一ID，只要id相同即是同一个职员。那么将父类Employee的equals方法设计为判断ID值是否相同即可，当然hashCode方法也要由id来决定。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public int <span class="function"><span class="title">hashCode</span></span>() &#123;</div><div class="line">    <span class="built_in">return</span> Objects.hash(this.id);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public boolean equals(Object otherObject) &#123;</div><div class="line">    <span class="keyword">if</span> (this == otherObject) <span class="built_in">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">if</span> (otherObject == null) <span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">    <span class="keyword">if</span> (!(otherObject instanceof Employee)) <span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">	</div><div class="line">    Employee other = (Employee) otherObject;</div><div class="line">    <span class="built_in">return</span> this.id == other.id;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>全部代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line">class Employee &#123;</div><div class="line">    private String name;</div><div class="line">    private double salary;</div><div class="line">    private LocalDate hireDay;</div><div class="line">	</div><div class="line">    public Employee(String name, double salary, int year, int month, int day) &#123;</div><div class="line">        this.name = name;</div><div class="line">        this.salary = salary;</div><div class="line">        this.hireDay = LocalDate.of(year, month, day);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String <span class="function"><span class="title">getName</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> this.name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public double <span class="function"><span class="title">getSalary</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> this.salary;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public LocalDate <span class="function"><span class="title">getHireDay</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> this.hireDay;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    public void raiseSalary(double byPercent) &#123;</div><div class="line">        double raise = this.salary * byPercent / 100;</div><div class="line">        this.salary += raise;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    @Override</div><div class="line">    public int <span class="function"><span class="title">hashCode</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> Objects.hash(this.name, this.salary, this.hireDay);</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">	@Override</div><div class="line">    public boolean equals(Object otherObject) &#123;</div><div class="line">        <span class="keyword">if</span> (this == otherObject) <span class="built_in">return</span> <span class="literal">true</span>;</div><div class="line">        <span class="keyword">if</span> (otherObject == null) <span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span> (getClass() != otherObject.getClass()) <span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">		</div><div class="line">        Employee other = (Employee) otherObject;</div><div class="line">        <span class="built_in">return</span> Objects.equals(this.name, other.name) &amp;&amp; this.salary == other.salary </div><div class="line">            &amp;&amp; Objects.equals(this.hireDay, other.hireDay);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String <span class="function"><span class="title">toString</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> getClass().getName() + <span class="string">" [name="</span> + name + <span class="string">", salary="</span> + salary </div><div class="line">            + <span class="string">", hireDay="</span> + hireDay + <span class="string">"]"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class Manager extends Employee &#123;</div><div class="line">    private double bonus;</div><div class="line">	</div><div class="line">    public Manager(String name, double salary, int year, int month, int day) &#123;</div><div class="line">        super(name, salary, year, month, day);</div><div class="line">        bonus = 0;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    public void <span class="built_in">set</span>Bonus(double bonus) &#123;</div><div class="line">        this.bonus = bonus;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public double <span class="function"><span class="title">getSalary</span></span>() &#123;</div><div class="line">        double baseSalary = super.getSalary();</div><div class="line">        <span class="built_in">return</span> baseSalary + bonus;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    @Override</div><div class="line">    public int <span class="function"><span class="title">hashCode</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> super.hashCode() + 17 * Double.hashCode(bonus);</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    @Override</div><div class="line">    public boolean equals(Object otherObject) &#123;</div><div class="line">        <span class="keyword">if</span> (!super.equals(otherObject)) <span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">		</div><div class="line">        Manager other = (Manager) otherObject;</div><div class="line">        <span class="built_in">return</span> bonus == other.bonus;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/02/JAVA/使用克隆防止破坏封装性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="King">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/02/JAVA/使用克隆防止破坏封装性/" itemprop="url">JAVA | 使用克隆防止破坏封装性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-02T00:00:00+08:00">
                2016-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>请先看一个案例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 职员类</div><div class="line"> * </div><div class="line"> * @author xianxiaotao</div><div class="line"> */</div><div class="line">public class Employee &#123;</div><div class="line">    private Date hireDay;</div><div class="line">    </div><div class="line">    public Employee(Date hireDay) &#123;</div><div class="line">        this.hireDay = hireDay;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public Date <span class="function"><span class="title">getHireDay</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> this.hireDay;    // bad coding</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>职员，受雇日期是固定不变的，即使将属性设置为私有，依然可以使用这段代码直接将职员工龄增加10年：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Employee harry = new Employee(new Date());</div><div class="line">Date d = harry.getHireDay();</div><div class="line">double tenYearsInMilliSeconds = 10 * 365.25 * 24 * 60 * 60 * 1000;</div><div class="line">d.setTime(d.getTime() - (long) tenYearsInMilliSeconds);</div></pre></td></tr></table></figure></p>
<p>如果需要返回一个可变对象的引用，应该首先对它进行克隆（clone），代码修改如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public Date <span class="function"><span class="title">getHireDay</span></span>() &#123;</div><div class="line">    <span class="built_in">return</span> (Date) hireDay.clone();// Ok</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>建议使用LocalDate代替Date</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">78</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
