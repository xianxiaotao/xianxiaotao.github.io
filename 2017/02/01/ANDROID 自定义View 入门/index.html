<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>ANDROID | 自定义VIEW入门 | King</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ANDROID | 自定义VIEW入门</h1><a id="logo" href="/.">King</a><p class="description">xianxiaotao</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ANDROID | 自定义VIEW入门</h1><div class="post-meta">Feb 1, 2017<span> | </span><span class="category"><a href="/categories/ANDROID/">ANDROID</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h2 id="一、自定义View"><a href="#一、自定义View" class="headerlink" title="一、自定义View"></a>一、自定义View</h2><p>Android系统内置的View无法满足业务需求，需要自定义。</p>
<h4 id="Step-1-继承View"><a href="#Step-1-继承View" class="headerlink" title="Step 1 : 继承View"></a>Step 1 : 继承View</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public class CustomView extends View &#123;</div><div class="line">    public CustomView(Context context) &#123;</div><div class="line">        super(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public CustomView(Context context, AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>至少写2个构造函数</p>
</blockquote>
<h4 id="Step-2-自定义属性"><a href="#Step-2-自定义属性" class="headerlink" title="Step 2 : 自定义属性"></a>Step 2 : 自定义属性</h4><p>有些属性希望由用户指定，只有当用户不指定的时候才用我们硬编码的值，比如默认的宽高，在res/values/styles.xml文件里声明：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;resources&gt;</div><div class="line"></div><div class="line">    &lt;!-- suggestion：the name is the class name --&gt;</div><div class="line">    &lt;<span class="built_in">declare</span>-styleable name=<span class="string">"CustomView"</span>&gt;</div><div class="line">        &lt;attr name=<span class="string">"default_size"</span> format=<span class="string">"dimension"</span> /&gt;</div><div class="line">    &lt;/<span class="built_in">declare</span>-styleable&gt;</div><div class="line"></div><div class="line">&lt;/resources&gt;</div></pre></td></tr></table></figure></p>
<p>布局文件activity_main.xml中使用自定义的属性<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    xmlns:xian=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    android:layout_width=<span class="string">"match_parent"</span></div><div class="line">    android:layout_height=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">    &lt;!-- xian为命名空间，名称随便定义，其值固定为<span class="string">"http://schemas.android.com/apk/res-auto"</span> --&gt;</div><div class="line">    &lt;com.king.demo.customview.CustomView</div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"100dp"</span></div><div class="line">        xian:default_size=<span class="string">"100dp"</span> /&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>构造器中读取配置信息并初始化<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">private int defaultSize;</div><div class="line">public CustomView(Context context, AttributeSet attrs) &#123;</div><div class="line">    super(context, attrs);</div><div class="line"></div><div class="line">    TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.CustomView);</div><div class="line">    defaultSize = a.getDimensionPixelSize(R.styleable.CustomView_default_size, 100);</div><div class="line">    a.recycle();        // 回收TypedArray对象</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Step-3-重写onMeasure"><a href="#Step-3-重写onMeasure" class="headerlink" title="Step 3 : 重写onMeasure()"></a>Step 3 : 重写onMeasure()</h4><p>测量宽高尺寸并设置需要的值。如果不需要制定自定义控件的宽高，无需重写此方法。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</div><div class="line">    super.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line"></div><div class="line">    // 重构控件宽高，此处设宽高相等</div><div class="line">    int width = getMySize(100, widthMeasureSpec);</div><div class="line">    int height = getMySize(100, heightMeasureSpec);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (width &lt; height) </div><div class="line">        height = width;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        width = height;</div><div class="line"></div><div class="line">    <span class="built_in">set</span>MeasuredDimension(width, height);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 辅助方法，计算宽高</div><div class="line"> * @param defaultSize 设置宽高默认的值</div><div class="line"> * @param measureSpec </div><div class="line"> * @<span class="built_in">return</span></div><div class="line"> */</div><div class="line">private int getMySize(int defaultSize, int measureSpec) &#123;</div><div class="line">    int mySize = defaultSize;</div><div class="line"></div><div class="line">    int mode = MeasureSpec.getMode(measureSpec);</div><div class="line">    int size = MeasureSpec.getSize(measureSpec);</div><div class="line"></div><div class="line">    switch (mode) &#123;</div><div class="line">        <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:   // 如果没有指定大小，就设置为默认大小</div><div class="line">            mySize = defaultSize;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">        <span class="keyword">case</span> MeasureSpec.AT_MOST:       // 如果测量模式是最大取值为size</div><div class="line">        <span class="keyword">case</span> MeasureSpec.EXACTLY:       // 如果是固定的大小，那就不要去改变它</div><div class="line">            mySize = size;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">return</span> mySize;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<ul>
<li>onMeasure()至少会被调用两次，第一次读取xml文件中的参数layout_width和layout_width，它们可以不用指定具体的尺寸，如值为wrap_content或match_parent。为了更好的适配各种尺寸的屏幕，需要根据父类布局或子类控件宽高动态计算实际宽高，而不是在xml中指定具体的数值。</li>
<li>widthMeasureSpec和heightMeasureSpec都是int，前面2个bit用于区分不同的测量模式，后面30个bit存放的是尺寸的数据。测量模式分三种：UNSPECIFIED（父容器没有对当前View有任何限制，当前View可以任意取尺寸）、EXACTLY（当前的尺寸就是当前View应该取的尺寸，对应match_parent和固定值）、AT_MOST（当前尺寸是当前View能取的最大尺寸，对应wrap_content）</li>
</ul>
</blockquote>
<h4 id="Step-4-重写onDraw"><a href="#Step-4-重写onDraw" class="headerlink" title="Step 4 : 重写onDraw()"></a>Step 4 : 重写onDraw()</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected void onDraw(Canvas canvas) &#123;</div><div class="line">    super.onDraw(canvas);</div><div class="line"></div><div class="line">    int r = getMeasuredWidth() / 2;</div><div class="line">    int centerX = getLeft() + r;</div><div class="line">    int centerY = getTop() + r;</div><div class="line"></div><div class="line">    Paint paint = new Paint();</div><div class="line">    paint.setColor(Color.RED);</div><div class="line">    canvas.drawCircle(centerX, centerY, r, paint);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="二、CustomView完整代码"><a href="#二、CustomView完整代码" class="headerlink" title="二、CustomView完整代码"></a>二、CustomView完整代码</h2><h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><p><img src="http://ww1.sinaimg.cn/large/adc90466ly1fdhnwpy6pgj206o0b4wek" alt=""></p>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">package com.king.demo.customview;</div><div class="line"></div><div class="line">import android.content.Context;</div><div class="line">import android.content.res.TypedArray;</div><div class="line">import android.graphics.Canvas;</div><div class="line">import android.graphics.Color;</div><div class="line">import android.graphics.Paint;</div><div class="line">import android.util.AttributeSet;</div><div class="line">import android.view.View;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 继承View，至少写2个构造函数</div><div class="line"> */</div><div class="line">public class CustomView extends View &#123;</div><div class="line">    private int defaultSize;</div><div class="line"></div><div class="line">    public CustomView(Context context) &#123;</div><div class="line">        super(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public CustomView(Context context, AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line"></div><div class="line">        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.CustomView);</div><div class="line">        defaultSize = a.getDimensionPixelSize(R.styleable.CustomView_default_size, 100);</div><div class="line">        a.recycle();        // 回收TypedArray对象</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 辅助方法，计算宽高</div><div class="line">     * @param defaultSize 设置宽高默认的值</div><div class="line">     * @param measureSpec</div><div class="line">     * @<span class="built_in">return</span></div><div class="line">     */</div><div class="line">    private int getMySize(int defaultSize, int measureSpec) &#123;</div><div class="line">        int mySize = defaultSize;</div><div class="line"></div><div class="line">        int mode = MeasureSpec.getMode(measureSpec);</div><div class="line">        int size = MeasureSpec.getSize(measureSpec);</div><div class="line"></div><div class="line">        switch (mode) &#123;</div><div class="line">            <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:   // 如果没有指定大小，就设置为默认大小</div><div class="line">                mySize = defaultSize;</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            <span class="keyword">case</span> MeasureSpec.AT_MOST:</div><div class="line">            <span class="keyword">case</span> MeasureSpec.EXACTLY:       // 如果是固定的大小，那就不要去改变它</div><div class="line">                mySize = size;</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> mySize;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</div><div class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line"></div><div class="line">        // 重构控件宽高</div><div class="line">        int width = getMySize(defaultSize, widthMeasureSpec);</div><div class="line">        int height = getMySize(defaultSize, heightMeasureSpec);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (width &lt; height) &#123;</div><div class="line">            height = width;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            width = height;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="built_in">set</span>MeasuredDimension(width, height);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDraw(Canvas canvas) &#123;</div><div class="line">        super.onDraw(canvas);</div><div class="line"></div><div class="line">        int r = getMeasuredWidth() / 2;</div><div class="line">        int centerX = getLeft() + r;</div><div class="line">        int centerY = getTop() + r;</div><div class="line"></div><div class="line">        Paint paint = new Paint();</div><div class="line">        paint.setColor(Color.RED);</div><div class="line">        canvas.drawCircle(centerX, centerY, r, paint);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/02/01/ANDROID 自定义View 入门/" data-id="cj03d1yjb0015mwcjxf9i5uit" class="article-share-link">Share</a><div class="tags"><a href="/tags/ANDROID/">ANDROID</a><a href="/tags/CUSTOM-VIEW/">CUSTOM VIEW</a></div><div class="post-nav"><a href="/2017/01/13/Design pattern 策略设计模式/" class="next">DESIGN PATTERN | Strategy 策略设计模式</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ANDROID/">ANDROID</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DESIGN-PATTERN/">DESIGN PATTERN</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/ANDROID/" style="font-size: 15px;">ANDROID</a> <a href="/tags/DESIGN-PATTERN/" style="font-size: 15px;">DESIGN PATTERN</a> <a href="/tags/CUSTOM-VIEW/" style="font-size: 15px;">CUSTOM VIEW</a> <a href="/tags/util/" style="font-size: 15px;">util</a> <a href="/tags/JAVA/" style="font-size: 15px;">JAVA</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/01/ANDROID 自定义View 入门/">ANDROID | 自定义VIEW入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/13/Design pattern 策略设计模式/">DESIGN PATTERN | Strategy 策略设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/12/Design pattern 享元设计模式/">DESIGN PATTERN | Flyweight 享元设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/11/Design pattern 组合设计模式/">DESIGN PATTERN | Composite 组合设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/10/Design pattern 桥接设计模式/">DESIGN PATTERN | Bridge 桥接设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/09/Design pattern 外观设计模式/">DESIGN PATTERN | Facade 外观设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/Design pattern 代理设计模式/">DESIGN PATTERN | Proxy 代理设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/07/Design pattern 装饰器设计模式/">DESIGN PATTERN | Decorator 装饰器设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/06/Design pattern 适配器设计模式/">DESIGN PATTERN | Adapter 适配器设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/05/Design pattern 原型设计模式/">DESIGN PATTERN | Prototype 原型设计模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="https://developer.android.com/guide/components/" title="Android development documentation chinese" target="_blank">Android development documentation chinese</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">King.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>