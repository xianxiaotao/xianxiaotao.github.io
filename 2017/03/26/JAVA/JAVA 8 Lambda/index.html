<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>JAVA | java8之Lambda | King</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">JAVA | java8之Lambda</h1><a id="logo" href="/.">King</a><p class="description">xianxiaotao</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">JAVA | java8之Lambda</h1><div class="post-meta">Mar 26, 2017<span> | </span><span class="category"><a href="/categories/JAVA/">JAVA</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h2 id="一、基本语法"><a href="#一、基本语法" class="headerlink" title="一、基本语法"></a>一、基本语法</h2><p>Java是一种面向对象语言，所以必须构造一个对象，这个对象的类需要有一个方法能包含所需的代码。如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class LengthComparator implements Comparator&lt;String&gt; &#123;</div><div class="line">    public int compare(String first, String second) &#123;</div><div class="line">        <span class="built_in">return</span> first.length - second.first;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// uses</div><div class="line">Arrays.sort(strings, new LengthComparator());</div></pre></td></tr></table></figure></p>
<p>如果使用Lambda表达式，则使用代码更改为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Arrays.sort(strings, (String first, String second) -&gt; &#123; <span class="built_in">return</span> first.length - second.first; &#125;));</div></pre></td></tr></table></figure></p>
<h4 id="简化"><a href="#简化" class="headerlink" title="简化"></a>简化</h4><p>在这里，编译器可以推导出first和second必然是字符串，参数类型可以省略不写；方法体里只有一行，亦可简化。如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Arrays.sort(strings, (first, second) -&gt; first.length() - second.length());</div></pre></td></tr></table></figure></p>
<h4 id="无参"><a href="#无参" class="headerlink" title="无参"></a>无参</h4><p>即使lambda表达式没有参数，仍然要提供括号，就像无参数方法一样：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">() -&gt; &#123; <span class="keyword">for</span> (int i = 100; i &gt;= 0; i--) System.out.println(i); &#125;</div></pre></td></tr></table></figure></p>
<h4 id="一参"><a href="#一参" class="headerlink" title="一参"></a>一参</h4><p>如果方法只有一个参数，而且这个参数的类型可以推导得出，那么甚至还可以省略小括号：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ActionListener listener = event -&gt; System.out.println(<span class="string">"The time is "</span> + new Date());</div></pre></td></tr></table></figure></p>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>1）无需指定lambda表达式的返回类型，因为返回类型总是会由上下文推导得出。<br>2）如果一个lambda表达式只在某些分支返回一个值，而在另外一些分支不返回值，这是不合法的。例如，(int x) -&gt; { if (x &gt;= 0) return 1; }就不合法。</p>
<h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">package com.xian.lambda;</div><div class="line"></div><div class="line">import java.util.Arrays;</div><div class="line">import java.util.Date;</div><div class="line"></div><div class="line">import javax.swing.JOptionPane;</div><div class="line">import javax.swing.Timer;</div><div class="line"></div><div class="line">public class LambdaTest &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        String[] masters = &#123;<span class="string">"liyao"</span>, <span class="string">"zhaoyu"</span>, <span class="string">"hufeng"</span>, <span class="string">"xianxiaotao"</span>, <span class="string">"cuihongquan"</span>&#125;;</div><div class="line">        System.out.println(Arrays.toString(masters));</div><div class="line">        System.out.println(<span class="string">"Sorted in dictionary order:"</span>);</div><div class="line">        Arrays.sort(masters);</div><div class="line">        System.out.println(Arrays.toString(masters));</div><div class="line">        System.out.println(<span class="string">"Sorted by length:"</span>);</div><div class="line">        Arrays.sort(masters, (first, second) -&gt; first.length() - second.length());</div><div class="line">        System.out.println(Arrays.toString(masters));</div><div class="line">        </div><div class="line">        Timer t = new Timer(10000, event -&gt; System.out.println(<span class="string">"The time is"</span> + new Date()));</div><div class="line">        t.start();</div><div class="line">        JOptionPane.showMessageDialog(null, <span class="string">"Quit program?"</span>);</div><div class="line">        System.exit(0);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="二、函数式接口"><a href="#二、函数式接口" class="headerlink" title="二、函数式接口"></a>二、函数式接口</h2><p>对于只有一个抽象方法的接口，需要这种接口的对象时，就可以提供一个lambda表达式。这个接口称为函数式接口。如上例中的Comparator接口，或者java.util.function包中的接口Predicate：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface Predicate&lt;T&gt; &#123;</div><div class="line">    boolean <span class="built_in">test</span>(T t);</div><div class="line">    // Additional default and static methods</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ArrayList类有一个removeIf方法它的参数就是一个Predicate。这个接口专门用来传递lambda表达式。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">list.removeIf(e -&gt; e == null);</div></pre></td></tr></table></figure></p>
<h2 id="三、方法引用"><a href="#三、方法引用" class="headerlink" title="三、方法引用"></a>三、方法引用</h2><p>表达式System.out::println是一个方法引用，等价于lambda表达式x -&gt; System.out.println(x)。又如下列两行代码等同：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Timer t = new Timer(1000, event -&gt; System.out.println(event));</div><div class="line">Timer t = new Timer(1000, System.out::println);</div></pre></td></tr></table></figure></p>
<p>操作符 “::” 用来分割方法名与对象或类名。主要分为三种情况：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">objcet::instanceMethod    如：System.out::println             x -&gt; System.out.println(x)</div><div class="line">Class::staticMethod       如：Math::pow                       (x, y) -&gt; Math.pow(x, y)</div><div class="line">Class::instanceMethod     如：String::compareToIgnoreCase     (x, y) -&gt; x.compareToIgnoreCase(y)</div></pre></td></tr></table></figure></p>
<p>对于第三种情况，第一个参数会成为方法的目标。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Arrays.sort(masters, String::compareToIgnoreCase);</div><div class="line">Arrays.sort(masters, (first, second) -&gt; first.compareToIgnoreCase(second));</div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意：对于重载方法，编译器会尝试从上下文中找出你指的那一个方法；方法引用不能独立存在，总是会转换为函数式接口的实例；方法引用中可以使用this和super参数，例如this::equals等同于x -&gt; this.equals(x)；使用super作为目标，会调用方法的超类版本，格式为super::instanceMethod；this是指创建lambda表达式的方法所属的对象，super同理。</p>
</blockquote>
<h2 id="四、构造器引用"><a href="#四、构造器引用" class="headerlink" title="四、构造器引用"></a>四、构造器引用</h2><p>构造器引用与方法引用类似，只不过方法名为new。例如，Person::new是Person构造器的一个引用。至于哪一个构造器，这取决于上下文。假如你有一个字符串列表，并把它转换为Person对象数组，其如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ArrayList&lt;String&gt; names = ...;</div><div class="line">Stream&lt;Person&gt; stream = names.stream().map(Person::new);</div><div class="line">List&lt;Person&gt; people = stream.collect(Collectors.toList());</div></pre></td></tr></table></figure></p>
<p>根据上下文，编译器会选择一个String参数的构造器。可以用数组类型建立构造器引用。例如，int[]::new，这等价于lambda表达式x -&gt; new int[x]。</p>
<h2 id="五、变量"><a href="#五、变量" class="headerlink" title="五、变量"></a>五、变量</h2><p>lambda表达式中捕获的变量必须实际上是最终变量，即这个变量初始化之后就不会再为它赋新值。如下例中的text总是指示同一个String对象，所以此处合法。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class LambdaTest &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        repeatMessage(<span class="string">"hello"</span>, 1000);</div><div class="line">        JOptionPane.showMessageDialog(null, <span class="string">"Quit program?"</span>);</div><div class="line">        System.exit(0);        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public static void repeatMessage(String text, int delay) &#123;</div><div class="line">        ActionListener listener = event -&gt; System.out.println(text);</div><div class="line">        new Timer(delay, listener).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当lambda表达式捕获外围作用域中变量的，无论是外部改变还是内部改变都不合法的。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// 外部改变：</div><div class="line">public static void repeat(String text, int count) &#123;</div><div class="line">    <span class="keyword">for</span> (int i = 1; i &lt;= count; i++) &#123;</div><div class="line">        ActionListener listener = event -&gt; &#123;</div><div class="line">            System.out.println(i + <span class="string">": "</span> + text);    // Error: Cannot refer to changing i</div><div class="line">        &#125;;</div><div class="line">        new Timer(1000, listener).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">// 内部改变：</div><div class="line">public static void countDown(int start, int delay) &#123;</div><div class="line">    ActionListener listener = event -&gt; &#123;</div><div class="line">            start--;                                // Error: Cannot mutate captured variable</div><div class="line">            System.out.println(start); </div><div class="line">        &#125;;</div><div class="line">        new Timer(delay, listener).start();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/03/26/JAVA/JAVA 8 Lambda/" data-id="cj0qfwca80006u3cj5sqiagw5" class="article-share-link">Share</a><div class="tags"><a href="/tags/JAVA/">JAVA</a></div><div class="post-nav"><a href="/2017/03/26/JAVA/JAVA 8 Interface/" class="pre">JAVA | java8之Interface</a><a href="/2017/03/25/JAVA/JAVA 8 LocalDate/" class="next">JAVA | java8之LocalDate</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ANDROID/">ANDROID</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DESIGN-PATTERN/">DESIGN PATTERN</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/ANDROID/" style="font-size: 15px;">ANDROID</a> <a href="/tags/util/" style="font-size: 15px;">util</a> <a href="/tags/CUSTOM-VIEW/" style="font-size: 15px;">CUSTOM VIEW</a> <a href="/tags/JAVA/" style="font-size: 15px;">JAVA</a> <a href="/tags/DESIGN-PATTERN/" style="font-size: 15px;">DESIGN PATTERN</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/26/JAVA/JAVA 8 Interface/">JAVA | java8之Interface</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/26/JAVA/JAVA 8 Lambda/">JAVA | java8之Lambda</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/25/JAVA/JAVA 8 LocalDate/">JAVA | java8之LocalDate</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/01/ANDROID/ANDROID 自定义View 入门/">ANDROID | 自定义VIEW入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/13/PATTERN/Design pattern 策略设计模式/">DESIGN PATTERN | Strategy 策略设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/12/PATTERN/Design pattern 享元设计模式/">DESIGN PATTERN | Flyweight 享元设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/11/PATTERN/Design pattern 组合设计模式/">DESIGN PATTERN | Composite 组合设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/10/PATTERN/Design pattern 桥接设计模式/">DESIGN PATTERN | Bridge 桥接设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/09/PATTERN/Design pattern 外观设计模式/">DESIGN PATTERN | Facade 外观设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/PATTERN/Design pattern 代理设计模式/">DESIGN PATTERN | Proxy 代理设计模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="https://developer.android.com/guide/components/" title="Android development documentation chinese" target="_blank">Android development documentation chinese</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">King.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>