<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>01.6 精通自定义 View 之绘图基础（六） | King</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">01.6 精通自定义 View 之绘图基础（六）</h1><a id="logo" href="/.">King</a><p class="description">xianxiaotao</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">01.6 精通自定义 View 之绘图基础（六）</h1><div class="post-meta">Jul 1, 2019<span> | </span><span class="category"><a href="/categories/Custom-View/">Custom View</a></span></div><div class="post-content"><meta name="referrer" content="no-referrer">

<h2 id="1-6-控件的使用方法"><a href="#1-6-控件的使用方法" class="headerlink" title="1.6 控件的使用方法"></a>1.6 控件的使用方法</h2><h4 id="1-6-1-控件概述"><a href="#1-6-1-控件概述" class="headerlink" title="1.6.1 控件概述"></a>1.6.1 控件概述</h4><p>在自定义一个派生自 View 或 ViewGroup 类的控件时，必须实现一个构造函数。有三个构造函数供我们选择。<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class CustomView extends View &#123;</div><div class="line">    public CustomView(Context context) &#123;</div><div class="line">        super(context);</div><div class="line">    &#125;</div><div class="line">    public CustomView(Context context, AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">    &#125;</div><div class="line">    public CustomView(Context context, AttributeSet attrs, int defStyle) &#123; </div><div class="line">        super(context, attrs, defStyle);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其实每种构造函数都是在特定的使用情景下所必须实现的，否则将会报 inflate 错误。</p>
<h4 id="1-6-2-通过XML引入控件"><a href="#1-6-2-通过XML引入控件" class="headerlink" title="1.6.2 通过XML引入控件"></a>1.6.2 通过XML引入控件</h4><p>使用以下方式引入控件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout ...&gt;</div><div class="line">    &lt;com.xxt.xtest.CustomView ... /&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>就必须实现第二个构造函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public CustomView(Context context, AttributeSet attrs) &#123;</div><div class="line">    super(context, attrs);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="1-6-3-动态添加控件"><a href="#1-6-3-动态添加控件" class="headerlink" title="1.6.3 动态添加控件"></a>1.6.3 动态添加控件</h4><h6 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h6><p>示例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">LinearLayout rootView = (LinearLayout)findViewById(R.id.root);</div><div class="line">CustomView customView = new CustomView(this);</div><div class="line">LinearLayout.LayoutParams layoutParams = new LinearLayout.LayoutParams (</div><div class="line">                LinearLayout.LayoutParams.MATCH_PARENT, </div><div class="line">                LinearLayout.LayoutParams.MATCH_PARENT);</div><div class="line">rootView.addView(customView,layoutParams);</div></pre></td></tr></table></figure></p>
<h6 id="2-LayoutParams"><a href="#2-LayoutParams" class="headerlink" title="2. LayoutParams"></a>2. LayoutParams</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 第一个构造函数常用</div><div class="line">public LayoutParams(int width, int height)</div><div class="line">// 用于从 AttributeSet 中􏰑取出 layout_width、 layout_height 等各属性的值</div><div class="line">public LayoutParams(Context c, AttributeSet attrs)</div><div class="line">public LayoutParams(LayoutParams source)</div></pre></td></tr></table></figure>
<p>每个容器类控件都会实现一套 LayoutParams 类，而子类则用的是父容器的 LayoutParams 类。比如上述中父容器是 LinearLayout，所以使用 LinearLayout.LayoutParams。之所以不能共用，是因为各个容器所对应的布局属性是不一样的。</p>
<p>在 RelativeLayout 中，实现添加到 TextView 控件的右侧：addRule()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">RelativeLayout rootView = (RelativeLayout) findViewById(R.id.root); </div><div class="line">CustomView customView = new CustomView(this);</div><div class="line">RelativeLayout.LayoutParams layoutParams = new RelativeLayout.LayoutParams(</div><div class="line">                RelativeLayout.LayoutParams.MATCH_PARENT, </div><div class="line">                RelativeLayout.LayoutParams.MATCH_ PARENT);</div><div class="line">layoutParams.addRule(RelativeLayout.RIGHT_OF,R.id.text); </div><div class="line">rootView.addView(customView, layoutParams);</div></pre></td></tr></table></figure></p>
<p>1）设置 margin<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">LinearLayout.LayoutParams lp = new LinearLayout.LayoutParams(</div><div class="line">                LinearLayout. LayoutParams.WRAP_CONTENT, </div><div class="line">                LinearLayout.LayoutParams.WRAP_CONTENT);</div><div class="line">lp.setMargins(10, 20, 30, 40);</div><div class="line">imageView.setLayoutParams(lp);</div></pre></td></tr></table></figure></p>
<p>2）设置 layout_weight (方法一)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">TextView tv_like = new TextView(this);</div><div class="line">LinearLayout.LayoutParams LP_LIKE_MW = new LinearLayout.LayoutParams (</div><div class="line">                LinearLayout.LayoutParams.MATCH_PARENT, </div><div class="line">                LinearLayout.LayoutParams.WRAP_ CONTENT, </div><div class="line">                1.0f);</div><div class="line">tv_like.setText(&quot;赞(8)&quot;); </div><div class="line">tv_like.setTextSize(16); </div><div class="line">layout_sub_Lin.addView(tv_like, LP_LIKE_MW);</div></pre></td></tr></table></figure></p>
<p>3）设置 layout_weight (方法二)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">LinearLayout.LayoutParams layoutParams = new LinearLayout.LayoutParams(</div><div class="line">                LinearLayout.LayoutParams.MATCH_PARENT,</div><div class="line">                LinearLayout.LayoutParams.MATCH_ PARENT);</div><div class="line">layoutParams.weight = 1.0f;</div><div class="line">rootView.addView(customView, layoutParams);</div></pre></td></tr></table></figure></p>
<p>4）设置 layout_gravity<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">LinearLayout.LayoutParams layoutParams = new LinearLayout.LayoutParams(</div><div class="line">                LinearLayout.LayoutParams.MATCH_PARENT,</div><div class="line">                LinearLayout.LayoutParams.MATCH_ PARENT);</div><div class="line">params.gravity = Gravity.TOP;</div><div class="line">Button button = new Button(this);</div><div class="line">rootView.addView(button, layoutParams);</div></pre></td></tr></table></figure></p>
<p>5）设置 android:gravity<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">RelativeLayout rootView = (RelativeLayout) findViewById(R.id.root);</div><div class="line">RelativeLayout.LayoutParams layoutParams = new RelativeLayout.LayoutParams(</div><div class="line">                RelativeLayout.LayoutParams.WRAP_CONTENT,</div><div class="line">                200);</div><div class="line">layoutParams.addRule(RelativeLayout.RIGHT_OF, R.id.text);</div><div class="line"></div><div class="line">Button button = new Button(this); </div><div class="line">button.setGravity(Gravity.TOP);</div><div class="line">button.setText(&quot;btn&quot;);</div><div class="line">rootView.addView(button, layoutParams); </div><div class="line">rootView.setGravity(Gravity.TOP | Gravity.CENTER_HORIZONTAL);</div></pre></td></tr></table></figure></p>
<h6 id="3-addView"><a href="#3-addView" class="headerlink" title="3. addView"></a>3. addView</h6><p>动态添加控件都是通过 addView 来实现的，addView 是 ViewGroup 类中的一个函数，它有 5 个构造函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">// 在节点末尾添加一个 View 控件，布局使用默认布局</div><div class="line">// layout_width = wrap_content、layout_height = wrap_content</div><div class="line">public void addView(View child)</div><div class="line"></div><div class="line">// 在指定位置添加一个 View 控件，index 的取值有-1、0 和正数。</div><div class="line">// -1：表示在末尾添加一个 View 控件</div><div class="line">// 0：表示在容器顶端添加一个 View 控件</div><div class="line">// 正数：表示在对应的索引位置插入一个 View 控件</div><div class="line">public void addView(View child, int index)</div><div class="line"></div><div class="line">// 使用自定义自定义布局参数，在节点末尾添加一个 View 控件</div><div class="line">public void addView(View child, LayoutParams params)</div><div class="line"></div><div class="line">// 使用自定义自定义布局参数，在指定位置添加一个 View 控件</div><div class="line">public void addView(View child, int index, LayoutParams params)</div><div class="line"></div><div class="line">// 只指定宽和高</div><div class="line">public void addView(View child, int width, int height)</div></pre></td></tr></table></figure></p>
</div><div class="tags"><a href="/tags/Custom-View/">Custom View</a></div><div class="post-nav"><a class="pre" href="/2019/07/02/Custom View/02.1 精通自定义 View 之视图动画（一）/">02.1 精通自定义 View 之视图动画（一）</a><a class="next" href="/2019/07/01/Custom View/01.5 精通自定义 View 之绘图基础（五）/">01.5 精通自定义 View 之绘图基础（五）</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ANDROID/">ANDROID</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Custom-View/">Custom View</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DESIGN-PATTERN/">DESIGN PATTERN</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">King.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>